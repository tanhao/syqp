{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblRoundCount","btnReady","Button","btnGang","btnPeng","btnChi","btnHu","btnGuo","chupaidian","Sprite","settingWin","Node","menuWin","_mymjs","_effects","onLoad","th","addComponent","initView","initEventHandlers","audioManager","playBGM","holds","node","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","seatNames","i","socketIOManager","seats","animComponent","Animation","hideOptions","self","dataEventHandler","on","target","console","log","JSON","stringify","detail","initSingleSeat","seatIndex","getSeatIndexById","userId","index","getLocalIndex","_seat","setOffline","seat","active","round","ready","initPokers","onGameBegin","turn","setCountdown","sort","a","b","pokerId","_myHoldPokers","pokerManager","getSpriteFrameByPokerId","setRestCard","data","activeReadyBtn","isReady","userManager"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        btnReady:cc.Button,\r\n        btnGang:cc.Button,\r\n        btnPeng:cc.Button,\r\n        btnChi:cc.Button,\r\n        btnHu:cc.Button,\r\n        btnGuo:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        menuWin:cc.Node,\r\n\r\n        _mymjs:[],   //自己手上的牌Sprite结合\r\n        _effects:[], //每个座位动画节点（Animation）\r\n    },\r\n\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n\r\n    initView:function(){\r\n        var holds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<holds.children.length;j++){\r\n                var sprite = holds.children[j].getComponent(cc.Sprite);\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n        }\r\n        var seatNames = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i=0;i<seatNames.length;i++){\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            var animComponent=this.node.getChildByName(seatNames[i]).getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animComponent);\r\n        }\r\n        this.hideOptions();\r\n    },\r\n\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n\r\n        this.node.on('init_room', function (target) {\r\n            console.log('==>Gmae init_room:',JSON.stringify(target.detail));\r\n        });\r\n        //加入房间\r\n        this.node.on('join_push', function (target) {\r\n            console.log('==>Gmae join_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        });\r\n        //检查IP\r\n        this.node.on('check_ip', function (target) {\r\n            console.log('==>Gmae check_ip:',JSON.stringify(target.detail));\r\n        });\r\n        //离开房间\r\n        this.node.on('leave_push', function (target) {\r\n            console.log('==>Gmae leave_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        });\r\n        //解散房间\r\n        this.node.on('dissolve_push', function (target) {\r\n            console.log('==>Gmae dissolve_push:',JSON.stringify(target.detail));\r\n            \r\n        });\r\n        //其他玩家断线\r\n        this.node.on(\"offline_push\",function(target){\r\n            console.log('==>Gmae offline_push:',JSON.stringify(target.detail));\r\n            var seatIndex=th.socketIOManager.getSeatIndexById(target.detail.userId)\r\n            var index = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self._seat[index].setOffline(true);\r\n        })\r\n        //其他玩家上线\r\n        this.node.on(\"online_push\",function(target){\r\n            console.log('==>Gmae online_push:',JSON.stringify(target.detail));\r\n            var seatIndex=th.socketIOManager.getSeatIndexById(target.detail.userId)\r\n            var index = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self._seat[index].setOffline(false);\r\n        })\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(target){\r\n            console.log('==>Gmae ready_result:',JSON.stringify(target.detail));\r\n            var seat=target.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n            self.initSingleSeat(seat);\r\n        })\r\n        //其他玩家准备\r\n        this.node.on(\"ready_push\",function(target){\r\n            console.log('==>Gmae ready_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        })\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(target){\r\n            console.log('==>Gmae holds_push:',JSON.stringify(target.detail));\r\n            self.initPokers();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(target){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(target.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        })\r\n\r\n\r\n        //断线\r\n        this.node.on('disconnect', function (target) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(target.detail));\r\n        });\r\n        \r\n\r\n    },\r\n    onGameBegin:function(){\r\n        //隐藏微信邀请，返回大厅，按钮，\r\n        //启动第一个倒计时\r\n        this._seat[th.socketIOManager.turn].setCountdown(20);\r\n        \r\n    },\r\n    initPokers:function(){\r\n        var seats=th.socketIOManager.seats;\r\n        var seat=seats[th.socketIOManager.seatIndex];\r\n        var holds=seat.holds;\r\n        cc.log(\"initPokers:\",holds);\r\n        //排序\r\n        holds.sort(function(a,b){return a-b});\r\n        for(var i=0;i<holds.length;i++){\r\n            var pokerId=holds[i];\r\n            var sprite=this._myHoldPokers[i];\r\n            sprite.node.pokerId = pokerId;\r\n            sprite.spriteFrame = th.pokerManager.getSpriteFrameByPokerId(pokerId);\r\n            sprite.node.active = true;\r\n        }\r\n        for(var i=0;i<seats.length;i++){\r\n            this._seat[i].setRestCard(holds.length);\r\n        }\r\n    },\r\n    \r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n\r\n    hideOptions:function(data){\r\n        var activeReadyBtn=th.socketIOManager.round==0&&!th.socketIOManager.isReady(th.userManager.userId)\r\n        this.btnReady.node.active = activeReadyBtn;\r\n        this.btnGang.node.active=false;\r\n        this.btnPeng.node.active=false;\r\n        this.btnChi.node.active=false;\r\n        this.btnHu.node.active=false;\r\n        this.btnGuo.node.active=false;\r\n    },\r\n  \r\n\r\n});\r\n"]}