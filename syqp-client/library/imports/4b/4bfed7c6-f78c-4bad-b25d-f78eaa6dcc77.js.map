{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblRoundCount","spriteCaishen","Sprite","btnReady","Button","chupaidian","settingWin","Node","optionsWin","nodePrepare","nodeGameInfo","_mymjs","_effects","_chupais","_hupaiTips","onLoad","th","addComponent","initView","initEventHandlers","active","onGameBegin","audioManager","playBGM","node","myHolds","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","initDragStuffs","realwidth","director","getVisibleSize","width","scaleX","scaleY","sides","i","mjs","seatNode","spriteChupai","nodeHupai","socketIOManager","seats","animation","Animation","hideOptions","self","dataEventHandler","on","data","console","log","JSON","stringify","detail","checkIp","seat","round","ready","initMahjongs","target","string","mjsy","config","setSpriteFrameByMJID","caishen","hideChupai","last","seatIndex","initMopai","turn","showAction","seatData","index","playSFX","initOtherMahjongs","localIndex","getLocalIndex","playEffect","getSeatIndexById","userId","gangType","showChupai","audioUrl","mahjongManager","getAudioURLByMJID","pai","mjid","gold_icon","isHu","isZimo","alert","show","wc","loadScene","name","play","EventType","TOUCH_START","event","interactable","x","getLocationX","y","getLocationY","height","bind","TOUCH_MOVE","Math","abs","getDeltaX","getDeltaY","opacity","TOUCH_END","shoot","TOUCH_CANCEL","status","holds","childrenCount","nc","holdsEmpty","actions","onMJClicked","_selectedMJ","onOptionClicked","sio","send","pais","getMJIndex","side","getSide","pre","getFoldPre","lastIndex","getSpriteFrameByMJID","getHoldsEmptySpriteFrame","chupai","addOption","btnName","options","child","option","btns","btn","join","hu","gang","peng","chi","huPai","pengPai","chiPai","gangPai","gp","sortHolds","lackingNum","pengs","angangs","diangangs","bugangs","chis","sideHolds","idx","lasetIdx","sort","a","b","aa","bb"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        spriteCaishen:cc.Sprite,\r\n        btnReady:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        optionsWin:cc.Node,    ///所有可以做的操作节点\r\n        nodePrepare:cc.Node,\r\n        nodeGameInfo:cc.Node,\r\n\r\n        _mymjs:[],      //自己手上的牌Sprite结合\r\n        _effects:[],    //每个座位动画节点（Animation）\r\n        _chupais:[],    //每个座位出牌节点（Sprite）\r\n        _hupaiTips:[],  //每个座位胡牌提示节点:自摸，胡（抢杠胡）\r\n    },\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.addComponent(\"MJChiPengGangs\");\r\n        this.addComponent(\"MJGameOver\");\r\n        this.addComponent(\"MJGameResult\");\r\n        this.addComponent(\"MJReConnect\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n\r\n        this.nodePrepare.active=true;\r\n        this.nodeGameInfo.active=false;\r\n\r\n        this.onGameBegin();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n    initView:function(){\r\n        //把自己的牌都设置为null\r\n        this.chupaidian.node.active=false;\r\n        var myHolds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<myHolds.children.length;j++){\r\n                var sprite = myHolds.children[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n                //todo添加拖动效果\r\n                this.initDragStuffs(sprite.node);\r\n        }\r\n\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        myHolds.scaleX *= realwidth/1280;\r\n        myHolds.scaleY *= realwidth/1280;  \r\n        \r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        //隐藏其他玩家手上的牌\r\n        for(var i=1;i<sides.length;i++){\r\n            var mjs=this.node.getChildByName(sides[i]).getChildByName('Holds').children;\r\n            for(var j=0;j<mjs.length;j++){\r\n                var sprite = mjs[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n            }\r\n        }\r\n        for(var i=0;i<sides.length;i++){\r\n            var seatNode=this.node.getChildByName(sides[i]);\r\n            //出牌\r\n            var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n            spriteChupai.node.active=false;\r\n            spriteChupai.spriteFrame = null;\r\n            //胡牌NODE\r\n            var nodeHupai=seatNode.getChildByName('Hupai');\r\n            nodeHupai.active=false;\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            //操作效果\r\n            var animation=seatNode.getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animation);\r\n            this._chupais.push(spriteChupai);\r\n\r\n            this._hupaiTips.push(nodeHupai);\r\n            \r\n        }\r\n        this.hideOptions();\r\n    },\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n        //检查IP\r\n        this.node.on('check_ip', function (data) {\r\n            console.log('==>MJGame check_ip:',JSON.stringify(data.detail));\r\n            self.checkIp();\r\n        });\r\n        this.node.on('sync_push',function(data){\r\n            self.onGameBegin();\r\n            self.checkIp();\r\n        });\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(data){\r\n            console.log('==>Gmae ready_result:',JSON.stringify(data.detail));\r\n            var seat=data.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n        })\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(data){\r\n            console.log('==>Gmae holds_push:',JSON.stringify(data.detail));\r\n            self.initMahjongs();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n                //todo\r\n            }\r\n        })\r\n        //断线\r\n        this.node.on('disconnect', function (data) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(data.detail));\r\n        });\r\n        //通知还剩多少张牌\r\n         this.node.on(\"mjsy_push\",function(target){\r\n            //console.log('==>Gmae mjsy_push:',JSON.stringify(target.detail));\r\n            self.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n        })\r\n        //通知当前是第几局\r\n        this.node.on(\"round_push\",function(data){\r\n            console.log('==>Gmae round_push:',JSON.stringify(data.detail));\r\n            self.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        })\r\n        //通知财神是那个\r\n        this.node.on(\"caishen_push\",function(data){\r\n            console.log('==>Gmae caishen_push:',JSON.stringify(data.detail));\r\n            self.setSpriteFrameByMJID(\"M_\", self.spriteCaishen,th.socketIOManager.caishen);\r\n        })\r\n        this.node.on('begin_push',function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n            //第一把开局，要提示\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        });\r\n        this.node.on('chupai_push',function(data){\r\n            console.log('==>Gmae chupai_push:',JSON.stringify(data.detail));\r\n            data = data.detail;\r\n            self.hideChupai();\r\n            if(data.last != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.last,null);   \r\n            }\r\n            //todo 回放\r\n            if( data.turn != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.turn,-1);\r\n            }\r\n            \r\n        });\r\n        this.node.on('action_push',function(data){\r\n            console.log('==>Gmae action_push:',JSON.stringify(data.detail));\r\n            self.showAction(data.detail);\r\n        });\r\n        //过，自己操做过返回结果\r\n        this.node.on('guo_result',function(data){\r\n            self.hideChupai();\r\n        });\r\n        //过牌，\r\n        this.node.on('guo_notify_push',function(data){\r\n            //console.log('==>Gmae guo_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            self.hideOptions();\r\n            var seatData=data.detail;\r\n            //如果是自己，则刷新手牌\r\n            if(seatData.index ==th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            th.audioManager.playSFX(\"give.mp3\");\r\n        });\r\n        //吃牌\r\n        this.node.on('chi_notify_push',function(data){\r\n            console.log('==>Gmae chi_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_chi\");\r\n            th.audioManager.playSFX(\"nv/chi.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //碰牌\r\n        this.node.on('peng_notify_push',function(data){\r\n            console.log('==>Gmae peng_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_peng\");\r\n            th.audioManager.playSFX(\"nv/peng.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //杠牌\r\n        this.node.on('gang_notify_push',function(data){\r\n            console.log('==>Gmae gang_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            //var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            //self.playEffect(localIndex,\"play_gang\");\r\n            //th.audioManager.playSFX(\"nv/gang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //喊杠\r\n        this.node.on('hangang_notify_push',function(data){\r\n            console.log('==>Gmae hangang_notify_push:',JSON.stringify(data.detail));\r\n            var seatIndex = th.socketIOManager.getSeatIndexById(data.detail.userId);\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self.playEffect(localIndex,data.detail.gangType==\"angang\"?\"play_angang\":\"play_gang\");\r\n            th.audioManager.playSFX(\"nv/gang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //出牌\r\n        this.node.on('chupai_notify_push',function(data){\r\n            //console.log('==>Gmae chupai_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData = data.detail.seatData;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            self.showChupai();\r\n            var audioUrl = th.mahjongManager.getAudioURLByMJID(data.detail.pai);\r\n            th.audioManager.playSFX(audioUrl);\r\n        });\r\n        //摸牌只有自己才会收到此消息\r\n        this.node.on('mopai_push',function(data){\r\n            self.hideChupai();\r\n            data = data.detail;\r\n            var pai = data.pai;\r\n            var localIndex = th.socketIOManager.getLocalIndex(data.seatIndex);\r\n            if(localIndex == 0){\r\n                var index = 13;\r\n                var sprite=self._mymjs[index];\r\n                sprite.node.mjid = pai;\r\n                self.setSpriteFrameByMJID(\"M_\",sprite,pai);\r\n                var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n                gold_icon.active=pai==th.socketIOManager.caishen;\r\n\r\n            }else if(false){\r\n                //todo 重放\r\n            }\r\n        });\r\n        //胡牌\r\n        this.node.on('hu_push',function(data){\r\n            console.log('==>Gmae hu_push:',JSON.stringify(data.detail));\r\n\r\n            var data = data.detail;\r\n            var seatIndex = data.seatIndex;\r\n            var localIndex =th.socketIOManager.getLocalIndex(seatIndex);\r\n            var nodeHupai=self._hupaiTips[localIndex];\r\n            nodeHupai.active=true;\r\n\r\n            if(localIndex == 0){\r\n                self.hideOptions();\r\n            }\r\n            var seatData = th.socketIOManager.seats[seatIndex];\r\n            seatData.isHu = true;\r\n\r\n            nodeHupai.getChildByName(\"hu\").active = !data.isZimo;\r\n            nodeHupai.getChildByName(\"zimo\").active = data.isZimo;\r\n            //todo 回放\r\n            self.playEffect(localIndex,data.isZimo ? \"play_zimo\":\"play_hu\");\r\n            th.audioManager.playSFX(\"nv/hu.mp3\");\r\n        });\r\n        this.node.on('clean_push',function(){\r\n            console.log('==>Gmae clean_push:');\r\n            //隐藏自己牌\r\n            var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n            //隐藏其他玩家手上的牌\r\n            for(var i=0;i<sides.length;i++){\r\n                var seatNode=self.node.getChildByName(sides[i]);\r\n                var mjs=seatNode.getChildByName('Holds').children;\r\n                for(var j=0;j<mjs.length;j++){\r\n                    var sprite = mjs[j].getComponent(cc.Sprite);\r\n                    sprite.node.active=false;\r\n                    sprite.spriteFrame = null;\r\n                }\r\n\r\n                //出牌\r\n                var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n                spriteChupai.node.active=false;\r\n                spriteChupai.spriteFrame = null;\r\n                //胡牌NODE\r\n                var nodeHupai=seatNode.getChildByName('Hupai');\r\n                nodeHupai.active=false;\r\n            }\r\n            self.nodeGameInfo.active=false;\r\n            self.hideChupai();\r\n            self.hideOptions();\r\n        });\r\n        this.node.on('repeat_login',function(){\r\n            th.alert.show(\"提示\",\"您的账号已在别处登录！\",function(){\r\n                th.wc.show('正在返回登录场景');\r\n                cc.director.loadScene(\"login\");\r\n            },false);\r\n        });\r\n\r\n    },\r\n    playEffect:function(index,name){\r\n        this._effects[index].node.active = true;\r\n        this._effects[index].play(name);\r\n    },\r\n    initDragStuffs:function(node){\r\n        node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            \r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            node.interactable = node.getComponent(cc.Button).interactable;\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_START\");\r\n            this.chupaidian.node.active=false;\r\n            this.chupaidian.spriteFrame=node.getComponent(cc.Sprite).spriteFrame;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n\r\n            var gold_icon=this.chupaidian.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=node.mjid==th.socketIOManager.caishen;\r\n\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            if (Math.abs(event.getDeltaX()) + Math.abs(event.getDeltaY()) < 0.5) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_MOVE, Y:\",event.getLocationY());\r\n            this.chupaidian.node.active=true;\r\n            node.opacity = 150;\r\n            this.chupaidian.node.opacity = 255;\r\n            this.chupaidian.node.scaleX = 1;\r\n            this.chupaidian.node.scaleY = 1;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n            node.y = 0;\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_END, Y:\",event.getLocationY());\r\n            this.chupaidian.node.active=false;\r\n            node.opacity = 255;\r\n            if (event.getLocationY() >= 200) {\r\n                console.log(\"chupai :\",node.mjid);\r\n                this.shoot(node.mjid);\r\n            }\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_CANCEL, Y:\",event.getLocationY());\r\n            if (event.getLocationY() >= 200) {\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n                console.log(\"chupai :\",node.mjid);\r\n                this.shoot(node.mjid);\r\n            }else{\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n            }\r\n        }.bind(this));\r\n        \r\n    },\r\n    onGameBegin:function(){\r\n        //隐藏每个座位上的动画sprite\r\n        for(var i = 0; i < this._effects.length; i++){\r\n            this._effects[i].node.active = false;\r\n        }\r\n\r\n        //自摸胡判断\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i); \r\n            var nodeHupai = this._hupaiTips[localIndex];\r\n            nodeHupai.active = seatData.isHu;\r\n            if(seatData.isHu){\r\n                nodeHupai.getChildByName(\"hu\").active = !seatData.isZimo;\r\n                nodeHupai.getChildByName(\"zimo\").active = seatData.isZimo;\r\n            }\r\n            //todo 如果有胡牌信息\r\n\r\n        }\r\n        //隐藏各座位出牌点\r\n        this.hideChupai();\r\n        //隐藏当前玩家所有操作（吃，碰，杠，胡，弃）\r\n        this.hideOptions();\r\n        \r\n        this.btnReady.node.active = th.socketIOManager.status == \"idle\" && !th.socketIOManager.seats[th.socketIOManager.seatIndex].ready;\r\n        \r\n        //todo 判断是否回放  //&& cc.vv.replayMgr.isReplay() == false\r\n        if(th.socketIOManager.status == \"idle\" ){\r\n            return;\r\n        }\r\n\r\n        this.setSpriteFrameByMJID(\"M_\", this.spriteCaishen,th.socketIOManager.caishen);\r\n        this.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        this.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n        //初始化其他玩家手上的牌\r\n        var sides = [\"right\",\"up\",\"left\"];        \r\n        for(var i = 0; i < sides.length; ++i){\r\n            var holds = this.node.getChildByName(sides[i]).getChildByName(\"Holds\");\r\n            for(var j = 0; j < holds.childrenCount; ++j){\r\n                var nc = holds.children[j];\r\n                nc.active = true;\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;\r\n                var sprite = nc.getComponent(cc.Sprite); \r\n                sprite.spriteFrame =th.mahjongManager.holdsEmpty[i+1];\r\n            }            \r\n        }\r\n\r\n        this.nodePrepare.active=false;\r\n        this.nodeGameInfo.active=true;\r\n\r\n        this.initMahjongs();\r\n\r\n        //初始化其他玩家的牌\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i);\r\n            if(localIndex != 0){\r\n                this.initOtherMahjongs(seatData);\r\n                if(i == th.socketIOManager.turn){\r\n                    this.initMopai(i,-1);\r\n                }else{\r\n                    this.initMopai(i,null);    \r\n                }\r\n            }\r\n        }\r\n        this.showChupai();\r\n        if(th.socketIOManager.actions != null){\r\n            this.showAction(th.socketIOManager.actions);\r\n            th.socketIOManager.actions = null;\r\n        }\r\n\r\n    },\r\n    onMJClicked:function(event){\r\n        if(th.socketIOManager.turn != th.socketIOManager.seatIndex){\r\n            return;\r\n        }\r\n        for(var i = 0; i < this._mymjs.length; ++i){\r\n            if(event.target == this._mymjs[i].node){\r\n                //如果是再次点击，则出牌\r\n                if(event.target == this._selectedMJ){\r\n                    console.log(\"chupai :\",this._selectedMJ.mjid);\r\n                    this.shoot(this._selectedMJ.mjid); \r\n                    this._selectedMJ.y = 0;\r\n                    this._selectedMJ = null;\r\n                    return;\r\n                }\r\n                if(this._selectedMJ != null){\r\n                    this._selectedMJ.y = 0;\r\n                }\r\n                event.target.y = 15;\r\n                this._selectedMJ = event.target;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    onOptionClicked:function(event){\r\n        if(event.target.name == \"btnPeng\"){\r\n            th.sio.send(\"peng\");\r\n        }else if(event.target.name == \"btnGang\"){\r\n            th.sio.send(\"gang\",event.target.pai);\r\n        }else if(event.target.name == \"btnHu\"){\r\n            th.sio.send(\"hu\");\r\n        }else if(event.target.name == \"btnChi\"){\r\n            th.sio.send(\"chi\",event.target.pais);\r\n        }else if(event.target.name == \"btnGuo\"){\r\n            if(th.socketIOManager.turn==th.socketIOManager.seatIndex){\r\n                this.optionsWin.active = true;\r\n            }\r\n            th.sio.send(\"guo\");\r\n        }\r\n    },\r\n    //出牌\r\n    shoot:function(mjid){\r\n        if(mjid == null){\r\n            return;\r\n        }\r\n        th.sio.send('chupai',mjid);\r\n    },\r\n    getMJIndex:function(side,index){\r\n        if(side == \"right\" || side == \"up\"){\r\n            return 13 - index;\r\n        }\r\n        return index;\r\n    },\r\n    initMopai:function(seatIndex,pai){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n        var side =th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lastIndex = this.getMJIndex(side,13);\r\n        var nc = holds.children[lastIndex];\r\n\r\n        nc.scaleX = 1.0;\r\n        nc.scaleY = 1.0;\r\n        if(pai == null){\r\n            nc.active = false;\r\n        }else if(pai >= 0){\r\n            nc.active = true;\r\n            //游戏回放时用到\r\n            if(side == \"up\"){\r\n                nc.scaleX = 0.73;\r\n                nc.scaleY = 0.73;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,pai);\r\n        } else if(pai != null){\r\n            nc.active = true;\r\n            //UP方向正常抓牌是-1\r\n            if(side == \"up\"){\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getHoldsEmptySpriteFrame(side);\r\n        }\r\n    },\r\n    hideChupai:function(){\r\n        for(var i = 0; i < this._chupais.length;i++){\r\n            this._chupais[i].node.active = false;\r\n        }     \r\n    },\r\n    showChupai:function(){\r\n        var pai = th.socketIOManager.chupai; \r\n        if( pai >=0){\r\n            var localIndex = th.socketIOManager.getLocalIndex(th.socketIOManager.turn);\r\n            var sprite = this._chupais[localIndex];\r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n            sprite.node.active = true;\r\n\r\n            var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=pai==th.socketIOManager.caishen;\r\n        }\r\n    },\r\n    addOption:function(btnName,pai){\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var child = options.children[i];\r\n            if(child.name=='Option' && child.active==false){\r\n                child.active=true;\r\n                var option=child.getChildByName('Option');\r\n                if(btnName!='btnChi'){\r\n                    var sprite = option.getChildByName(\"opTarget1\").getComponent(cc.Sprite);\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n                    sprite.node.active=true;\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pai = pai;\r\n                }else{\r\n                    var pais=[];\r\n                    for(var i=0;i<pai.length;i++){\r\n                        if(pai[i]!=-1){\r\n                            pais.push(pai[i]);\r\n                            var sprite = option.getChildByName(\"opTarget\"+pais.length).getComponent(cc.Sprite);\r\n                            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai[i]);\r\n                            sprite.node.active=true;\r\n                        }\r\n                    }\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pais = pai.join(\",\");\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    },\r\n    showAction:function(data){\r\n        if(this.optionsWin.active){\r\n            this.hideOptions();\r\n        }\r\n        //todo \r\n        if(data && (data.hu || data.gang || data.peng || data.chi)){\r\n            this.optionsWin.active = true;\r\n            if(data.hu){\r\n                this.addOption(\"btnHu\",data.huPai);\r\n            }\r\n            if(data.peng){\r\n                this.addOption(\"btnPeng\",data.pengPai);\r\n            }\r\n            if(data.chi){\r\n                for(var i = 0; i < data.chiPai.length;++i){\r\n                    var pais = data.chiPai[i];\r\n                    this.addOption(\"btnChi\",pais);\r\n                }\r\n            }\r\n            if(data.gang){\r\n                for(var i = 0; i < data.gangPai.length;++i){\r\n                    var gp = data.gangPai[i];\r\n                    this.addOption(\"btnGang\",gp);\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    initMahjongs:function(){\r\n        //手上麻将\r\n        var seats=th.socketIOManager.seats;\r\n        var seatData=seats[th.socketIOManager.seatIndex];\r\n        var holds=seatData.holds;\r\n        if(holds == null){\r\n            return;\r\n        }\r\n        //排序\r\n        holds=this.sortHolds(holds);\r\n\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        //初始化手牌\r\n        for(var i=0;i<holds.length;i++){\r\n            var mjid = holds[i];\r\n            var sprite=this._mymjs[lackingNum+i];\r\n            sprite.node.mjid = mjid;\r\n            this.setSpriteFrameByMJID(\"M_\",sprite,mjid);\r\n\r\n            var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=mjid==th.socketIOManager.caishen;\r\n\r\n            sprite.node.y=0;\r\n        }\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjid = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n            sprite.node.y=0;\r\n        }\r\n        for(var i = lackingNum + holds.length; i < this._mymjs.length; ++i){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjid = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;  \r\n            sprite.node.y=0;          \r\n        }\r\n    },\r\n    initOtherMahjongs:function(seatData){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n        if(localIndex == 0){\r\n            return;\r\n        }\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var sideHolds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var idx = this.getMJIndex(side,i);\r\n            sideHolds.children[idx].active = false;\r\n        }\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.sortHolds(seatData.holds);\r\n        if(holds != null && holds.length > 0){\r\n            for(var i = 0; i < holds.length; i++){\r\n                var idx = this.getMJIndex(side,i + lackingNum);\r\n                var sprite = sideHolds.children[idx].getComponent(cc.Sprite);\r\n                if(side == \"up\"){\r\n                    sprite.node.scaleX = 0.73;\r\n                    sprite.node.scaleY = 0.73;                    \r\n                }\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,holds[i]);\r\n            }\r\n\r\n            if(holds.length + lackingNum == 13){\r\n                var lasetIdx = this.getMJIndex(side,13);\r\n                sideHolds.children[lasetIdx].active = false;\r\n            }\r\n        }\r\n\r\n    },\r\n    sortHolds:function(holds){\r\n        if(holds==null){\r\n            return holds;\r\n        }\r\n        holds.sort(function(a,b){\r\n            var aa=a;\r\n            var bb=b;\r\n            if(aa==th.socketIOManager.caishen){\r\n                aa=aa-100;\r\n            }\r\n            if(bb==th.socketIOManager.caishen){\r\n                bb=bb-100;\r\n            }\r\n            return aa-bb;\r\n        });\r\n        return holds;\r\n    },\r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n    hideOptions:function(data){\r\n        this.optionsWin.active=false;\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var child = options.children[i];\r\n            if(child.name=='Option'){\r\n                child.active=false;\r\n                var option=child.getChildByName('Option');\r\n                option.getChildByName('opTarget1').active=false;\r\n                option.getChildByName('opTarget2').active=false;\r\n                var btns=option.getChildByName('btns');\r\n                btns.getChildByName('btnChi').active=false;\r\n                btns.getChildByName('btnPeng').active=false;\r\n                btns.getChildByName('btnGang').active=false;\r\n                btns.getChildByName('btnHu').active=false;\r\n            }\r\n        }\r\n    },\r\n    checkIp:function(){\r\n        console.log('==>MJGame check_ip:');\r\n    }\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n});\r\n"]}