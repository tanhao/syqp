{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblRoundCount","spriteCaishen","Sprite","btnReady","Button","btnGang","btnPeng","btnChi","btnHu","btnGuo","chupaidian","settingWin","Node","optionsWin","nodePrepare","nodeGameInfo","_mymjs","_effects","_chupais","_hupaiTips","onLoad","th","addComponent","initView","initEventHandlers","active","onGameBegin","audioManager","playBGM","node","myHolds","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","initDragStuffs","realwidth","director","getVisibleSize","width","scaleX","scaleY","sides","i","mjs","seatNode","spriteChupai","nodeHupai","socketIOManager","seats","animation","Animation","hideOptions","self","dataEventHandler","on","data","console","log","JSON","stringify","detail","seat","round","ready","initMahjongs","target","string","mjsy","config","setSpriteFrameByMJID","caishen","hideChupai","last","seatIndex","initMopai","turn","showAction","seatData","index","playSFX","initOtherMahjongs","localIndex","getLocalIndex","playEffect","getSeatIndexById","userId","gangType","showChupai","audioUrl","mahjongManager","getAudioURLByMJID","pai","mjid","gold_icon","isHu","isZimo","name","play","EventType","TOUCH_START","event","interactable","x","getLocationX","y","getLocationY","height","bind","TOUCH_MOVE","Math","abs","getDeltaX","getDeltaY","opacity","TOUCH_END","shoot","TOUCH_CANCEL","status","holds","childrenCount","nc","holdsEmpty","actions","onMJClicked","_selectedMJ","onOptionClicked","sio","send","pais","getMJIndex","side","getSide","pre","getFoldPre","lastIndex","getSpriteFrameByMJID","getHoldsEmptySpriteFrame","chupai","addOption","btnName","options","child","option","btns","btn","join","hu","gang","peng","chi","huPai","pengPai","chiPai","gangPai","gp","sort","a","b","sortHolds","lackingNum","pengs","angangs","diangangs","bugangs","chis","sideHolds","idx","lasetIdx","aa","bb"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        spriteCaishen:cc.Sprite,\r\n        btnReady:cc.Button,\r\n        btnGang:cc.Button,\r\n        btnPeng:cc.Button,\r\n        btnChi:cc.Button,\r\n        btnHu:cc.Button,\r\n        btnGuo:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        optionsWin:cc.Node,    ///所有可以做的操作节点\r\n        nodePrepare:cc.Node,\r\n        nodeGameInfo:cc.Node,\r\n\r\n        _mymjs:[],      //自己手上的牌Sprite结合\r\n        _effects:[],    //每个座位动画节点（Animation）\r\n        _chupais:[],    //每个座位出牌节点（Sprite）\r\n        _hupaiTips:[],  //每个座位胡牌提示节点:自摸，胡（抢杠胡）\r\n    },\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.addComponent(\"MJChiPengGangs\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n\r\n        this.nodePrepare.active=true;\r\n        this.nodeGameInfo.active=false;\r\n\r\n        this.onGameBegin();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n    initView:function(){\r\n        //把自己的牌都设置为null\r\n\r\n        this.chupaidian.node.active=false;\r\n\r\n        var myHolds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<myHolds.children.length;j++){\r\n                var sprite = myHolds.children[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n                //todo添加拖动效果\r\n                this.initDragStuffs(sprite.node);\r\n        }\r\n\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        myHolds.scaleX *= realwidth/1280;\r\n        myHolds.scaleY *= realwidth/1280;  \r\n        \r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        //隐藏其他玩家手上的牌\r\n       \r\n        for(var i=1;i<sides.length;i++){\r\n            var mjs=this.node.getChildByName(sides[i]).getChildByName('Holds').children;\r\n            for(var j=0;j<mjs.length;j++){\r\n                var sprite = mjs[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n            }\r\n        }\r\n        for(var i=0;i<sides.length;i++){\r\n            var seatNode=this.node.getChildByName(sides[i]);\r\n            //出牌\r\n            var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n            spriteChupai.node.active=false;\r\n            spriteChupai.spriteFrame = null;\r\n            //胡牌NODE\r\n            var nodeHupai=seatNode.getChildByName('Hupai');\r\n            nodeHupai.active=false;\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            //操作效果\r\n            var animation=seatNode.getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animation);\r\n            this._chupais.push(spriteChupai);\r\n\r\n            this._hupaiTips.push(nodeHupai);\r\n            \r\n        }\r\n        this.hideOptions();\r\n    },\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n        //检查IP\r\n        this.node.on('check_ip', function (data) {\r\n            console.log('==>MJGame check_ip:',JSON.stringify(data.detail));\r\n        });\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(data){\r\n            console.log('==>Gmae ready_result:',JSON.stringify(data.detail));\r\n            var seat=data.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n        })\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(data){\r\n            console.log('==>Gmae holds_push:',JSON.stringify(data.detail));\r\n            self.initMahjongs();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n                //todo\r\n            }\r\n        })\r\n        //断线\r\n        this.node.on('disconnect', function (data) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(data.detail));\r\n        });\r\n        //通知还剩多少张牌\r\n         this.node.on(\"mjsy_push\",function(target){\r\n            //console.log('==>Gmae mjsy_push:',JSON.stringify(target.detail));\r\n            self.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n        })\r\n        //通知当前是第几局\r\n        this.node.on(\"round_push\",function(data){\r\n            console.log('==>Gmae round_push:',JSON.stringify(data.detail));\r\n            self.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        })\r\n        //通知当前是第几局\r\n        this.node.on(\"caishen_push\",function(data){\r\n            console.log('==>Gmae caishen_push:',JSON.stringify(data.detail));\r\n            self.setSpriteFrameByMJID(\"M_\", self.spriteCaishen,th.socketIOManager.caishen);\r\n        })\r\n        this.node.on('begin_push',function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n            //第一把开局，要提示\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        });\r\n        this.node.on('chupai_push',function(data){\r\n            console.log('==>Gmae chupai_push:',JSON.stringify(data.detail));\r\n            data = data.detail;\r\n            self.hideChupai();\r\n            if(data.last != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.last,null);   \r\n            }\r\n            //todo 回放\r\n            if( data.turn != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.turn,-1);\r\n            }\r\n            \r\n        });\r\n        this.node.on('action_push',function(data){\r\n            console.log('==>Gmae action_push:',JSON.stringify(data.detail));\r\n            self.showAction(data.detail);\r\n        });\r\n        //过，自己操做过返回结果\r\n        this.node.on('guo_result',function(data){\r\n            self.hideChupai();\r\n        });\r\n        //过牌，\r\n        this.node.on('guo_notify_push',function(data){\r\n            //console.log('==>Gmae guo_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            self.hideOptions();\r\n            var seatData=data.detail;\r\n            //如果是自己，则刷新手牌\r\n            if(seatData.index ==th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            th.audioManager.playSFX(\"give.mp3\");\r\n        });\r\n        //吃牌\r\n        this.node.on('chi_notify_push',function(data){\r\n            console.log('==>Gmae chi_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_chi\");\r\n            th.audioManager.playSFX(\"nv/chi.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //碰牌\r\n        this.node.on('peng_notify_push',function(data){\r\n            console.log('==>Gmae peng_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_peng\");\r\n            th.audioManager.playSFX(\"nv/peng.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //杠牌\r\n        this.node.on('gang_notify_push',function(data){\r\n            console.log('==>Gmae gang_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            //var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            //self.playEffect(localIndex,\"play_gang\");\r\n            //th.audioManager.playSFX(\"nv/gang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //喊杠\r\n        this.node.on('hangang_notify_push',function(data){\r\n            console.log('==>Gmae hangang_notify_push:',JSON.stringify(data.detail));\r\n            var seatIndex = th.socketIOManager.getSeatIndexById(data.detail.userId);\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self.playEffect(localIndex,data.detail.gangType==\"angang\"?\"play_angang\":\"play_gang\");\r\n            th.audioManager.playSFX(\"nv/gang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //出牌\r\n        this.node.on('chupai_notify_push',function(data){\r\n            //console.log('==>Gmae chupai_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData = data.detail.seatData;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            self.showChupai();\r\n            var audioUrl = th.mahjongManager.getAudioURLByMJID(data.detail.pai);\r\n            th.audioManager.playSFX(audioUrl);\r\n        });\r\n        //摸牌只有自己才会收到此消息\r\n        this.node.on('mopai_push',function(data){\r\n            self.hideChupai();\r\n            data = data.detail;\r\n            var pai = data.pai;\r\n            var localIndex = th.socketIOManager.getLocalIndex(data.seatIndex);\r\n            if(localIndex == 0){\r\n                var index = 13;\r\n                var sprite=self._mymjs[index];\r\n                sprite.node.mjid = pai;\r\n                self.setSpriteFrameByMJID(\"M_\",sprite,pai);\r\n                var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n                gold_icon.active=pai==th.socketIOManager.caishen;\r\n\r\n            }else if(false){\r\n                //todo 重放\r\n            }\r\n        });\r\n        //胡牌\r\n        this.node.on('hu_push',function(data){\r\n            console.log('==>Gmae hu_push:',JSON.stringify(data.detail));\r\n\r\n            var data = data.detail;\r\n            var seatIndex = data.seatIndex;\r\n            var localIndex =th.socketIOManager.getLocalIndex(seatIndex);\r\n            var nodeHupai=self._hupaiTips[localIndex];\r\n            nodeHupai.active=true;\r\n\r\n            if(localIndex == 0){\r\n                self.hideOptions();\r\n            }\r\n            var seatData = th.socketIOManager.seats[seatIndex];\r\n            seatData.isHu = true;\r\n\r\n            nodeHupai.getChildByName(\"hu\").active = !data.isZimo;\r\n            nodeHupai.getChildByName(\"zimo\").active = data.isZimo;\r\n            //todo 回放\r\n            self.playEffect(localIndex,data.isZimo ? \"play_zimo\":\"play_hu\");\r\n            th.audioManager.playSFX(\"nv/hu.mp3\");\r\n        });\r\n\r\n    },\r\n    playEffect:function(index,name){\r\n        this._effects[index].node.active = true;\r\n        this._effects[index].play(name);\r\n    },\r\n    initDragStuffs:function(node){\r\n        node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            \r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            node.interactable = node.getComponent(cc.Button).interactable;\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_START\");\r\n            this.chupaidian.node.active=false;\r\n            this.chupaidian.spriteFrame=node.getComponent(cc.Sprite).spriteFrame;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n\r\n            var gold_icon=this.chupaidian.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=node.mjid==th.socketIOManager.caishen;\r\n\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            if (Math.abs(event.getDeltaX()) + Math.abs(event.getDeltaY()) < 0.5) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_MOVE, Y:\",event.getLocationY());\r\n            this.chupaidian.node.active=true;\r\n            node.opacity = 150;\r\n            this.chupaidian.node.opacity = 255;\r\n            this.chupaidian.node.scaleX = 1;\r\n            this.chupaidian.node.scaleY = 1;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n            node.y = 0;\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_END, Y:\",event.getLocationY());\r\n            this.chupaidian.node.active=false;\r\n            node.opacity = 255;\r\n            if (event.getLocationY() >= 200) {\r\n                console.log(\"chupai :\",node.mjid);\r\n                this.shoot(node.mjid);\r\n            }\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //console.log(\"cc.Node.EventType.TOUCH_CANCEL, Y:\",event.getLocationY());\r\n            if (event.getLocationY() >= 200) {\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n                console.log(\"chupai :\",node.mjid);\r\n                this.shoot(node.mjid);\r\n            }else{\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n            }\r\n        }.bind(this));\r\n        \r\n    },\r\n    onGameBegin:function(){\r\n        //隐藏每个座位上的动画sprite\r\n        for(var i = 0; i < this._effects.length; i++){\r\n            this._effects[i].node.active = false;\r\n        }\r\n\r\n        //自摸胡判断\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i); \r\n            var nodeHupai = this._hupaiTips[localIndex];\r\n            nodeHupai.active = seatData.isHu;\r\n            if(seatData.isHu){\r\n                nodeHupai.getChildByName(\"hu\").active = !seatData.isZimo;\r\n                nodeHupai.getChildByName(\"zimo\").active = seatData.isZimo;\r\n            }\r\n            //todo 如果有胡牌信息\r\n\r\n        }\r\n        //隐藏各座位出牌点\r\n        this.hideChupai();\r\n        //隐藏当前玩家所有操作（吃，碰，杠，胡，弃）\r\n        this.hideOptions();\r\n        \r\n        //todo 判断是否回放  //&& cc.vv.replayMgr.isReplay() == false\r\n        if(th.socketIOManager.status == \"idle\" ){\r\n            return;\r\n        }\r\n        //初始化其他玩家手上的牌\r\n        var sides = [\"right\",\"up\",\"left\"];        \r\n        for(var i = 0; i < sides.length; ++i){\r\n            var holds = this.node.getChildByName(sides[i]).getChildByName(\"Holds\");\r\n            for(var j = 0; j < holds.childrenCount; ++j){\r\n                var nc = holds.children[j];\r\n                nc.active = true;\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;\r\n                var sprite = nc.getComponent(cc.Sprite); \r\n                sprite.spriteFrame =th.mahjongManager.holdsEmpty[i+1];\r\n            }            \r\n        }\r\n\r\n        this.nodePrepare.active=false;\r\n        this.nodeGameInfo.active=true;\r\n\r\n        this.initMahjongs();\r\n\r\n        //初始化其他玩家的牌\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i);\r\n            if(localIndex != 0){\r\n                this.initOtherMahjongs(seatData);\r\n                if(i == th.socketIOManager.turn){\r\n                    this.initMopai(i,-1);\r\n                }else{\r\n                    this.initMopai(i,null);    \r\n                }\r\n            }\r\n        }\r\n        this.showChupai();\r\n        if(th.socketIOManager.actions != null){\r\n            this.showAction(th.socketIOManager.actions);\r\n            this.socketIOManager.actions = null;\r\n        }\r\n\r\n    },\r\n    onMJClicked:function(event){\r\n        if(th.socketIOManager.turn != th.socketIOManager.seatIndex){\r\n            return;\r\n        }\r\n        for(var i = 0; i < this._mymjs.length; ++i){\r\n            if(event.target == this._mymjs[i].node){\r\n                //如果是再次点击，则出牌\r\n                if(event.target == this._selectedMJ){\r\n                    console.log(\"chupai :\",this._selectedMJ.mjid);\r\n                    this.shoot(this._selectedMJ.mjid); \r\n                    this._selectedMJ.y = 0;\r\n                    this._selectedMJ = null;\r\n                    return;\r\n                }\r\n                if(this._selectedMJ != null){\r\n                    this._selectedMJ.y = 0;\r\n                }\r\n                event.target.y = 15;\r\n                this._selectedMJ = event.target;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    onOptionClicked:function(event){\r\n        if(event.target.name == \"btnPeng\"){\r\n            th.sio.send(\"peng\");\r\n        }else if(event.target.name == \"btnGang\"){\r\n            th.sio.send(\"gang\",event.target.pai);\r\n        }else if(event.target.name == \"btnHu\"){\r\n            th.sio.send(\"hu\");\r\n        }else if(event.target.name == \"btnChi\"){\r\n            th.sio.send(\"chi\",event.target.pais);\r\n        }else if(event.target.name == \"btnGuo\"){\r\n            th.sio.send(\"guo\");\r\n        }\r\n    },\r\n    //出牌\r\n    shoot:function(mjid){\r\n        if(mjid == null){\r\n            return;\r\n        }\r\n        th.sio.send('chupai',mjid);\r\n    },\r\n    getMJIndex:function(side,index){\r\n        if(side == \"right\" || side == \"up\"){\r\n            return 13 - index;\r\n        }\r\n        return index;\r\n    },\r\n    initMopai:function(seatIndex,pai){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n        var side =th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lastIndex = this.getMJIndex(side,13);\r\n        var nc = holds.children[lastIndex];\r\n\r\n        nc.scaleX = 1.0;\r\n        nc.scaleY = 1.0;\r\n        if(pai == null){\r\n            nc.active = false;\r\n        }else if(pai >= 0){\r\n            nc.active = true;\r\n            //游戏回放时用到\r\n            if(side == \"up\"){\r\n                nc.scaleX = 0.73;\r\n                nc.scaleY = 0.73;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,pai);\r\n        } else if(pai != null){\r\n            nc.active = true;\r\n            //UP方向正常抓牌是-1\r\n            if(side == \"up\"){\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getHoldsEmptySpriteFrame(side);\r\n        }\r\n    },\r\n    hideChupai:function(){\r\n        for(var i = 0; i < this._chupais.length;i++){\r\n            this._chupais[i].node.active = false;\r\n        }     \r\n    },\r\n    showChupai:function(){\r\n        var pai = th.socketIOManager.chupai; \r\n        if( pai >=0){\r\n            var localIndex = th.socketIOManager.getLocalIndex(th.socketIOManager.turn);\r\n            var sprite = this._chupais[localIndex];\r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n            sprite.node.active = true;\r\n\r\n            var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=pai==th.socketIOManager.caishen;\r\n        }\r\n    },\r\n    addOption:function(btnName,pai){\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var child = options.children[i];\r\n            if(child.name=='Option' && child.active==false){\r\n                child.active=true;\r\n                var option=child.getChildByName('Option');\r\n                if(btnName!='btnChi'){\r\n                    var sprite = option.getChildByName(\"opTarget1\").getComponent(cc.Sprite);\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n                    sprite.node.active=true;\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pai = pai;\r\n                }else{\r\n                    var pais=[];\r\n                    for(var i=0;i<pai.length;i++){\r\n                        if(pai[i]!=-1){\r\n                            pais.push(pai[i]);\r\n                            var sprite = option.getChildByName(\"opTarget\"+pais.length).getComponent(cc.Sprite);\r\n                            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai[i]);\r\n                            sprite.node.active=true;\r\n                        }\r\n                    }\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pais = pai.join(\",\");\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    },\r\n    showAction:function(data){\r\n        if(this.optionsWin.active){\r\n            this.hideOptions();\r\n        }\r\n        //todo \r\n        if(data && (data.hu || data.gang || data.peng || data.chi)){\r\n            this.optionsWin.active = true;\r\n            if(data.hu){\r\n                this.addOption(\"btnHu\",data.huPai);\r\n            }\r\n            if(data.peng){\r\n                this.addOption(\"btnPeng\",data.pengPai);\r\n            }\r\n            if(data.chi){\r\n                for(var i = 0; i < data.chiPai.length;++i){\r\n                    var pais = data.chiPai[i];\r\n                    this.addOption(\"btnChi\",pais);\r\n                }\r\n            }\r\n            if(data.gang){\r\n                for(var i = 0; i < data.gangPai.length;++i){\r\n                    var gp = data.gangPai[i];\r\n                    this.addOption(\"btnGang\",gp);\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    initMahjongs:function(){\r\n        //手上麻将\r\n        var seats=th.socketIOManager.seats;\r\n        var seatData=seats[th.socketIOManager.seatIndex];\r\n        var holds=seatData.holds;\r\n        if(holds == null){\r\n            return;\r\n        }\r\n        //排序\r\n        holds.sort(function(a,b){return a-b});\r\n        \r\n        holds=this.sortHolds(holds);\r\n\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        //初始化手牌\r\n        for(var i=0;i<holds.length;i++){\r\n            var mjid = holds[i];\r\n            var sprite=this._mymjs[lackingNum+i];\r\n            sprite.node.mjid = mjid;\r\n            this.setSpriteFrameByMJID(\"M_\",sprite,mjid);\r\n\r\n            var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=mjid==th.socketIOManager.caishen;\r\n\r\n            sprite.node.y=0;\r\n        }\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjid = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n            sprite.node.y=0;\r\n        }\r\n        for(var i = lackingNum + holds.length; i < this._mymjs.length; ++i){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjid = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;  \r\n            sprite.node.y=0;          \r\n        }\r\n    },\r\n    initOtherMahjongs:function(seatData){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n        if(localIndex == 0){\r\n            return;\r\n        }\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var sideHolds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var idx = this.getMJIndex(side,i);\r\n            sideHolds.children[idx].active = false;\r\n        }\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.sortHolds(seatData.holds);\r\n        if(holds != null && holds.length > 0){\r\n            for(var i = 0; i < holds.length; i++){\r\n                var idx = this.getMJIndex(side,i + lackingNum);\r\n                var sprite = sideHolds.children[idx].getComponent(cc.Sprite);\r\n                if(side == \"up\"){\r\n                    sprite.node.scaleX = 0.73;\r\n                    sprite.node.scaleY = 0.73;                    \r\n                }\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,holds[i]);\r\n            }\r\n\r\n            if(holds.length + lackingNum == 13){\r\n                var lasetIdx = this.getMJIndex(side,13);\r\n                sideHolds.children[lasetIdx].active = false;\r\n            }\r\n        }\r\n\r\n    },\r\n    sortHolds:function(holds){\r\n        if(holds==null){\r\n            return holds;\r\n        }\r\n        holds.sort(function(a,b){\r\n            var aa=a;\r\n            var bb=b;\r\n            if(aa==th.socketIOManager.caishen){\r\n                aa=aa-100;\r\n            }\r\n            if(bb==th.socketIOManager.caishen){\r\n                bb=bb-100;\r\n            }\r\n            return aa-bb;\r\n        });\r\n        return holds;\r\n    },\r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n    hideOptions:function(data){\r\n        this.optionsWin.active=false;\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var child = options.children[i];\r\n            if(child.name=='Option'){\r\n                child.active=false;\r\n                var option=child.getChildByName('Option');\r\n                option.getChildByName('opTarget1').active=false;\r\n                option.getChildByName('opTarget2').active=false;\r\n                var btns=option.getChildByName('btns');\r\n                btns.getChildByName('btnChi').active=false;\r\n                btns.getChildByName('btnPeng').active=false;\r\n                btns.getChildByName('btnGang').active=false;\r\n                btns.getChildByName('btnHu').active=false;\r\n            }\r\n        }\r\n    },\r\n  \r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n});\r\n"]}