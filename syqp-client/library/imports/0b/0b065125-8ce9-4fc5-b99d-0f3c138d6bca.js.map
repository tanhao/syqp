{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJChiPengGangs.js"],"names":["cc","Class","extends","Component","properties","onLoad","th","self","myself","node","getChildByName","nodeChiPengGang","realwidth","director","getVisibleSize","width","scale","scaleX","scaleY","on","data","console","log","detail","onChiPengGangChanged","seatData","onGameBegin","seats","socketIOManager","i","hideSide","side","nodeSide","childrenCount","children","active","pengs","angangs","diangangs","bugangs","chis","localIndex","getLocalIndex","index","mahjongManager","getSide","pre","getFoldPre","gangs","length","mjid","initChiPengAndGangs","info","flag","nodeCPG","instantiate","pengPrefabLeft","pengPrefabSelf","y","setLocalZOrder","x","sprites","pgroot","getComponentsInChildren","Sprite","sprite","spriteFrame","getEmptySpriteFrame","getSpriteFrameByMJID","name","idx","mjids"],"mappings":"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","file":"MJChiPengGangs.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       \r\n    },\r\n\r\n    onLoad: function () {\r\n        if(th==null){\r\n            return;\r\n        }\r\n        var self = this;\r\n        var myself = this.node.getChildByName(\"myself\");\r\n        var nodeChiPengGang = myself.getChildByName(\"ChiPengGang\");\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        var scale = realwidth / 1280;\r\n        nodeChiPengGang.scaleX *= scale;\r\n        nodeChiPengGang.scaleY *= scale;\r\n\r\n        this.node.on('chi_notify_push',function(data){\r\n            console.log(\"ChiPengGang chi_notify_push\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data);\r\n        });\r\n\r\n        this.node.on('peng_notify_push',function(data){\r\n            console.log(\"ChiPengGang peng_notify_push\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data);\r\n        });\r\n        \r\n        this.node.on('gang_notify_push',function(data){\r\n            console.log(\"ChiPengGang gang_notify_push\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data.seatData);\r\n        });\r\n\r\n        this.node.on('begin_push',function(data){\r\n            self.onGameBegin();\r\n        });\r\n\r\n        var seats = th.socketIOManager.seats;\r\n        for(var i in seats){\r\n            this.onChiPengGangChanged(seats[i]);\r\n        }\r\n    },\r\n    onGameBegin:function(){\r\n        this.hideSide(\"myself\");\r\n        this.hideSide(\"right\");\r\n        this.hideSide(\"up\");\r\n        this.hideSide(\"left\");\r\n    },\r\n    hideSide:function(side){\r\n        var nodeSide = this.node.getChildByName(side);\r\n        var nodeChiPengGang = nodeSide.getChildByName(\"ChiPengGang\");\r\n        if(nodeChiPengGang){\r\n            for(var i = 0; i < nodeChiPengGang.childrenCount; ++i){\r\n                nodeChiPengGang.children[i].active = false;\r\n            }            \r\n        }\r\n    },\r\n    onChiPengGangChanged:function(seatData){\r\n        if(seatData.pengs == null && seatData.angangs == null && seatData.diangangs == null && seatData.bugangs == null && seatData.chis == null){\r\n            return;\r\n        }\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var nodeSide = this.node.getChildByName(side);\r\n        var nodeChiPengGang = nodeSide.getChildByName(\"ChiPengGang\");\r\n        for(var i = 0; i < nodeChiPengGang.childrenCount; ++i){\r\n            nodeChiPengGang.children[i].active = false;\r\n        }\r\n        //初始化杠牌\r\n        var index = 0;\r\n        var gangs = seatData.angangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"angang\");\r\n            index++;    \r\n        } \r\n        gangs = seatData.diangangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"diangang\");\r\n            index++;    \r\n        }\r\n        gangs = seatData.bugangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"bugang\");\r\n            index++;    \r\n        }\r\n        //初始化碰牌\r\n        var pengs = seatData.pengs\r\n        if(pengs){\r\n            for(var i = 0; i < pengs.length; ++i){\r\n                var mjid = pengs[i];\r\n                this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"peng\");\r\n                index++;    \r\n            }    \r\n        }  \r\n        //初始化吃的牌\r\n        var chis = seatData.pengs\r\n        if(chis){\r\n            for(var i = 0; i < chis.length; ++i){\r\n                var mjid = chis[i];\r\n                this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"chi\");\r\n                index++;    \r\n            }    \r\n        }\r\n    },\r\n    initChiPengAndGangs:function(nodeChiPengGang,side,pre,index,info,flag){\r\n        var nodeCPG = null;\r\n        if(nodeChiPengGang.childrenCount <= index){\r\n            if(side == \"left\" || side == \"right\"){\r\n                nodeCPG = cc.instantiate(th.mahjongManager.pengPrefabLeft);\r\n            }\r\n            else{\r\n                nodeCPG = cc.instantiate(th.mahjongManager.pengPrefabSelf);\r\n            }\r\n        }else{\r\n            nodeCPG = nodeChiPengGang.children[index];\r\n            nodeCPG.active = true;\r\n        }\r\n\r\n        if(side == \"left\"){\r\n            nodeCPG.y = -(index * 25 * 3);                    \r\n        }else if(side == \"right\"){\r\n            nodeCPG.y = (index * 25 * 3);\r\n            nodeCPG.setLocalZOrder(-index);\r\n        }else if(side == \"myself\"){\r\n            nodeCPG.x = index * 55 * 3 + index * 10;                    \r\n        }else{\r\n            nodeCPG.x = -(index * 55*3);\r\n        }\r\n\r\n        var sprites = pgroot.getComponentsInChildren(cc.Sprite);\r\n        if(flag==\"angang\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getEmptySpriteFrame(side);\r\n            }\r\n        }else if(flag==\"diangang\"||flag==\"bugang\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjid);    \r\n            }\r\n        }else if(flag==\"peng\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                if(sprite.node.name == \"gang\"){\r\n                    sprite.node.active = false;\r\n                }else{\r\n                    sprite.node.active = true;\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjid);    \r\n                }\r\n            }\r\n        }else if(flag==\"chi\"){\r\n            var idx=0;\r\n            for(var i = 0; i < sprites.length; i++){\r\n                if(sprite.node.name == \"gang\"){\r\n                    sprite.node.active = false;\r\n                }else{\r\n                    sprite.node.active = true;\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjids[idx]);    \r\n                    idx+=1;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n});\r\n"]}