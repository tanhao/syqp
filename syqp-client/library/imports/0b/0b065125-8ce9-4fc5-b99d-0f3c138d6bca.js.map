{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJChiPengGangs.js"],"names":["cc","Class","extends","Component","properties","onLoad","th","self","myself","node","getChildByName","nodeChiPengGang","realwidth","director","getVisibleSize","width","scale","scaleX","scaleY","on","data","console","log","detail","onChiPengGangChanged","onGameBegin","seats","socketIOManager","i","hideSide","side","nodeSide","childrenCount","children","active","seatData","pengs","angangs","diangangs","bugangs","chis","localIndex","getLocalIndex","index","mahjongManager","getSide","pre","getFoldPre","gangs","length","mjid","initChiPengAndGangs","info","flag","nodeCPG","instantiate","pengPrefabLeft","pengPrefabSelf","addChild","y","setLocalZOrder","x","sprites","getComponentsInChildren","Sprite","sprite","spriteFrame","getEmptySpriteFrame","getSpriteFrameByMJID","name","idx","mjids"],"mappings":"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","file":"MJChiPengGangs.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       \r\n    },\r\n\r\n    onLoad: function () {\r\n        if(th==null){\r\n            return;\r\n        }\r\n        var self = this;\r\n        var myself = this.node.getChildByName(\"myself\");\r\n        var nodeChiPengGang = myself.getChildByName(\"ChiPengGang\");\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        var scale = realwidth / 1280;\r\n        nodeChiPengGang.scaleX *= scale;\r\n        nodeChiPengGang.scaleY *= scale;\r\n\r\n        this.node.on('chi_notify_push',function(data){\r\n            console.log(\"==>ChiPengGang chi_notify_push\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data);\r\n        });\r\n\r\n        this.node.on('peng_notify_push',function(data){\r\n            console.log(\"==>ChiPengGang peng_notify_push\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data);\r\n        });\r\n        \r\n        this.node.on('gang_notify_push',function(data){\r\n            console.log(\"==>ChiPengGang gang_notify_push\",data.detail);\r\n            self.onChiPengGangChanged(data.detail);\r\n        });\r\n\r\n        this.node.on('begin_push',function(data){\r\n            self.onGameBegin();\r\n        });\r\n\r\n        var seats = th.socketIOManager.seats;\r\n        for(var i in seats){\r\n            this.onChiPengGangChanged(seats[i]);\r\n        }\r\n    },\r\n    onGameBegin:function(){\r\n        this.hideSide(\"myself\");\r\n        this.hideSide(\"right\");\r\n        this.hideSide(\"up\");\r\n        this.hideSide(\"left\");\r\n    },\r\n    hideSide:function(side){\r\n        var nodeSide = this.node.getChildByName(side);\r\n        var nodeChiPengGang = nodeSide.getChildByName(\"ChiPengGang\");\r\n        if(nodeChiPengGang){\r\n            for(var i = 0; i < nodeChiPengGang.childrenCount; ++i){\r\n                nodeChiPengGang.children[i].active = false;\r\n            }            \r\n        }\r\n    },\r\n    onChiPengGangChanged:function(seatData){\r\n        if(seatData.pengs == null && seatData.angangs == null && seatData.diangangs == null && seatData.bugangs == null && seatData.chis == null){\r\n            return;\r\n        }\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var nodeSide = this.node.getChildByName(side);\r\n        var nodeChiPengGang = nodeSide.getChildByName(\"ChiPengGang\");\r\n        for(var i = 0; i < nodeChiPengGang.childrenCount; ++i){\r\n            nodeChiPengGang.children[i].active = false;\r\n        }\r\n        //初始化杠牌\r\n        var index = 0;\r\n        var gangs = seatData.angangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"angang\");\r\n            index++;    \r\n        } \r\n        gangs = seatData.diangangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"diangang\");\r\n            index++;    \r\n        }\r\n        gangs = seatData.bugangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"bugang\");\r\n            index++;    \r\n        }\r\n        //初始化碰牌\r\n        var pengs = seatData.pengs\r\n        if(pengs){\r\n            for(var i = 0; i < pengs.length; ++i){\r\n                var mjid = pengs[i];\r\n                this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"peng\");\r\n                index++;    \r\n            }    \r\n        }  \r\n        //初始化吃的牌\r\n        var chis = seatData.chis\r\n        if(chis){\r\n            for(var i = 0; i < chis.length; ++i){\r\n                var mjid = chis[i];\r\n                this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"chi\");\r\n                index++;    \r\n            }    \r\n        }\r\n    },\r\n    initChiPengAndGangs:function(nodeChiPengGang,side,pre,index,info,flag){\r\n        console.log(\"initChiPengAndGangs\",side,pre,index,info,flag);\r\n        var nodeCPG = null;\r\n        if(nodeChiPengGang.childrenCount <= index){\r\n            if(side == \"left\" || side == \"right\"){\r\n                nodeCPG = cc.instantiate(th.mahjongManager.pengPrefabLeft);\r\n            }\r\n            else{\r\n                nodeCPG = cc.instantiate(th.mahjongManager.pengPrefabSelf);\r\n            }\r\n            nodeChiPengGang.addChild(nodeCPG);\r\n        }else{\r\n            nodeCPG = nodeChiPengGang.children[index];\r\n            nodeCPG.active = true;\r\n        }\r\n\r\n        if(side == \"left\"){\r\n            nodeCPG.y = -(index * 25 * 3);                    \r\n        }else if(side == \"right\"){\r\n            nodeCPG.y = (index * 25 * 3);\r\n            nodeCPG.setLocalZOrder(-index);\r\n        }else if(side == \"myself\"){\r\n            nodeCPG.x = index * 55 * 3 + index * 10;                    \r\n        }else{\r\n            nodeCPG.x = -(index * 55*3) - index * 7;\r\n        }\r\n\r\n        var sprites = nodeCPG.getComponentsInChildren(cc.Sprite);\r\n        if(flag==\"angang\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                var sprite = sprites[i];\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getEmptySpriteFrame(side);\r\n            }\r\n        }else if(flag==\"diangang\"||flag==\"bugang\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                var sprite = sprites[i];\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjid);    \r\n            }\r\n        }else if(flag==\"peng\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                var sprite = sprites[i];\r\n                if(sprite.node.name == \"gang\"){\r\n                    sprite.node.active = false;\r\n                }else{\r\n                    sprite.node.active = true;\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjid);    \r\n                }\r\n            }\r\n        }else if(flag==\"chi\"){\r\n            var idx=0;\r\n            for(var i = 0; i < sprites.length; i++){\r\n                var sprite = sprites[i];\r\n                if(sprite.node.name == \"gang\"){\r\n                    sprite.node.active = false;\r\n                }else{\r\n                    sprite.node.active = true;\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjids[idx]);    \r\n                    idx+=1;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n});\r\n"]}