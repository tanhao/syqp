{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\AnysdkManager.js"],"names":["cc","Class","extends","Component","properties","onLoad","init","ANDROID_API","IOS_API","getBatteryPercent","sys","isNative","os","OS_ANDROID","jsb","reflection","callStaticMethod","OS_IOS","login","console","log","shareWebpage","url","title","desc","isTimelineCb","shareCaptureScreen","_isCapturing","size","director","getWinSize","currentDate","Date","fileName","fullPath","fileUtils","getWritablePath","isFileExist","removeFile","texture","RenderTexture","Math","floor","width","height","setPosition","p","begin","getRunningScene","visit","end","saveToFile","IMAGE_FORMAT_JPG","self","tryTimes","fn","scale","setTimeout","onLoginResp","code","ret","errcode","localStorage","setItem","account","sign","th","userManager","onAuth","http","get"],"mappings":"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","file":"AnysdkManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        \r\n    },\r\n\r\n    onLoad: function () {\r\n    },\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n    init:function(){\r\n        this.ANDROID_API = \"org/cocos2dx/javascript/AppActivity\";\r\n        this.IOS_API = \"AppController\";\r\n    },\r\n\r\n    getBatteryPercent:function(){\r\n        if(cc.sys.isNative){\r\n            if(cc.sys.os == cc.sys.OS_ANDROID){\r\n                return jsb.reflection.callStaticMethod(this.ANDROID_API, \"getBatteryPercent\", \"()F\");\r\n            }\r\n            else if(cc.sys.os == cc.sys.OS_IOS){\r\n                return jsb.reflection.callStaticMethod(this.IOS_API, \"getBatteryPercent\");\r\n            }            \r\n        }\r\n        return 0.9;\r\n    },\r\n\r\n    login:function(){\r\n        if(cc.sys.os == cc.sys.OS_ANDROID){ \r\n            jsb.reflection.callStaticMethod(this.ANDROID_API, \"Login\", \"()V\");\r\n        }\r\n        else if(cc.sys.os == cc.sys.OS_IOS){\r\n            jsb.reflection.callStaticMethod(this.IOS_API, \"Login\");\r\n        }\r\n        else{\r\n            console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\r\n        }\r\n    },\r\n\r\n       \r\n    shareWebpage:function(url,title,desc,isTimelineCb){\r\n        if(cc.sys.os == cc.sys.OS_ANDROID){\r\n            jsb.reflection.callStaticMethod(this.ANDROID_API, \"shareWebpage\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Z)V\",url,title,desc,isTimelineCb);\r\n        }else if(cc.sys.os == cc.sys.OS_IOS){\r\n            jsb.reflection.callStaticMethod(this.IOS_API, \"shareWebpage:shareTitle:shareDesc:isTimelineCb:\",url,title,desc,isTimelineCb);\r\n        }else{\r\n            console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\r\n        }\r\n    },\r\n\r\n    shareCaptureScreen:function(isTimelineCb){\r\n        if(this._isCapturing){\r\n            return;\r\n        }\r\n        this._isCapturing = true;\r\n        var size = cc.director.getWinSize();\r\n        var currentDate = new Date();\r\n        var fileName = \"result_share.jpg\";\r\n        var fullPath = jsb.fileUtils.getWritablePath() + fileName;\r\n        if(jsb.fileUtils.isFileExist(fullPath)){\r\n            jsb.fileUtils.removeFile(fullPath);\r\n        }\r\n        var texture = new cc.RenderTexture(Math.floor(size.width), Math.floor(size.height));\r\n        texture.setPosition(cc.p(size.width/2, size.height/2));\r\n        texture.begin();\r\n        cc.director.getRunningScene().visit();\r\n        texture.end();\r\n        texture.saveToFile(fileName, cc.IMAGE_FORMAT_JPG);\r\n        \r\n        var self = this;\r\n        var tryTimes = 0;\r\n        var fn = function(){\r\n            if(jsb.fileUtils.isFileExist(fullPath)){\r\n                var height = 100;\r\n                var scale = height/size.height;\r\n\t\t\t    var width = Math.floor(size.width * scale);\r\n                \r\n                if(cc.sys.os == cc.sys.OS_ANDROID){\r\n                    jsb.reflection.callStaticMethod(self.ANDROID_API, \"shareImage\", \"(Ljava/lang/String;Z)V\",fullPath,isTimelineCb);\r\n                } else if(cc.sys.os == cc.sys.OS_IOS){\r\n                    jsb.reflection.callStaticMethod(self.IOS_API, \"shareImage:isTimelineCb:\",fullPath,isTimelineCb);\r\n                }else{\r\n                    console.log(\"platform:\" + cc.sys.os + \" dosn't implement share.\");\r\n                }\r\n                self._isCapturing = false;\r\n            } else{\r\n                tryTimes++;\r\n                if(tryTimes > 10){\r\n                    console.log(\"time out...\");\r\n                    return;\r\n                }\r\n                setTimeout(fn,50); \r\n            }\r\n        }\r\n        setTimeout(fn,50);\r\n    },\r\n\r\n    onLoginResp:function(code){\r\n        var fn = function(ret){\r\n            if(ret.errcode == 0){\r\n                cc.sys.localStorage.setItem(\"wx_account\",ret.account);\r\n                cc.sys.localStorage.setItem(\"wx_sign\",ret.sign);\r\n            }\r\n            th.userManager.onAuth(null,ret);\r\n        }\r\n        th.http.get(\"/wechat_auth\",{code:code,os:cc.sys.os},fn);\r\n    },\r\n\r\n    \r\n});\r\n"]}