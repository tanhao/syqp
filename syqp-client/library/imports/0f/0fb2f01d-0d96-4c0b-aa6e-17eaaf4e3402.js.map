{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJFolds.js"],"names":["cc","Class","extends","Component","properties","_folds","onLoad","th","initView","initEventHandler","initAllFolds","update","dt","left","myself","right","up","sides","i","length","side","folds","node","getChildByName","j","children","mj","active","sprite","getComponent","Sprite","spriteFrame","push","self","on","data","initFolds","detail","seatData","hideAllFolds","key","mjs","seats","socketIOManager","localIndex","getLocalIndex","index","pre","mahjongManager","getFoldPre","getSide","foldsSprites","setSpriteFrameByMJID","refreshAllSeat","refreshOneSeat","mjid","getSpriteFrameByMJID"],"mappings":"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","file":"MJFolds.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _folds:null,\r\n    },\r\n\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.initView();\r\n        this.initEventHandler();\r\n        this.initAllFolds();\r\n    },\r\n\r\n\r\n    update (dt) {\r\n    },\r\n\r\n    initView:function(){\r\n        this._folds={};\r\n        this._folds.left=[];\r\n        this._folds.myself=[];\r\n        this._folds.right=[];\r\n        this._folds.up=[];\r\n        var sides =['myself','right','up','left'];\r\n        for(var i = 0; i < sides.length; i++){\r\n            var side=sides[i];\r\n            var folds=this.node.getChildByName(side).getChildByName(\"Folds\");\r\n            for(var j=1;j<=folds.children.length;j++){\r\n                var mj=folds.getChildByName(\"mj\"+j);\r\n                mj.active=false;\r\n                var sprite = mj.getComponent(cc.Sprite);\r\n                sprite.spriteFrame = null;\r\n                this._folds[side].push(sprite);  \r\n            }\r\n        }\r\n    },\r\n\r\n  \r\n    initEventHandler:function(){\r\n        var self = this;\r\n        this.node.on('begin_push',function(data){\r\n            self.initAllFolds();\r\n        });  \r\n        //过牌\r\n        this.node.on('guo_notify_push',function(data){\r\n            //console.log('==>MJFolds guo_notify_push:',JSON.stringify(data.detail));\r\n            self.initFolds(data.detail);\r\n        });\r\n        //出牌\r\n        this.node.on('chupai_notify_push',function(data){\r\n            //console.log('==>MJFolds chupai_notify_push:',JSON.stringify(data.detail));\r\n            self.initFolds(data.detail.seatData);\r\n        });\r\n\r\n        this.node.on('sync_push',function(data){\r\n            //console.log('==>MJFolds chupai_notify_push:',JSON.stringify(data.detail));\r\n            self.initAllFolds();\r\n        });\r\n\r\n        this.node.on('clean_push',function(){\r\n            self.initAllFolds();\r\n        });\r\n\r\n    },\r\n    hideAllFolds:function(){\r\n        for(var key in this._folds){\r\n            var mjs = this._folds[key];\r\n            for(var i=0;i<mjs.length;i++){\r\n                mjs[i].node.active = false;\r\n            }\r\n        }\r\n    },\r\n    initAllFolds:function(){\r\n        var seats = th.socketIOManager.seats;\r\n        for(var i in seats){\r\n            this.initFolds(seats[i]);\r\n        }\r\n    },\r\n    initFolds:function(seatData){\r\n        var folds = seatData.folds;\r\n        if(folds == null){\r\n            return;\r\n        }\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var foldsSprites = this._folds[side];\r\n\r\n        for(var i = 0; i < foldsSprites.length; ++i){\r\n            var index = i;\r\n            /*\r\n            if(side == \"right\" || side == \"up\"){\r\n                index = foldsSprites.length - i - 1;\r\n            }\r\n            */\r\n            var sprite = foldsSprites[index];\r\n            sprite.node.active = true;\r\n            this.setSpriteFrameByMJID(pre,sprite,folds[i]);\r\n        }\r\n        for(var i = folds.length; i < foldsSprites.length; ++i){\r\n            var index = i;\r\n            /*\r\n            if(side == \"right\" || side == \"up\"){\r\n                index = foldsSprites.length - i - 1;\r\n            }\r\n            */\r\n            var sprite = foldsSprites[index];\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n        }  \r\n    },\r\n    refreshAllSeat:function(){\r\n\r\n    },\r\n    refreshOneSeat:function(){\r\n\r\n    },\r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n});\r\n"]}