{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\SocketIOManager.js"],"names":["cc","Class","extends","Component","properties","dataEventHandler","roomId","config","seats","round","creator","chupai","caishen","seatIndex","bankIndex","turn","mjsy","needCheckIp","status","onLoad","reset","th","userManager","dispatchEvent","event","data","emit","initHandlers","self","sio","addHandler","log","JSON","stringify","getSeatIndexById","userId","index","online","ip","seat","getSeatByUserId","name","headImgUrl","sex","score","ready","holds","wc","show","director","loadScene","isOver","i","length","getLocalIndex","total","ret","getWanfa","str","push","fengding","difen","zuozhuang","payment","ctdsq","join","isFangzhu","isReady","connectServer","onConnectSuccess","ping","hide","onConnectError","err","alert","addr","port","token","sign","time","connect"],"mappings":"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","file":"SocketIOManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        dataEventHandler:null, //处理socket.io发过来的数据的节点\r\n        roomId:null,\r\n        config:null,\r\n        seats:null,\r\n        round:null,            //当前第几局,算剩余几局用config.round-this.round\r\n        creator:null,          //房主ID\r\n        chupai:null,           //出的牌\r\n        caishen:null,          //财神 \r\n        seatIndex:-1,          //座位Index\r\n        bankIndex:-1,          //庄Index\r\n        turn:-1,               //轮到谁出牌了\r\n        mjsy:0,                //剩余麻将\r\n        needCheckIp:false,\r\n        status:'idle',         //状态  idle,beging\r\n    },\r\n\r\n\r\n    onLoad () {\r\n    },\r\n\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n\r\n    reset:function(){\r\n        th.userManager.roomId=null;\r\n        this.roomId=null;\r\n        this.config=null;\r\n        this.seats=null;\r\n        this.round=null;\r\n        this.creator=null;\r\n        this.chupai=-1;\r\n        this.caishen=null;\r\n        this.seatIndex=-1;\r\n        this.bankIndex=-1;\r\n        this.turn=-1;\r\n        this.mjsy=0;\r\n        this.needCheckIp=false;\r\n        this.status='idle';\r\n    },\r\n\r\n    dispatchEvent(event,data){\r\n        if(this.dataEventHandler){\r\n            this.dataEventHandler.emit(event,data);\r\n        }    \r\n    },\r\n\r\n    initHandlers:function(){\r\n        var self = this;\r\n        //连接成功初始化信息\r\n        th.sio.addHandler(\"init_room\",function(data){\r\n            cc.log(\"==>SocketIOManager init_room:\",JSON.stringify(data));\r\n            self.roomId=data.roomId;\r\n            self.config=data.config;\r\n            self.seats=data.seats;\r\n            self.round=data.round;\r\n            self.creator=data.creator;\r\n            self.seatIndex=self.getSeatIndexById(th.userManager.userId);\r\n            self.dispatchEvent(\"init_room\",data);\r\n        })\r\n        //其他玩家加入房间\r\n        th.sio.addHandler(\"join_push\",function(data){\r\n            cc.log(\"==>SocketIOManager join_push:\",JSON.stringify(data));\r\n            var index=data.index;\r\n            if(self.seats[index].userId){\r\n                self.seats[index].online = true;\r\n                if(self.seats[index].ip != data.ip){\r\n                    self.seats[index].ip = data.ip;\r\n                    self.needCheckIp=true;\r\n                }\r\n            }else{\r\n                self.seats[index] = data;\r\n                self.needCheckIp=true;\r\n            }\r\n            self.dispatchEvent(\"join_push\",self.seats[index]);\r\n            if(self.needCheckIp){\r\n                self.dispatchEvent('check_ip',self.seats[index]);\r\n            }\r\n        })\r\n        //自己离开房间\r\n        th.sio.addHandler(\"leave_result\",function(data){\r\n            self.reset();\r\n        })\r\n        //其他玩家离开房间\r\n        th.sio.addHandler(\"leave_push\",function(data){\r\n            cc.log(\"==>SocketIOManager leave_push:\",JSON.stringify(data));\r\n            var userId=data.userId;\r\n            var seat=self.getSeatByUserId(userId);\r\n            if(seat){\r\n                seat.userId=null;\r\n                seat.name=null;\r\n                seat.headImgUrl=null;\r\n                seat.sex=null;\r\n                seat.sex=null;\r\n                seat.score=0;\r\n                seat.ready=false;\r\n                seat.online=false;\r\n            }\r\n            self.dispatchEvent(\"leave_push\",seat);\r\n        })\r\n        //解散房间，所有玩家退出房间，收到此消息返回大厅\r\n        th.sio.addHandler(\"dissolve_push\",function(data){\r\n            self.reset();\r\n            cc.log(\"==>SocketIOManager dissolve_push:\",JSON.stringify(data));\r\n        })\r\n        //其他玩家断线\r\n        th.sio.addHandler(\"offline_push\",function(data){\r\n            cc.log(\"==>SocketIOManager offline_push:\",JSON.stringify(data));\r\n            if(self.roomId!=null){\r\n                self.dispatchEvent(\"offline_push\",data);\r\n            }\r\n        })\r\n        //其他玩家上线\r\n        th.sio.addHandler(\"online_push\",function(data){\r\n            cc.log(\"==>SocketIOManager online_push:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"online_push\",data);\r\n        })\r\n        //自己准备返回\r\n        th.sio.addHandler(\"ready_result\",function(data){\r\n            cc.log(\"==>SocketIOManager ready_result:\",JSON.stringify(data));\r\n            var seat = self.getSeatByUserId(th.userManager.userId);\r\n            seat.ready=true;\r\n            self.dispatchEvent(\"ready_result\",seat);\r\n        })\r\n        //其他玩家准备\r\n        th.sio.addHandler(\"ready_push\",function(data){\r\n            cc.log(\"==>SocketIOManager ready_push:\",JSON.stringify(data));\r\n            var seat = self.getSeatByUserId(data.userId);\r\n            seat.ready=true;\r\n            self.dispatchEvent(\"ready_push\",seat);\r\n        })\r\n\r\n        //玩家手上的牌\r\n        th.sio.addHandler(\"holds_push\",function(data){\r\n            cc.log(\"==>SocketIOManager holds_push:\",JSON.stringify(data));\r\n            var seat = self.seats[self.seatIndex]; \r\n            seat.holds=data;\r\n            self.dispatchEvent(\"holds_push\");\r\n        })\r\n\r\n        //通知还剩多少张牌\r\n        th.sio.addHandler(\"mjsy_push\",function(data){\r\n            cc.log(\"==>SocketIOManager mjsy_push:\",JSON.stringify(data));\r\n            self.mjsy=mjsy;\r\n            self.dispatchEvent(\"mjsy_push\");\r\n        })\r\n\r\n        //通知当前是第几局\r\n        th.sio.addHandler(\"round_push\",function(data){\r\n            cc.log(\"==>SocketIOManager round_push:\",JSON.stringify(data));\r\n            self.round=round;\r\n            self.dispatchEvent(\"round_push\");\r\n        })\r\n\r\n\r\n        //开始游戏基本消息\r\n        th.sio.addHandler(\"begin_push\",function(data){\r\n            cc.log(\"==>SocketIOManager begin_push:\",JSON.stringify(data));\r\n            self.turn=data.turn;\r\n            self.status=\"begin\";\r\n            self.dispatchEvent(\"begin_push\");\r\n        })\r\n\r\n        //谁出牌\r\n        th.sio.addHandler(\"chupai_push\",function(data){\r\n            cc.log(\"==>SocketIOManager chupai_push:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"chupai_push\");\r\n        })\r\n\r\n        //出牌时可以做的操作\r\n        th.sio.addHandler(\"action_push\",function(data){\r\n            cc.log(\"==>SocketIOManager action_push:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"action_push\");\r\n        })\r\n\r\n\r\n        //断线\r\n        th.sio.addHandler(\"disconnect\",function(data){\r\n            if(self.roomId == null){\r\n                th.wc.show('正在返回游戏大厅');\r\n                cc.director.loadScene(\"hall\");\r\n            }else{\r\n                if(self.isOver == false){\r\n                    th.userManager.roomId = self.roomId;\r\n                    self.dispatchEvent(\"disconnect\");                    \r\n                }else{\r\n                    self.roomId=null;\r\n                    self.config=null;\r\n                    self.seats=null;\r\n                    self.round=null;\r\n                    self.seatIndex=-1;\r\n                }\r\n            }\r\n        });\r\n       \r\n    },\r\n\r\n    getSeatIndexById:function(userId){\r\n        for(var i = 0; i < this.seats.length;i++){\r\n            if(this.seats[i].userId == userId){\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n\r\n    getLocalIndex:function(index){\r\n        var total=this.seats.length;\r\n        var ret = (index - this.seatIndex + total) % total;\r\n        return ret;\r\n    },\r\n\r\n    getSeatByUserId:function(userId){\r\n        var index = this.getSeatIndexById(userId);\r\n        var seat = this.seats[index];\r\n        return seat;\r\n    },\r\n\r\n    getWanfa:function(){\r\n       var str=[];\r\n       str.push(\"封顶\");\r\n       str.push(this.config.fengding)\r\n       str.push(\"/\");\r\n       str.push(this.config.difen)\r\n       str.push(\"分/\");\r\n       str.push(this.config.zuozhuang=='QZ'?'抢庄':'轮庄')\r\n       str.push(\"/\");\r\n       str.push(this.config.payment=='FZ'?'房主付':'AA付')\r\n       str.push(this.config.ctdsq?'/吃吐荡三圈':'');\r\n       return str.join(\"\");\r\n    },\r\n    isFangzhu:function(){\r\n        return this.creator==th.userManager.userId;\r\n    },\r\n\r\n    isReady:function(userId){\r\n        var seat=this.getSeatByUserId(userId);\r\n        return seat.ready;\r\n    },\r\n\r\n    connectServer:function(data){\r\n        var onConnectSuccess=function(){\r\n            cc.director.loadScene(\"mjgame\",function(){\r\n                th.sio.ping();\r\n                th.wc.hide();\r\n            });\r\n        }\r\n\r\n        var onConnectError=function(err){\r\n             th.wc.hide();\r\n             th.alert.show('提示',err,null,false); //\r\n        }\r\n        th.sio.addr=\"ws://\"+data.ip+\":\"+data.port+\"?roomId=\"+data.roomId+\"&token=\"+data.token+\"&sign=\"+data.sign+\"&time=\"+data.time;\r\n        th.sio.connect(onConnectSuccess,onConnectError);\r\n    }\r\n    \r\n\r\n});\r\n"]}