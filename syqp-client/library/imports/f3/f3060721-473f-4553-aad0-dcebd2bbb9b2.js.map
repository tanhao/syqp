{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\SocketIOManager.js"],"names":["cc","Class","extends","Component","properties","dataEventHandler","roomId","config","seats","round","creator","chupai","caishen","seatIndex","bankerIndex","turn","mjsy","needCheckIp","status","actions","onLoad","reset","th","userManager","i","length","holds","folds","chis","pengs","angangs","diangangs","bugangs","ready","dispatchEvent","event","data","emit","initHandlers","self","sio","addHandler","log","JSON","stringify","getSeatIndexById","userId","index","online","ip","seat","getSeatByUserId","name","headImgUrl","sex","score","s","turnUserId","doTurnChange","pai","getSeatIndexByID","doGuo","doChi","info","doPeng","doGang","gangType","doChupai","doMopai","doHu","wc","show","director","loadScene","isOver","getGangType","seatData","idx","mjid","cnt","push","mjids","indexOf","splice","last","getLocalIndex","total","ret","getWanfa","str","fengding","difen","zuozhuang","payment","ctdsq","join","isFangzhu","isReady","connectServer","onConnectSuccess","ping","hide","onConnectError","err","alert","addr","port","token","sign","time","connect"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,0BAAiB,IADT,EACe;AACvBC,gBAAO,IAFC;AAGRC,gBAAO,IAHC;AAIRC,eAAM,IAJE;AAKRC,eAAM,IALE,EAKe;AACvBC,iBAAQ,IANA,EAMe;AACvBC,gBAAO,IAPC,EAOe;AACvBC,iBAAQ,IARA,EAQe;AACvBC,mBAAU,CAAC,CATH,EASe;AACvBC,qBAAY,CAAC,CAVL,EAUiB;AACzBC,cAAK,CAAC,CAXE,EAWe;AACvBC,cAAK,CAZG,EAYe;AACvBC,qBAAY,KAbJ;AAcRC,gBAAO,MAdC,EAce;AACvBC,iBAAQ,IAfA,CAee;;AAff,KAHP;AAqBLC,UArBK,oBAqBK,CACT,CAtBI;;;AAwBL;;;;AAIAC,WAAM,iBAAU;AACZC,WAAGC,WAAH,CAAejB,MAAf,GAAsB,IAAtB;AACA,aAAKA,MAAL,GAAY,IAAZ;AACA,aAAKC,MAAL,GAAY,IAAZ;AACA,aAAKC,KAAL,GAAW,IAAX;AACA,aAAKC,KAAL,GAAW,IAAX;AACA,aAAKC,OAAL,GAAa,IAAb;AACA,aAAKC,MAAL,GAAY,CAAC,CAAb;AACA,aAAKC,OAAL,GAAa,IAAb;AACA,aAAKC,SAAL,GAAe,CAAC,CAAhB;AACA,aAAKC,WAAL,GAAiB,CAAC,CAAlB;AACA,aAAKC,IAAL,GAAU,CAAC,CAAX;AACA,aAAKC,IAAL,GAAU,CAAV;AACA,aAAKC,WAAL,GAAiB,KAAjB;AACA,aAAKC,MAAL,GAAY,MAAZ;AACA,aAAKC,OAAL,GAAa,IAAb;AACA,aAAI,IAAIK,IAAI,CAAZ,EAAeA,IAAI,KAAKhB,KAAL,CAAWiB,MAA9B,EAAqCD,GAArC,EAAyC;AACrC,iBAAKhB,KAAL,CAAWgB,CAAX,EAAcE,KAAd,GAAsB,EAAtB;AACA,iBAAKlB,KAAL,CAAWgB,CAAX,EAAcG,KAAd,GAAsB,EAAtB;AACA,iBAAKnB,KAAL,CAAWgB,CAAX,EAAcI,IAAd,GAAqB,EAArB;AACA,iBAAKpB,KAAL,CAAWgB,CAAX,EAAcK,KAAd,GAAsB,EAAtB;AACA,iBAAKrB,KAAL,CAAWgB,CAAX,EAAcM,OAAd,GAAwB,EAAxB;AACA,iBAAKtB,KAAL,CAAWgB,CAAX,EAAcO,SAAd,GAA0B,EAA1B;AACA,iBAAKvB,KAAL,CAAWgB,CAAX,EAAcQ,OAAd,GAAwB,EAAxB;AACA,iBAAKxB,KAAL,CAAWgB,CAAX,EAAcS,KAAd,GAAsB,KAAtB;AACH;AACJ,KAtDI;AAuDLC,iBAvDK,yBAuDSC,KAvDT,EAuDeC,IAvDf,EAuDoB;AACrB,YAAG,KAAK/B,gBAAR,EAAyB;AACrB,iBAAKA,gBAAL,CAAsBgC,IAAtB,CAA2BF,KAA3B,EAAiCC,IAAjC;AACH;AACJ,KA3DI;;AA4DLE,kBAAa,wBAAU;AACnB,YAAIC,OAAO,IAAX;AACA;AACAjB,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,WAAlB,EAA8B,UAASL,IAAT,EAAc;AACxCpC,eAAG0C,GAAH,CAAO,+BAAP,EAAuCC,KAAKC,SAAL,CAAeR,IAAf,CAAvC;AACAG,iBAAKjC,MAAL,GAAY8B,KAAK9B,MAAjB;AACAiC,iBAAKhC,MAAL,GAAY6B,KAAK7B,MAAjB;AACAgC,iBAAK/B,KAAL,GAAW4B,KAAK5B,KAAhB;AACA+B,iBAAK9B,KAAL,GAAW2B,KAAK3B,KAAhB;AACA8B,iBAAK7B,OAAL,GAAa0B,KAAK1B,OAAlB;AACA6B,iBAAK1B,SAAL,GAAe0B,KAAKM,gBAAL,CAAsBvB,GAAGC,WAAH,CAAeuB,MAArC,CAAf;AACAP,iBAAKL,aAAL,CAAmB,WAAnB,EAA+BE,IAA/B;AACH,SATD;AAUA;AACAd,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,WAAlB,EAA8B,UAASL,IAAT,EAAc;AACxCpC,eAAG0C,GAAH,CAAO,+BAAP,EAAuCC,KAAKC,SAAL,CAAeR,IAAf,CAAvC;AACA,gBAAIW,QAAMX,KAAKW,KAAf;AACA,gBAAGR,KAAK/B,KAAL,CAAWuC,KAAX,EAAkBD,MAArB,EAA4B;AACxBP,qBAAK/B,KAAL,CAAWuC,KAAX,EAAkBC,MAAlB,GAA2B,IAA3B;AACA,oBAAGT,KAAK/B,KAAL,CAAWuC,KAAX,EAAkBE,EAAlB,IAAwBb,KAAKa,EAAhC,EAAmC;AAC/BV,yBAAK/B,KAAL,CAAWuC,KAAX,EAAkBE,EAAlB,GAAuBb,KAAKa,EAA5B;AACAV,yBAAKtB,WAAL,GAAiB,IAAjB;AACH;AACJ,aAND,MAMK;AACDsB,qBAAK/B,KAAL,CAAWuC,KAAX,IAAoBX,IAApB;AACAG,qBAAKtB,WAAL,GAAiB,IAAjB;AACH;AACDsB,iBAAKL,aAAL,CAAmB,WAAnB,EAA+BK,KAAK/B,KAAL,CAAWuC,KAAX,CAA/B;AACA,gBAAGR,KAAKtB,WAAR,EAAoB;AAChBsB,qBAAKL,aAAL,CAAmB,UAAnB,EAA8BK,KAAK/B,KAAL,CAAWuC,KAAX,CAA9B;AACH;AACJ,SAjBD;AAkBA;AACAzB,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,cAAlB,EAAiC,UAASL,IAAT,EAAc;AAC3CG,iBAAKlB,KAAL;AACH,SAFD;AAGA;AACAC,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzCpC,eAAG0C,GAAH,CAAO,gCAAP,EAAwCC,KAAKC,SAAL,CAAeR,IAAf,CAAxC;AACA,gBAAIU,SAAOV,KAAKU,MAAhB;AACA,gBAAII,OAAKX,KAAKY,eAAL,CAAqBL,MAArB,CAAT;AACA,gBAAGI,IAAH,EAAQ;AACJA,qBAAKJ,MAAL,GAAY,IAAZ;AACAI,qBAAKE,IAAL,GAAU,IAAV;AACAF,qBAAKG,UAAL,GAAgB,IAAhB;AACAH,qBAAKI,GAAL,GAAS,IAAT;AACAJ,qBAAKI,GAAL,GAAS,IAAT;AACAJ,qBAAKK,KAAL,GAAW,CAAX;AACAL,qBAAKjB,KAAL,GAAW,KAAX;AACAiB,qBAAKF,MAAL,GAAY,KAAZ;AACH;AACDT,iBAAKL,aAAL,CAAmB,YAAnB,EAAgCgB,IAAhC;AACH,SAfD;AAgBA;AACA5B,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,eAAlB,EAAkC,UAASL,IAAT,EAAc;AAC5CG,iBAAKlB,KAAL;AACArB,eAAG0C,GAAH,CAAO,mCAAP,EAA2CC,KAAKC,SAAL,CAAeR,IAAf,CAA3C;AACH,SAHD;AAIA;AACAd,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,cAAlB,EAAiC,UAASL,IAAT,EAAc;AAC3CpC,eAAG0C,GAAH,CAAO,kCAAP,EAA0CC,KAAKC,SAAL,CAAeR,IAAf,CAA1C;AACA,gBAAGG,KAAKjC,MAAL,IAAa,IAAhB,EAAqB;AACjBiC,qBAAKL,aAAL,CAAmB,cAAnB,EAAkCE,IAAlC;AACH;AACJ,SALD;AAMA;AACAd,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,aAAlB,EAAgC,UAASL,IAAT,EAAc;AAC1CpC,eAAG0C,GAAH,CAAO,iCAAP,EAAyCC,KAAKC,SAAL,CAAeR,IAAf,CAAzC;AACAG,iBAAKL,aAAL,CAAmB,aAAnB,EAAiCE,IAAjC;AACH,SAHD;AAIA;AACAd,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,cAAlB,EAAiC,UAASL,IAAT,EAAc;AAC3CpC,eAAG0C,GAAH,CAAO,kCAAP,EAA0CC,KAAKC,SAAL,CAAeR,IAAf,CAA1C;AACA,gBAAIc,OAAOX,KAAKY,eAAL,CAAqB7B,GAAGC,WAAH,CAAeuB,MAApC,CAAX;AACAI,iBAAKjB,KAAL,GAAW,IAAX;AACAM,iBAAKL,aAAL,CAAmB,cAAnB,EAAkCgB,IAAlC;AACH,SALD;AAMA;AACA5B,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzCpC,eAAG0C,GAAH,CAAO,gCAAP,EAAwCC,KAAKC,SAAL,CAAeR,IAAf,CAAxC;AACA,gBAAIc,OAAOX,KAAKY,eAAL,CAAqBf,KAAKU,MAA1B,CAAX;AACAI,iBAAKjB,KAAL,GAAW,IAAX;AACAM,iBAAKL,aAAL,CAAmB,YAAnB,EAAgCgB,IAAhC;AACH,SALD;AAMA;AACA5B,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzCpC,eAAG0C,GAAH,CAAO,gCAAP,EAAwCC,KAAKC,SAAL,CAAeR,IAAf,CAAxC;AACA,gBAAIc,OAAOX,KAAK/B,KAAL,CAAW+B,KAAK1B,SAAhB,CAAX;AACAqC,iBAAKxB,KAAL,GAAWU,IAAX;AACA,iBAAI,IAAIZ,IAAI,CAAZ,EAAeA,IAAIe,KAAK/B,KAAL,CAAWiB,MAA9B,EAAsC,EAAED,CAAxC,EAA0C;AACtC,oBAAIgC,IAAIjB,KAAK/B,KAAL,CAAWgB,CAAX,CAAR;AACA,oBAAGgC,EAAE7B,KAAF,IAAW,IAAd,EAAmB;AACf6B,sBAAE7B,KAAF,GAAU,EAAV;AACH;AACD,oBAAG6B,EAAE1B,OAAF,IAAa,IAAhB,EAAqB;AACjB0B,sBAAE1B,OAAF,GAAY,EAAZ;AACH;AACD,oBAAG0B,EAAEzB,SAAF,IAAe,IAAlB,EAAuB;AACnByB,sBAAEzB,SAAF,GAAc,EAAd;AACH;AACD,oBAAGyB,EAAExB,OAAF,IAAa,IAAhB,EAAqB;AACjBwB,sBAAExB,OAAF,GAAY,EAAZ;AACH;AACD,oBAAGwB,EAAE3B,KAAF,IAAW,IAAd,EAAmB;AACf2B,sBAAE3B,KAAF,GAAU,EAAV;AACH;AACD,oBAAG2B,EAAE5B,IAAF,IAAU,IAAb,EAAkB;AACd4B,sBAAE5B,IAAF,GAAS,EAAT;AACH;AACD4B,kBAAEvB,KAAF,GAAU,KAAV;AACH;AACDM,iBAAKL,aAAL,CAAmB,YAAnB;AACH,SA3BD;AA4BA;AACAZ,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,WAAlB,EAA8B,UAASL,IAAT,EAAc;AACxCpC,eAAG0C,GAAH,CAAO,+BAAP,EAAuCN,IAAvC;AACAG,iBAAKvB,IAAL,GAAUoB,IAAV;AACAG,iBAAKL,aAAL,CAAmB,WAAnB;AACH,SAJD;AAKA;AACAZ,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzCpC,eAAG0C,GAAH,CAAO,gCAAP,EAAwCN,IAAxC;AACAG,iBAAK9B,KAAL,GAAW2B,IAAX;AACAG,iBAAKL,aAAL,CAAmB,YAAnB;AACH,SAJD;AAKA;AACAZ,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,cAAlB,EAAiC,UAASL,IAAT,EAAc;AAC3CpC,eAAG0C,GAAH,CAAO,kCAAP,EAA0CN,IAA1C;AACAG,iBAAK3B,OAAL,GAAawB,IAAb;AACAG,iBAAKL,aAAL,CAAmB,cAAnB;AACH,SAJD;AAKA;AACAZ,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzCpC,eAAG0C,GAAH,CAAO,gCAAP,EAAwCN,IAAxC;AACAG,iBAAKzB,WAAL,GAAiBsB,IAAjB;AACAG,iBAAKxB,IAAL,GAAUwB,KAAKzB,WAAf;AACAyB,iBAAKrB,MAAL,GAAY,OAAZ;AACAqB,iBAAKL,aAAL,CAAmB,YAAnB;AACH,SAND;AAOA;AACAZ,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,aAAlB,EAAgC,UAASL,IAAT,EAAc;AAC1CpC,eAAG0C,GAAH,CAAO,iCAAP,EAAyCC,KAAKC,SAAL,CAAeR,IAAf,CAAzC;AACA,gBAAIqB,aAAWrB,IAAf;AACA,gBAAIvB,YAAU0B,KAAKM,gBAAL,CAAsBY,UAAtB,CAAd;AACAlB,iBAAKmB,YAAL,CAAkB7C,SAAlB;AACH,SALD;AAMA;AACAS,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,aAAlB,EAAgC,UAASL,IAAT,EAAc;AAC1CpC,eAAG0C,GAAH,CAAO,iCAAP,EAAyCC,KAAKC,SAAL,CAAeR,IAAf,CAAzC;AACAG,iBAAKpB,OAAL,GAAaiB,IAAb;AACAG,iBAAKL,aAAL,CAAmB,aAAnB,EAAiCE,IAAjC;AACH,SAJD;AAKAd,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzCG,iBAAKL,aAAL,CAAmB,YAAnB;AACH,SAFD;AAGAZ,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,iBAAlB,EAAoC,UAASL,IAAT,EAAc;AAC9C,gBAAIU,SAASV,KAAKU,MAAlB;AACA,gBAAIa,MAAMvB,KAAKuB,GAAf;AACA,gBAAI9C,YAAY0B,KAAKqB,gBAAL,CAAsBd,MAAtB,CAAhB;AACAP,iBAAKsB,KAAL,CAAWhD,SAAX,EAAqBuB,KAAKuB,GAA1B;AACH,SALD;AAMArC,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,iBAAlB,EAAoC,UAASL,IAAT,EAAc;AAC9C,gBAAIU,SAASV,KAAKU,MAAlB;AACA,gBAAIa,MAAMvB,KAAKuB,GAAf;AACA,gBAAI9C,YAAY0B,KAAKqB,gBAAL,CAAsBd,MAAtB,CAAhB;AACAP,iBAAKuB,KAAL,CAAWjD,SAAX,EAAqBuB,KAAK2B,IAA1B,EAA+BJ,GAA/B;AACH,SALD;AAMArC,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,kBAAlB,EAAqC,UAASL,IAAT,EAAc;AAC/C,gBAAIU,SAASV,KAAKU,MAAlB;AACA,gBAAIa,MAAMvB,KAAKuB,GAAf;AACA,gBAAI9C,YAAY0B,KAAKqB,gBAAL,CAAsBd,MAAtB,CAAhB;AACAP,iBAAKyB,MAAL,CAAYnD,SAAZ,EAAsBuB,KAAK2B,IAA3B;AACH,SALD;AAMAzC,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,kBAAlB,EAAqC,UAASL,IAAT,EAAc;AAC/C,gBAAIU,SAASV,KAAKU,MAAlB;AACA,gBAAIa,MAAMvB,KAAKuB,GAAf;AACA,gBAAI9C,YAAY0B,KAAKqB,gBAAL,CAAsBd,MAAtB,CAAhB;AACAP,iBAAK0B,MAAL,CAAYpD,SAAZ,EAAsBuB,KAAK2B,IAA3B,EAAgC3B,KAAK8B,QAArC;AACH,SALD;AAMA5C,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,oBAAlB,EAAuC,UAASL,IAAT,EAAc;AACjD,gBAAIU,SAASV,KAAKU,MAAlB;AACA,gBAAIa,MAAMvB,KAAKuB,GAAf;AACA,gBAAI9C,YAAY0B,KAAKqB,gBAAL,CAAsBd,MAAtB,CAAhB;AACAP,iBAAK4B,QAAL,CAActD,SAAd,EAAwB8C,GAAxB;AACH,SALD;AAMArC,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzCG,iBAAK6B,OAAL,CAAa7B,KAAK1B,SAAlB,EAA4BuB,IAA5B;AACH,SAFD;;AAIAd,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,gBAAlB,EAAmC,UAASL,IAAT,EAAc;AAC7CG,iBAAK8B,IAAL,CAAUjC,IAAV;AACH,SAFD;AAGA;AACAd,WAAGkB,GAAH,CAAOC,UAAP,CAAkB,YAAlB,EAA+B,UAASL,IAAT,EAAc;AACzC,gBAAGG,KAAKjC,MAAL,IAAe,IAAlB,EAAuB;AACnBgB,mBAAGgD,EAAH,CAAMC,IAAN,CAAW,UAAX;AACAvE,mBAAGwE,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH,aAHD,MAGK;AACD,oBAAGlC,KAAKmC,MAAL,IAAe,KAAlB,EAAwB;AACpBpD,uBAAGC,WAAH,CAAejB,MAAf,GAAwBiC,KAAKjC,MAA7B;AACAiC,yBAAKL,aAAL,CAAmB,YAAnB;AACH,iBAHD,MAGK;AACDK,yBAAKjC,MAAL,GAAY,IAAZ;AACAiC,yBAAKhC,MAAL,GAAY,IAAZ;AACAgC,yBAAK/B,KAAL,GAAW,IAAX;AACA+B,yBAAK9B,KAAL,GAAW,IAAX;AACA8B,yBAAK1B,SAAL,GAAe,CAAC,CAAhB;AACH;AACJ;AACJ,SAhBD;AAkBH,KA/QI;AAgRL8D,iBAAY,qBAASC,QAAT,EAAkBjB,GAAlB,EAAsB;AAC9B,YAAIkB,MAAI,CAAC,CAAT;AACA,aAAI,IAAIrD,IAAE,CAAV,EAAYA,IAAEoD,SAAS/C,KAAT,CAAeJ,MAA7B,EAAoCD,GAApC,EAAwC;AACpC,gBAAGoD,SAAS/C,KAAT,CAAeL,CAAf,EAAkBsD,IAAlB,IAAwBnB,GAA3B,EAA+B;AAC3BkB,sBAAIrD,CAAJ;AACA;AACH;AACJ;AACD,YAAGqD,OAAO,CAAC,CAAX,EAAa;AACT,mBAAO,QAAP;AACH,SAFD,MAEK;AACD,gBAAIE,MAAM,CAAV;AACA,iBAAI,IAAIvD,IAAI,CAAZ,EAAeA,IAAIoD,SAASlD,KAAT,CAAeD,MAAlC,EAA0C,EAAED,CAA5C,EAA8C;AAC1C,oBAAGoD,SAASlD,KAAT,CAAeF,CAAf,KAAqBmC,GAAxB,EAA4B;AACxBoB;AACH;AACJ;AACD,gBAAGA,OAAO,CAAV,EAAY;AACR,uBAAO,UAAP;AACH,aAFD,MAEK;AACD,uBAAO,QAAP;AACH;AACJ;AACJ,KAvSI;AAwSLlB,WAAM,eAAShD,SAAT,EAAmB8C,GAAnB,EAAuB;AACzB,YAAIiB,WAAW,KAAKpE,KAAL,CAAWK,SAAX,CAAf;AACA,YAAIc,QAAQiD,SAASjD,KAArB;AACAA,cAAMqD,IAAN,CAAWrB,GAAX;AACA,aAAKzB,aAAL,CAAmB,iBAAnB,EAAqC0C,QAArC;AACH,KA7SI;AA8SLd,WAAM,eAASjD,SAAT,EAAmBkD,IAAnB,EAAwBJ,GAAxB,EAA4B;AAC9B,YAAIiB,WAAW,KAAKpE,KAAL,CAAWK,SAAX,CAAf;AACA;AACA,YAAG+D,SAASlD,KAAZ,EAAkB;AACd,iBAAI,IAAIF,IAAI,CAAZ,EAAeA,IAAIuC,KAAKkB,KAAL,CAAWxD,MAA9B,EAAsC,EAAED,CAAxC,EAA0C;AACtC,oBAAGuC,KAAKkB,KAAL,CAAWzD,CAAX,KAAemC,GAAlB,EAAsB;AAClB;AACH;AACD,oBAAIkB,MAAMD,SAASlD,KAAT,CAAewD,OAAf,CAAuBnB,KAAKkB,KAAL,CAAWzD,CAAX,CAAvB,CAAV;AACAoD,yBAASlD,KAAT,CAAeyD,MAAf,CAAsBN,GAAtB,EAA0B,CAA1B;AACH;AACD;AACH;AACD,YAAIjD,OAAOgD,SAAShD,IAApB;AACAA,aAAKoD,IAAL,CAAUjB,IAAV;AACA,aAAK7B,aAAL,CAAmB,iBAAnB,EAAqC0C,QAArC;AACH,KA9TI;AA+TLZ,YAAO,gBAASnD,SAAT,EAAmBkD,IAAnB,EAAwB;AAC3B,YAAIa,WAAW,KAAKpE,KAAL,CAAWK,SAAX,CAAf;AACA;AACA,YAAG+D,SAASlD,KAAZ,EAAkB;AACd,iBAAI,IAAIF,IAAI,CAAZ,EAAeA,IAAI,CAAnB,EAAsB,EAAEA,CAAxB,EAA0B;AACtB,oBAAIqD,MAAMD,SAASlD,KAAT,CAAewD,OAAf,CAAuBnB,KAAKe,IAA5B,CAAV;AACAF,yBAASlD,KAAT,CAAeyD,MAAf,CAAsBN,GAAtB,EAA0B,CAA1B;AACH;AACJ;AACD;AACA,YAAIhD,QAAQ+C,SAAS/C,KAArB;AACAA,cAAMmD,IAAN,CAAWjB,IAAX;AACA,aAAK7B,aAAL,CAAmB,kBAAnB,EAAsC0C,QAAtC;AACH,KA5UI;AA6ULX,YAAO,gBAASpD,SAAT,EAAmBkD,IAAnB,EAAwBG,QAAxB,EAAiC;AACpC,YAAIU,WAAW,KAAKpE,KAAL,CAAWK,SAAX,CAAf;AACA,YAAI8C,MAAII,KAAKe,IAAb;AACA,YAAG,CAACZ,QAAJ,EAAa;AACTA,uBAAW,KAAKS,WAAL,CAAiBC,QAAjB,EAA0BjB,GAA1B,CAAX;AACH;AACD,YAAGO,YAAY,QAAf,EAAwB;AACpB,gBAAIW,MAAI,CAAC,CAAT;AACA,iBAAI,IAAIrD,IAAE,CAAV,EAAYA,IAAEoD,SAAS/C,KAAT,CAAeJ,MAA7B,EAAoCD,GAApC,EAAwC;AACpC,oBAAGoD,SAAS/C,KAAT,CAAeL,CAAf,EAAkBsD,IAAlB,IAAwBnB,GAA3B,EAA+B;AAC3BkB,0BAAIrD,CAAJ;AACA;AACH;AACJ;AACD,gBAAGqD,OAAO,CAAC,CAAX,EAAa;AACRD,yBAAS/C,KAAT,CAAesD,MAAf,CAAsBN,GAAtB,EAA0B,CAA1B;AACJ;AACDD,qBAAS5C,OAAT,CAAiBgD,IAAjB,CAAsBjB,IAAtB;AACH;AACD,YAAGa,SAASlD,KAAZ,EAAkB;AACd,iBAAI,IAAIF,IAAI,CAAZ,EAAeA,KAAK,CAApB,EAAuB,EAAEA,CAAzB,EAA2B;AACvB,oBAAIqD,MAAMD,SAASlD,KAAT,CAAewD,OAAf,CAAuBvB,GAAvB,CAAV;AACA,oBAAGkB,OAAO,CAAC,CAAX,EAAa;AACT;AACA;AACH;AACDD,yBAASlD,KAAT,CAAeyD,MAAf,CAAsBN,GAAtB,EAA0B,CAA1B;AACH;AACJ;AACD,YAAGX,YAAY,QAAf,EAAwB;AACpBU,qBAAS9C,OAAT,CAAiBkD,IAAjB,CAAsBjB,IAAtB;AACH,SAFD,MAGK,IAAGG,YAAY,UAAf,EAA0B;AAC3BU,qBAAS7C,SAAT,CAAmBiD,IAAnB,CAAwBjB,IAAxB;AACH;AACD,aAAK7B,aAAL,CAAmB,kBAAnB,EAAsC,EAAC0C,UAASA,QAAV,EAAmBV,UAASA,QAA5B,EAAtC;AACH,KAjXI;AAkXLC,cAAS,kBAAStD,SAAT,EAAmB8C,GAAnB,EAAuB;AAC5B,aAAKhD,MAAL,GAAcgD,GAAd;AACA,YAAIiB,WAAW,KAAKpE,KAAL,CAAWK,SAAX,CAAf;AACA,YAAG+D,SAASlD,KAAZ,EAAkB;AACd,gBAAImD,MAAMD,SAASlD,KAAT,CAAewD,OAAf,CAAuBvB,GAAvB,CAAV;AACAiB,qBAASlD,KAAT,CAAeyD,MAAf,CAAsBN,GAAtB,EAA0B,CAA1B;AACH;AACD,aAAK3C,aAAL,CAAmB,oBAAnB,EAAwC,EAAC0C,UAASA,QAAV,EAAmBjB,KAAIA,GAAvB,EAAxC;AACH,KA1XI;AA2XLS,aAAQ,iBAASvD,SAAT,EAAmB8C,GAAnB,EAAuB;AAC3B,YAAIiB,WAAW,KAAKpE,KAAL,CAAWK,SAAX,CAAf;AACA,YAAG+D,SAASlD,KAAZ,EAAkB;AACdkD,qBAASlD,KAAT,CAAesD,IAAf,CAAoBrB,GAApB;AACA,iBAAKzB,aAAL,CAAmB,YAAnB,EAAgC,EAACrB,WAAUA,SAAX,EAAqB8C,KAAIA,GAAzB,EAAhC;AACH;AACJ,KAjYI;AAkYLU,UAAK,cAASxD,SAAT,EAAmB8C,GAAnB,EAAuB,CAC3B,CAnYI;AAoYLD,kBAAa,sBAAS7C,SAAT,EAAmB;AAC5B,YAAIuB,OAAO;AACPgD,kBAAK,KAAKrE,IADH;AAEPA,kBAAKF;AAFE,SAAX;AAIA,aAAKE,IAAL,GAAYF,SAAZ;AACA,aAAKqB,aAAL,CAAmB,aAAnB,EAAiCE,IAAjC;AACH,KA3YI;AA4YLS,sBAAiB,0BAASC,MAAT,EAAgB;AAC7B,aAAI,IAAItB,IAAI,CAAZ,EAAeA,IAAI,KAAKhB,KAAL,CAAWiB,MAA9B,EAAqCD,GAArC,EAAyC;AACrC,gBAAG,KAAKhB,KAAL,CAAWgB,CAAX,EAAcsB,MAAd,IAAwBA,MAA3B,EAAkC;AAC9B,uBAAOtB,CAAP;AACH;AACJ;AACD,eAAO,CAAC,CAAR;AACH,KAnZI;AAoZL6D,mBAAc,uBAAStC,KAAT,EAAe;AACzB,YAAIuC,QAAM,KAAK9E,KAAL,CAAWiB,MAArB;AACA,YAAI8D,MAAM,CAACxC,QAAQ,KAAKlC,SAAb,GAAyByE,KAA1B,IAAmCA,KAA7C;AACA,eAAOC,GAAP;AACH,KAxZI;AAyZLpC,qBAAgB,yBAASL,MAAT,EAAgB;AAC5B,YAAIC,QAAQ,KAAKF,gBAAL,CAAsBC,MAAtB,CAAZ;AACA,YAAII,OAAO,KAAK1C,KAAL,CAAWuC,KAAX,CAAX;AACA,eAAOG,IAAP;AACH,KA7ZI;AA8ZLsC,cAAS,oBAAU;AAChB,YAAIC,MAAI,EAAR;AACAA,YAAIT,IAAJ,CAAS,IAAT;AACAS,YAAIT,IAAJ,CAAS,KAAKzE,MAAL,CAAYmF,QAArB;AACAD,YAAIT,IAAJ,CAAS,GAAT;AACAS,YAAIT,IAAJ,CAAS,KAAKzE,MAAL,CAAYoF,KAArB;AACAF,YAAIT,IAAJ,CAAS,IAAT;AACAS,YAAIT,IAAJ,CAAS,KAAKzE,MAAL,CAAYqF,SAAZ,IAAuB,IAAvB,GAA4B,IAA5B,GAAiC,IAA1C;AACAH,YAAIT,IAAJ,CAAS,GAAT;AACAS,YAAIT,IAAJ,CAAS,KAAKzE,MAAL,CAAYsF,OAAZ,IAAqB,IAArB,GAA0B,KAA1B,GAAgC,KAAzC;AACAJ,YAAIT,IAAJ,CAAS,KAAKzE,MAAL,CAAYuF,KAAZ,GAAkB,QAAlB,GAA2B,EAApC;AACA,eAAOL,IAAIM,IAAJ,CAAS,EAAT,CAAP;AACF,KA1aI;AA2aLC,eAAU,qBAAU;AAChB,eAAO,KAAKtF,OAAL,IAAcY,GAAGC,WAAH,CAAeuB,MAApC;AACH,KA7aI;AA8aLmD,aAAQ,iBAASnD,MAAT,EAAgB;AACpB,YAAII,OAAK,KAAKC,eAAL,CAAqBL,MAArB,CAAT;AACA,eAAOI,KAAKjB,KAAZ;AACH,KAjbI;AAkbLiE,mBAAc,uBAAS9D,IAAT,EAAc;AACxB,YAAI+D,mBAAiB,SAAjBA,gBAAiB,GAAU;AAC3BnG,eAAGwE,QAAH,CAAYC,SAAZ,CAAsB,QAAtB,EAA+B,YAAU;AACrCnD,mBAAGkB,GAAH,CAAO4D,IAAP;AACA9E,mBAAGgD,EAAH,CAAM+B,IAAN;AACH,aAHD;AAIH,SALD;;AAOA,YAAIC,iBAAe,SAAfA,cAAe,CAASC,GAAT,EAAa;AAC3BjF,eAAGgD,EAAH,CAAM+B,IAAN;AACA/E,eAAGkF,KAAH,CAASjC,IAAT,CAAc,IAAd,EAAmBgC,GAAnB,EAAuB,IAAvB,EAA4B,KAA5B,EAF2B,CAES;AACxC,SAHD;AAIAjF,WAAGkB,GAAH,CAAOiE,IAAP,GAAY,UAAQrE,KAAKa,EAAb,GAAgB,GAAhB,GAAoBb,KAAKsE,IAAzB,GAA8B,UAA9B,GAAyCtE,KAAK9B,MAA9C,GAAqD,SAArD,GAA+D8B,KAAKuE,KAApE,GAA0E,QAA1E,GAAmFvE,KAAKwE,IAAxF,GAA6F,QAA7F,GAAsGxE,KAAKyE,IAAvH;AACAvF,WAAGkB,GAAH,CAAOsE,OAAP,CAAeX,gBAAf,EAAgCG,cAAhC;AACH;;AAhcI,CAAT","file":"SocketIOManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        dataEventHandler:null, //处理socket.io发过来的数据的节点\r\n        roomId:null,\r\n        config:null,\r\n        seats:null,\r\n        round:null,            //当前第几局,算剩余几局用config.round-this.round\r\n        creator:null,          //房主ID\r\n        chupai:null,           //出的牌\r\n        caishen:null,          //财神 \r\n        seatIndex:-1,          //座位Index\r\n        bankerIndex:-1,          //庄Index\r\n        turn:-1,               //轮到谁出牌了\r\n        mjsy:0,                //剩余麻将\r\n        needCheckIp:false,\r\n        status:'idle',         //状态  idle,beging\r\n        actions:null,          //玩家可以做操作\r\n\r\n    },\r\n    onLoad () {\r\n    },\r\n\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n    reset:function(){\r\n        th.userManager.roomId=null;\r\n        this.roomId=null;\r\n        this.config=null;\r\n        this.seats=null;\r\n        this.round=null;\r\n        this.creator=null;\r\n        this.chupai=-1;\r\n        this.caishen=null;\r\n        this.seatIndex=-1;\r\n        this.bankerIndex=-1;\r\n        this.turn=-1;\r\n        this.mjsy=0;\r\n        this.needCheckIp=false;\r\n        this.status='idle';\r\n        this.actions=null;\r\n        for(var i = 0; i < this.seats.length;i++){\r\n            this.seats[i].holds = [];\r\n            this.seats[i].folds = [];\r\n            this.seats[i].chis = [];\r\n            this.seats[i].pengs = [];\r\n            this.seats[i].angangs = [];\r\n            this.seats[i].diangangs = [];\r\n            this.seats[i].bugangs = [];\r\n            this.seats[i].ready = false;\r\n        }\r\n    },\r\n    dispatchEvent(event,data){\r\n        if(this.dataEventHandler){\r\n            this.dataEventHandler.emit(event,data);\r\n        }    \r\n    },\r\n    initHandlers:function(){\r\n        var self = this;\r\n        //连接成功初始化信息\r\n        th.sio.addHandler(\"init_room\",function(data){\r\n            cc.log(\"==>SocketIOManager init_room:\",JSON.stringify(data));\r\n            self.roomId=data.roomId;\r\n            self.config=data.config;\r\n            self.seats=data.seats;\r\n            self.round=data.round;\r\n            self.creator=data.creator;\r\n            self.seatIndex=self.getSeatIndexById(th.userManager.userId);\r\n            self.dispatchEvent(\"init_room\",data);\r\n        });\r\n        //其他玩家加入房间\r\n        th.sio.addHandler(\"join_push\",function(data){\r\n            cc.log(\"==>SocketIOManager join_push:\",JSON.stringify(data));\r\n            var index=data.index;\r\n            if(self.seats[index].userId){\r\n                self.seats[index].online = true;\r\n                if(self.seats[index].ip != data.ip){\r\n                    self.seats[index].ip = data.ip;\r\n                    self.needCheckIp=true;\r\n                }\r\n            }else{\r\n                self.seats[index] = data;\r\n                self.needCheckIp=true;\r\n            }\r\n            self.dispatchEvent(\"join_push\",self.seats[index]);\r\n            if(self.needCheckIp){\r\n                self.dispatchEvent('check_ip',self.seats[index]);\r\n            }\r\n        });\r\n        //自己离开房间\r\n        th.sio.addHandler(\"leave_result\",function(data){\r\n            self.reset();\r\n        });\r\n        //其他玩家离开房间\r\n        th.sio.addHandler(\"leave_push\",function(data){\r\n            cc.log(\"==>SocketIOManager leave_push:\",JSON.stringify(data));\r\n            var userId=data.userId;\r\n            var seat=self.getSeatByUserId(userId);\r\n            if(seat){\r\n                seat.userId=null;\r\n                seat.name=null;\r\n                seat.headImgUrl=null;\r\n                seat.sex=null;\r\n                seat.sex=null;\r\n                seat.score=0;\r\n                seat.ready=false;\r\n                seat.online=false;\r\n            }\r\n            self.dispatchEvent(\"leave_push\",seat);\r\n        });\r\n        //解散房间，所有玩家退出房间，收到此消息返回大厅\r\n        th.sio.addHandler(\"dissolve_push\",function(data){\r\n            self.reset();\r\n            cc.log(\"==>SocketIOManager dissolve_push:\",JSON.stringify(data));\r\n        });\r\n        //其他玩家断线\r\n        th.sio.addHandler(\"offline_push\",function(data){\r\n            cc.log(\"==>SocketIOManager offline_push:\",JSON.stringify(data));\r\n            if(self.roomId!=null){\r\n                self.dispatchEvent(\"offline_push\",data);\r\n            }\r\n        });\r\n        //其他玩家上线\r\n        th.sio.addHandler(\"online_push\",function(data){\r\n            cc.log(\"==>SocketIOManager online_push:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"online_push\",data);\r\n        });\r\n        //自己准备返回\r\n        th.sio.addHandler(\"ready_result\",function(data){\r\n            cc.log(\"==>SocketIOManager ready_result:\",JSON.stringify(data));\r\n            var seat = self.getSeatByUserId(th.userManager.userId);\r\n            seat.ready=true;\r\n            self.dispatchEvent(\"ready_result\",seat);\r\n        });\r\n        //其他玩家准备\r\n        th.sio.addHandler(\"ready_push\",function(data){\r\n            cc.log(\"==>SocketIOManager ready_push:\",JSON.stringify(data));\r\n            var seat = self.getSeatByUserId(data.userId);\r\n            seat.ready=true;\r\n            self.dispatchEvent(\"ready_push\",seat);\r\n        });\r\n        //玩家手上的牌\r\n        th.sio.addHandler(\"holds_push\",function(data){\r\n            cc.log(\"==>SocketIOManager holds_push:\",JSON.stringify(data));\r\n            var seat = self.seats[self.seatIndex]; \r\n            seat.holds=data;\r\n            for(var i = 0; i < self.seats.length; ++i){\r\n                var s = self.seats[i]; \r\n                if(s.folds == null){\r\n                    s.folds = [];\r\n                }\r\n                if(s.angangs == null){\r\n                    s.angangs = [];\r\n                }\r\n                if(s.diangangs == null){\r\n                    s.diangangs = [];\r\n                }\r\n                if(s.bugangs == null){\r\n                    s.bugangs = [];\r\n                }\r\n                if(s.pengs == null){\r\n                    s.pengs = [];\r\n                }\r\n                if(s.chis == null){\r\n                    s.chis = [];\r\n                }\r\n                s.ready = false;\r\n            }\r\n            self.dispatchEvent(\"holds_push\");\r\n        });\r\n        //通知还剩多少张牌\r\n        th.sio.addHandler(\"mjsy_push\",function(data){\r\n            cc.log(\"==>SocketIOManager mjsy_push:\",data);\r\n            self.mjsy=data;\r\n            self.dispatchEvent(\"mjsy_push\");\r\n        });\r\n        //通知当前是第几局\r\n        th.sio.addHandler(\"round_push\",function(data){\r\n            cc.log(\"==>SocketIOManager round_push:\",data);\r\n            self.round=data;\r\n            self.dispatchEvent(\"round_push\");\r\n        });\r\n        //通知财神\r\n        th.sio.addHandler(\"caishen_push\",function(data){\r\n            cc.log(\"==>SocketIOManager caishen_push:\",data);\r\n            self.caishen=data;\r\n            self.dispatchEvent(\"caishen_push\");\r\n        });\r\n        //开始游戏基本消息\r\n        th.sio.addHandler(\"begin_push\",function(data){\r\n            cc.log(\"==>SocketIOManager begin_push:\",data);\r\n            self.bankerIndex=data;\r\n            self.turn=self.bankerIndex;\r\n            self.status=\"begin\";\r\n            self.dispatchEvent(\"begin_push\");\r\n        });\r\n        //谁出牌\r\n        th.sio.addHandler(\"chupai_push\",function(data){\r\n            cc.log(\"==>SocketIOManager chupai_push:\",JSON.stringify(data));\r\n            var turnUserId=data;\r\n            var seatIndex=self.getSeatIndexById(turnUserId);\r\n            self.doTurnChange(seatIndex);\r\n        });\r\n        //出牌时可以做的操作\r\n        th.sio.addHandler(\"action_push\",function(data){\r\n            cc.log(\"==>SocketIOManager action_push:\",JSON.stringify(data));\r\n            self.actions=data;\r\n            self.dispatchEvent(\"action_push\",data);\r\n        });\r\n        th.sio.addHandler(\"guo_result\",function(data){\r\n            self.dispatchEvent('guo_result');\r\n        });\r\n        th.sio.addHandler(\"guo_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexByID(userId);\r\n            self.doGuo(seatIndex,data.pai);\r\n        });\r\n        th.sio.addHandler(\"chi_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexByID(userId);\r\n            self.doChi(seatIndex,data.info,pai);\r\n        });\r\n        th.sio.addHandler(\"peng_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexByID(userId);\r\n            self.doPeng(seatIndex,data.info);\r\n        });\r\n        th.sio.addHandler(\"gang_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexByID(userId);\r\n            self.doGang(seatIndex,data.info,data.gangType);\r\n        });\r\n        th.sio.addHandler(\"chupai_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexByID(userId);\r\n            self.doChupai(seatIndex,pai);\r\n        });\r\n        th.sio.addHandler(\"mopai_push\",function(data){\r\n            self.doMopai(self.seatIndex,data);\r\n        });\r\n\r\n        th.sio.addHandler(\"hu_notify_push\",function(data){\r\n            self.doHu(data);\r\n        });\r\n        //断线\r\n        th.sio.addHandler(\"disconnect\",function(data){\r\n            if(self.roomId == null){\r\n                th.wc.show('正在返回游戏大厅');\r\n                cc.director.loadScene(\"hall\");\r\n            }else{\r\n                if(self.isOver == false){\r\n                    th.userManager.roomId = self.roomId;\r\n                    self.dispatchEvent(\"disconnect\");                    \r\n                }else{\r\n                    self.roomId=null;\r\n                    self.config=null;\r\n                    self.seats=null;\r\n                    self.round=null;\r\n                    self.seatIndex=-1;\r\n                }\r\n            }\r\n        });\r\n       \r\n    },\r\n    getGangType:function(seatData,pai){\r\n        var idx=-1;\r\n        for(var i=0;i<seatData.pengs.length;i++){\r\n            if(seatData.pengs[i].mjid==pai){\r\n                idx=i;\r\n                break;\r\n            }\r\n        }\r\n        if(idx != -1){\r\n            return \"bugang\";\r\n        }else{\r\n            var cnt = 0;\r\n            for(var i = 0; i < seatData.holds.length; ++i){\r\n                if(seatData.holds[i] == pai){\r\n                    cnt++;\r\n                }\r\n            }\r\n            if(cnt == 3){\r\n                return \"diangang\";\r\n            }else{\r\n                return \"angang\";\r\n            }\r\n        }\r\n    },\r\n    doGuo:function(seatIndex,pai){\r\n        var seatData = this.seats[seatIndex];\r\n        var folds = seatData.folds;\r\n        folds.push(pai);\r\n        this.dispatchEvent('guo_notify_push',seatData);    \r\n    },\r\n    doChi:function(seatIndex,info,pai){\r\n        var seatData = this.seats[seatIndex];\r\n        //移除手牌\r\n        if(seatData.holds){\r\n            for(var i = 0; i < info.mjids.length; ++i){\r\n                if(info.mjids[i]==pai){\r\n                    continue;\r\n                }\r\n                var idx = seatData.holds.indexOf(info.mjids[i]);\r\n                seatData.holds.splice(idx,1);\r\n            }\r\n            //更新碰牌数据\r\n        }\r\n        var chis = seatData.chis;\r\n        chis.push(info);\r\n        this.dispatchEvent('chi_notify_push',seatData);\r\n    },\r\n    doPeng:function(seatIndex,info){\r\n        var seatData = this.seats[seatIndex];\r\n        //移除手牌\r\n        if(seatData.holds){\r\n            for(var i = 0; i < 2; ++i){\r\n                var idx = seatData.holds.indexOf(info.mjid);\r\n                seatData.holds.splice(idx,1);\r\n            }                \r\n        }\r\n        //更新碰牌数据\r\n        var pengs = seatData.pengs;\r\n        pengs.push(info);\r\n        this.dispatchEvent('peng_notify_push',seatData);\r\n    },\r\n    doGang:function(seatIndex,info,gangType){\r\n        var seatData = this.seats[seatIndex];\r\n        var pai=info.mjid;\r\n        if(!gangType){\r\n            gangType = this.getGangType(seatData,pai);\r\n        }\r\n        if(gangType == \"bugang\"){\r\n            var idx=-1;\r\n            for(var i=0;i<seatData.pengs.length;i++){\r\n                if(seatData.pengs[i].mjid==pai){\r\n                    idx=i;\r\n                    break;\r\n                }\r\n            }\r\n            if(idx != -1){\r\n                 seatData.pengs.splice(idx,1);\r\n            }\r\n            seatData.bugangs.push(info);      \r\n        }\r\n        if(seatData.holds){\r\n            for(var i = 0; i <= 4; ++i){\r\n                var idx = seatData.holds.indexOf(pai);\r\n                if(idx == -1){\r\n                    //如果没有找到，表示移完了，直接跳出循环\r\n                    break;\r\n                }\r\n                seatData.holds.splice(idx,1);\r\n            }\r\n        }\r\n        if(gangType == \"angang\"){\r\n            seatData.angangs.push(info);\r\n        }\r\n        else if(gangType == \"diangang\"){\r\n            seatData.diangangs.push(info);\r\n        }\r\n        this.dispatchEvent('gang_notify_push',{seatData:seatData,gangType:gangType});\r\n    },\r\n    doChupai:function(seatIndex,pai){\r\n        this.chupai = pai;\r\n        var seatData = this.seats[seatIndex];\r\n        if(seatData.holds){             \r\n            var idx = seatData.holds.indexOf(pai);\r\n            seatData.holds.splice(idx,1);\r\n        }\r\n        this.dispatchEvent('chupai_notify_push',{seatData:seatData,pai:pai});    \r\n    },\r\n    doMopai:function(seatIndex,pai){\r\n        var seatData = this.seats[seatIndex];\r\n        if(seatData.holds){\r\n            seatData.holds.push(pai);\r\n            this.dispatchEvent('mopai_push',{seatIndex:seatIndex,pai:pai});            \r\n        }\r\n    },\r\n    doHu:function(seatIndex,pai){\r\n    },\r\n    doTurnChange:function(seatIndex){\r\n        var data = {\r\n            last:this.turn,\r\n            turn:seatIndex,\r\n        }\r\n        this.turn = seatIndex;\r\n        this.dispatchEvent('chupai_push',data);\r\n    },\r\n    getSeatIndexById:function(userId){\r\n        for(var i = 0; i < this.seats.length;i++){\r\n            if(this.seats[i].userId == userId){\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n    getLocalIndex:function(index){\r\n        var total=this.seats.length;\r\n        var ret = (index - this.seatIndex + total) % total;\r\n        return ret;\r\n    },\r\n    getSeatByUserId:function(userId){\r\n        var index = this.getSeatIndexById(userId);\r\n        var seat = this.seats[index];\r\n        return seat;\r\n    },\r\n    getWanfa:function(){\r\n       var str=[];\r\n       str.push(\"封顶\");\r\n       str.push(this.config.fengding)\r\n       str.push(\"/\");\r\n       str.push(this.config.difen)\r\n       str.push(\"分/\");\r\n       str.push(this.config.zuozhuang=='QZ'?'抢庄':'轮庄')\r\n       str.push(\"/\");\r\n       str.push(this.config.payment=='FZ'?'房主付':'AA付')\r\n       str.push(this.config.ctdsq?'/吃吐荡三圈':'');\r\n       return str.join(\"\");\r\n    },\r\n    isFangzhu:function(){\r\n        return this.creator==th.userManager.userId;\r\n    },\r\n    isReady:function(userId){\r\n        var seat=this.getSeatByUserId(userId);\r\n        return seat.ready;\r\n    },\r\n    connectServer:function(data){\r\n        var onConnectSuccess=function(){\r\n            cc.director.loadScene(\"mjgame\",function(){\r\n                th.sio.ping();\r\n                th.wc.hide();\r\n            });\r\n        }\r\n\r\n        var onConnectError=function(err){\r\n             th.wc.hide();\r\n             th.alert.show('提示',err,null,false); //\r\n        }\r\n        th.sio.addr=\"ws://\"+data.ip+\":\"+data.port+\"?roomId=\"+data.roomId+\"&token=\"+data.token+\"&sign=\"+data.sign+\"&time=\"+data.time;\r\n        th.sio.connect(onConnectSuccess,onConnectError);\r\n    }\r\n    \r\n\r\n});\r\n"]}