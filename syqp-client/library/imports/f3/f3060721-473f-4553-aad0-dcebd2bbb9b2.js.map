{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\SocketIOManager.js"],"names":["cc","Class","extends","Component","properties","dataEventHandler","isRepeatLogin","roomId","config","seats","round","creator","chupai","caishen","seatIndex","bankerIndex","turn","mjsy","needCheckIp","status","actions","isOver","onLoad","resetGame","resetRound","th","userManager","i","length","holds","folds","chis","pengs","angangs","diangangs","bugangs","ready","isHu","dispatchEvent","event","data","emit","initHandlers","self","sio","addHandler","log","JSON","stringify","getSeatIndexById","userId","index","online","ip","seat","sd","getSeatByUserId","console","name","headImgUrl","sex","score","s","turnUserId","doTurnChange","pai","doGuo","doChi","info","doPeng","doGang","gangType","doChupai","doMopai","doHu","results","totalScore","endInfo","alert","show","wc","director","loadScene","getGangType","seatData","idx","mjid","cnt","push","mjids","indexOf","splice","last","parseInt","getLocalIndex","total","ret","getWanfa","str","fengding","difen","zuozhuang","payment","ctdsq","join","isFangzhu","isReady","connectServer","onConnectSuccess","ping","hide","onConnectError","err","addr","port","token","sign","time","connect"],"mappings":"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","file":"SocketIOManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        dataEventHandler:null, //处理socket.io发过来的数据的节点\r\n        isRepeatLogin:false,\r\n        roomId:null,\r\n        config:null,\r\n        seats:null,\r\n        round:null,            //当前第几局,算剩余几局用config.round-this.round\r\n        creator:null,          //房主ID\r\n        chupai:null,           //出的牌\r\n        caishen:null,          //财神 \r\n        seatIndex:-1,          //座位Index\r\n        bankerIndex:-1,          //庄Index\r\n        turn:-1,               //轮到谁出牌了\r\n        mjsy:0,                //剩余麻将\r\n        needCheckIp:false,\r\n        status:'idle',         //状态  idle,beging\r\n        actions:null,          //玩家可以做操作\r\n        isOver:false,\r\n    },\r\n    onLoad () {\r\n    },\r\n\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n    resetGame:function(){\r\n        this.resetRound();\r\n        th.userManager.roomId=null;\r\n        this.isRepeatLogin=false;\r\n        //this.roomId=null;\r\n        this.config=null;\r\n        this.seats=null;\r\n        this.creator=null;\r\n        this.isOver=true,\r\n        this.seatIndex=-1;\r\n    },\r\n    resetRound:function(){\r\n        this.chupai=-1;\r\n        this.caishen=null;\r\n        this.bankerIndex=-1;\r\n        this.turn=-1;\r\n        this.mjsy=0;\r\n        this.needCheckIp=false;\r\n        this.status='idle';\r\n        this.actions=null;\r\n        for(var i = 0; i < this.seats.length;i++){\r\n            this.seats[i].holds = [];\r\n            this.seats[i].folds = [];\r\n            this.seats[i].chis = [];\r\n            this.seats[i].pengs = [];\r\n            this.seats[i].angangs = [];\r\n            this.seats[i].diangangs = [];\r\n            this.seats[i].bugangs = [];\r\n            this.seats[i].ready = false;\r\n            this.seats[i].isHu = false;\r\n        }\r\n    },\r\n    dispatchEvent(event,data){\r\n        if(this.dataEventHandler){\r\n            this.dataEventHandler.emit(event,data);\r\n        }    \r\n    },\r\n    initHandlers:function(){\r\n        var self = this;\r\n        //连接成功初始化信息\r\n        th.sio.addHandler(\"init_room\",function(data){\r\n            cc.log(\"==>SocketIOManager init_room:\",JSON.stringify(data));\r\n            self.roomId=data.roomId;\r\n            self.config=data.config;\r\n            self.seats=data.seats;\r\n            self.round=data.round;\r\n            self.creator=data.creator;\r\n            self.seatIndex=self.getSeatIndexById(th.userManager.userId);\r\n            self.dispatchEvent(\"init_room\",data);\r\n        });\r\n        //其他玩家加入房间\r\n        th.sio.addHandler(\"join_push\",function(data){\r\n            cc.log(\"==>SocketIOManager join_push:\",JSON.stringify(data));\r\n            var index=data.index;\r\n            if(self.seats[index].userId){\r\n                self.seats[index].online = true;\r\n                if(self.seats[index].ip != data.ip){\r\n                    self.seats[index].ip = data.ip;\r\n                    self.needCheckIp=true;\r\n                }\r\n            }else{\r\n                self.seats[index] = data;\r\n                self.needCheckIp=true;\r\n            }\r\n            self.dispatchEvent(\"join_push\",self.seats[index]);\r\n            if(self.needCheckIp){\r\n                self.dispatchEvent('check_ip',self.seats[index]);\r\n            }\r\n        });\r\n        //自己离开房间\r\n        th.sio.addHandler(\"leave_result\",function(data){\r\n            self.roomId=null;\r\n            self.resetGame();\r\n        });\r\n        //步整个信息给客户端\r\n        th.sio.addHandler(\"sync_push\",function(data){\r\n            cc.log(\"==>SocketIOManager sync_push:\",JSON.stringify(data));\r\n            self.mjsy=data.mjsy;\r\n            self.status=data.status;\r\n            self.turn=data.turn;\r\n            self.bankerIndex=data.bankerIndex;\r\n            self.chupai=data.chupai;\r\n            self.caishen=data.caishen;\r\n            for(var i=0;i<data.seats.length;i++){\r\n                var seat=self.seats[i];\r\n                var sd=data.seats[i];\r\n                seat.holds=sd.holds;\r\n                seat.folds=sd.folds;\r\n                seat.angangs=sd.angangs;\r\n                seat.diangangs=sd.diangangs;\r\n                seat.bugangs=sd.bugangs;\r\n                seat.pengs=sd.pengs;\r\n                seat.chis=sd.chis;\r\n                seat.ready=sd.ready;\r\n            }\r\n            self.dispatchEvent('sync_push');\r\n            self.dispatchEvent(\"mjsy_push\");\r\n            self.dispatchEvent(\"caishen_push\");\r\n        });\r\n        //其他玩家离开房间\r\n        th.sio.addHandler(\"leave_push\",function(data){\r\n            cc.log(\"==>SocketIOManager leave_push:\",JSON.stringify(data));\r\n            var userId=data.userId;\r\n            var seat=self.getSeatByUserId(userId);\r\n            console.log(\"leave:\",seat);\r\n            if(seat){\r\n                seat.userId=null;\r\n                seat.name=null;\r\n                seat.headImgUrl=null;\r\n                seat.sex=null;\r\n                seat.score=0;\r\n                seat.ready=false;\r\n                seat.online=false;\r\n            }\r\n            self.dispatchEvent(\"leave_push\",seat);\r\n        });\r\n        //解散房间，所有玩家退出房间，收到此消息返回大厅\r\n        th.sio.addHandler(\"dissolve_push\",function(data){\r\n            self.roomId=null;\r\n            self.resetGame();\r\n            cc.log(\"==>SocketIOManager dissolve_push:\",JSON.stringify(data));\r\n        });\r\n        //其他玩家断线\r\n        th.sio.addHandler(\"offline_push\",function(data){\r\n            cc.log(\"==>SocketIOManager offline_push:\",JSON.stringify(data));\r\n            if(self.roomId!=null&&!self.isOver){\r\n                self.dispatchEvent(\"offline_push\",data);\r\n            }\r\n        });\r\n        //其他玩家上线\r\n        th.sio.addHandler(\"online_push\",function(data){\r\n            cc.log(\"==>SocketIOManager online_push:\",JSON.stringify(data));\r\n            self.dispatchEvent(\"online_push\",data);\r\n        });\r\n        //自己准备返回\r\n        th.sio.addHandler(\"ready_result\",function(data){\r\n            cc.log(\"==>SocketIOManager ready_result:\",JSON.stringify(data));\r\n            var seat = self.getSeatByUserId(th.userManager.userId);\r\n            seat.ready=true;\r\n            self.dispatchEvent(\"ready_result\",seat);\r\n        });\r\n        //其他玩家准备\r\n        th.sio.addHandler(\"ready_push\",function(data){\r\n            cc.log(\"==>SocketIOManager ready_push:\",JSON.stringify(data));\r\n            var seat = self.getSeatByUserId(data.userId);\r\n            seat.ready=true;\r\n            self.dispatchEvent(\"ready_push\",seat);\r\n        });\r\n        //玩家手上的牌\r\n        th.sio.addHandler(\"holds_push\",function(data){\r\n            cc.log(\"==>SocketIOManager holds_push:\",JSON.stringify(data));\r\n            var seat = self.seats[self.seatIndex]; \r\n            seat.holds=data;\r\n            for(var i = 0; i < self.seats.length; ++i){\r\n                var s = self.seats[i]; \r\n                if(s.folds == null){\r\n                    s.folds = [];\r\n                }\r\n                if(s.angangs == null){\r\n                    s.angangs = [];\r\n                }\r\n                if(s.diangangs == null){\r\n                    s.diangangs = [];\r\n                }\r\n                if(s.bugangs == null){\r\n                    s.bugangs = [];\r\n                }\r\n                if(s.pengs == null){\r\n                    s.pengs = [];\r\n                }\r\n                if(s.chis == null){\r\n                    s.chis = [];\r\n                }\r\n                s.ready = false;\r\n            }\r\n            self.dispatchEvent(\"holds_push\");\r\n        });\r\n        //通知还剩多少张牌\r\n        th.sio.addHandler(\"mjsy_push\",function(data){\r\n            cc.log(\"==>SocketIOManager mjsy_push:\",data);\r\n            self.mjsy=data;\r\n            self.dispatchEvent(\"mjsy_push\");\r\n        });\r\n        //通知当前是第几局\r\n        th.sio.addHandler(\"round_push\",function(data){\r\n            cc.log(\"==>SocketIOManager round_push:\",data);\r\n            self.round=data;\r\n            self.dispatchEvent(\"round_push\");\r\n        });\r\n        //通知财神\r\n        th.sio.addHandler(\"caishen_push\",function(data){\r\n            cc.log(\"==>SocketIOManager caishen_push:\",data);\r\n            self.caishen=data;\r\n            self.dispatchEvent(\"caishen_push\");\r\n        });\r\n        //开始游戏基本消息\r\n        th.sio.addHandler(\"begin_push\",function(data){\r\n            cc.log(\"==>SocketIOManager begin_push:\",data);\r\n            self.bankerIndex=data;\r\n            self.turn=self.bankerIndex;\r\n            self.status=\"begin\";\r\n            self.dispatchEvent(\"begin_push\");\r\n        });\r\n        //谁出牌\r\n        th.sio.addHandler(\"chupai_push\",function(data){\r\n            cc.log(\"==>SocketIOManager chupai_push:\",JSON.stringify(data));\r\n            var turnUserId=data;\r\n            var seatIndex=self.getSeatIndexById(turnUserId);\r\n            self.doTurnChange(seatIndex);\r\n        });\r\n        //出牌时可以做的操作\r\n        th.sio.addHandler(\"action_push\",function(data){\r\n            cc.log(\"==>SocketIOManager action_push:\",JSON.stringify(data));\r\n            self.actions=data;\r\n            self.dispatchEvent(\"action_push\",data);\r\n        });\r\n        th.sio.addHandler(\"guo_result\",function(data){\r\n            self.dispatchEvent('guo_result');\r\n        });\r\n        th.sio.addHandler(\"guo_notify_push\",function(data){\r\n            //console.log(\"socketIOManager guo_notify_push:\",data);\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexById(userId);\r\n            self.doGuo(seatIndex,data.pai);\r\n        });\r\n        th.sio.addHandler(\"chi_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexById(userId);\r\n            self.doChi(seatIndex,data.info,pai);\r\n        });\r\n        th.sio.addHandler(\"peng_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexById(userId);\r\n            self.doPeng(seatIndex,data.info);\r\n        });\r\n        th.sio.addHandler(\"hangang_notify_push\",function(data){\r\n            self.dispatchEvent(\"hangang_notify_push\",data);\r\n        });\r\n        th.sio.addHandler(\"gang_notify_push\",function(data){\r\n            console.log(\"socketIOManager gang_notify_push:\",data);\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexById(userId);\r\n            self.doGang(seatIndex,data.info,data.gangType);\r\n        });\r\n        th.sio.addHandler(\"chupai_notify_push\",function(data){\r\n            var userId = data.userId;\r\n            var pai = data.pai;\r\n            var seatIndex = self.getSeatIndexById(userId);\r\n            self.doChupai(seatIndex,pai);\r\n        });\r\n        th.sio.addHandler(\"mopai_push\",function(data){\r\n            self.doMopai(self.seatIndex,data);\r\n        });\r\n        th.sio.addHandler(\"hu_push\",function(data){\r\n            console.log(\"socketIOManager hu_push:\",data);\r\n            self.doHu(data);\r\n        });\r\n        th.sio.addHandler(\"hu_notify_push\",function(data){\r\n            self.doHu(data);\r\n        });\r\n        th.sio.addHandler(\"game_over_push\",function(data){\r\n            var results = data.results;\r\n            for(var i = 0; i <  self.seats.length; i++){\r\n                self.seats[i].score = results.length == 0? 0:results[i].totalScore;\r\n            }\r\n            for(var i = 0; i <  self.seats.length; ++i){\r\n                self.dispatchEvent('score_push',self.seats[i]);    \r\n            }\r\n            self.dispatchEvent(\"game_over\",results);\r\n            if(data.endInfo){\r\n                self.isOver = true;\r\n                self.dispatchEvent('game_end',data.endInfo);    \r\n                self.resetGame();\r\n            }else{\r\n                self.resetRound();\r\n                self.dispatchEvent('clean_push');  \r\n            }\r\n           \r\n            \r\n        });\r\n        th.sio.addHandler(\"repeat_login\",function(data){\r\n            self.resetGame();\r\n            self.isRepeatLogin=true;\r\n            self.dispatchEvent('repeat_login'); \r\n        });\r\n        \r\n        //断线\r\n        th.sio.addHandler(\"disconnect\",function(data){\r\n            /*\r\n               th.alert.show(\"提示\",\"您的账号已在别处登录！\",function(){\r\n                th.wc.show('正在返回登录场景');\r\n                cc.director.loadScene(\"login\");\r\n            },false);\r\n            */\r\n            if(self.isRepeatLogin){\r\n                cc.log(\"disconnect==>>self.isRepeatLogin\");\r\n                self.isRepeatLogin=true;\r\n                th.alert.show(\"提示\",\"您的账号已在别处登录！\",function(){\r\n                    th.wc.show('正在返回登录场景');\r\n                    cc.director.loadScene(\"login\");\r\n                },false);\r\n            }else if(self.roomId == null){\r\n                cc.log(\"disconnect==>>self.roomId == null\");\r\n                th.userManager.roomId = null;\r\n                th.wc.show('正在返回游戏大厅');\r\n                cc.director.loadScene(\"hall\");\r\n            }else{\r\n                if(self.isOver == false){\r\n                    cc.log(\"disconnect==>>self.isOver == false\");\r\n                    th.userManager.roomId = self.roomId;\r\n                    self.dispatchEvent(\"disconnect\");                    \r\n                }else{\r\n                    cc.log(\"disconnect==>>self.isOver == false\");\r\n                    th.userManager.roomId=null;\r\n                    self.roomId=null;\r\n                    self.config=null;\r\n                    self.seats=null;\r\n                    self.round=null;\r\n                    self.seatIndex=-1;\r\n                }\r\n            }\r\n        });\r\n       \r\n    },\r\n    getGangType:function(seatData,pai){\r\n        var idx=-1;\r\n        for(var i=0;i<seatData.pengs.length;i++){\r\n            if(seatData.pengs[i].mjid==pai){\r\n                idx=i;\r\n                break;\r\n            }\r\n        }\r\n        if(idx != -1){\r\n            return \"bugang\";\r\n        }else{\r\n            var cnt = 0;\r\n            for(var i = 0; i < seatData.holds.length; ++i){\r\n                if(seatData.holds[i] == pai){\r\n                    cnt++;\r\n                }\r\n            }\r\n            if(cnt == 3){\r\n                return \"diangang\";\r\n            }else{\r\n                return \"angang\";\r\n            }\r\n        }\r\n    },\r\n    doGuo:function(seatIndex,pai){\r\n        var seatData = this.seats[seatIndex];\r\n        var folds = seatData.folds;\r\n        folds.push(pai.mjid);\r\n        this.dispatchEvent('guo_notify_push',seatData);    \r\n    },\r\n    doChi:function(seatIndex,info,pai){\r\n        var seatData = this.seats[seatIndex];\r\n        //移除手牌\r\n        if(seatData.holds){\r\n            for(var i = 0; i < info.mjids.length; ++i){\r\n                if(info.mjids[i]==pai){\r\n                    continue;\r\n                }\r\n                var idx = seatData.holds.indexOf(info.mjids[i]);\r\n                seatData.holds.splice(idx,1);\r\n            }\r\n            //更新碰牌数据\r\n        }\r\n        var chis = seatData.chis;\r\n        chis.push(info);\r\n        this.dispatchEvent('chi_notify_push',seatData);\r\n    },\r\n    doPeng:function(seatIndex,info){\r\n        var seatData = this.seats[seatIndex];\r\n        //移除手牌\r\n        if(seatData.holds){\r\n            for(var i = 0; i < 2; ++i){\r\n                var idx = seatData.holds.indexOf(info.mjid);\r\n                seatData.holds.splice(idx,1);\r\n            }                \r\n        }\r\n        //更新碰牌数据\r\n        var pengs = seatData.pengs;\r\n        pengs.push(info);\r\n        this.dispatchEvent('peng_notify_push',seatData);\r\n    },\r\n    doGang:function(seatIndex,info,gangType){\r\n        console.log(\"gangType\",gangType,\" info:\",info);\r\n        var seatData = this.seats[seatIndex];\r\n        var pai=info.mjid;\r\n        if(!gangType){\r\n            gangType = this.getGangType(seatData,pai);\r\n        }\r\n        if(gangType == \"bugang\"){\r\n            var idx=-1;\r\n            for(var i=0;i<seatData.pengs.length;i++){\r\n                if(seatData.pengs[i].mjid==pai){\r\n                    idx=i;\r\n                    break;\r\n                }\r\n            }\r\n            if(idx != -1){\r\n                 seatData.pengs.splice(idx,1);\r\n            }\r\n            seatData.bugangs.push(info);      \r\n        }\r\n        if(seatData.holds){\r\n            for(var i = 0; i <= 4; ++i){\r\n                var idx = seatData.holds.indexOf(pai);\r\n                if(idx == -1){\r\n                    //如果没有找到，表示移完了，直接跳出循环\r\n                    break;\r\n                }\r\n                seatData.holds.splice(idx,1);\r\n            }\r\n        }\r\n        if(gangType == \"angang\"){\r\n            seatData.angangs.push(info);\r\n        }\r\n        else if(gangType == \"diangang\"){\r\n            seatData.diangangs.push(info);\r\n        }\r\n        this.dispatchEvent('gang_notify_push',seatData);\r\n    },\r\n    doChupai:function(seatIndex,pai){\r\n        this.chupai = pai;\r\n        var seatData = this.seats[seatIndex];\r\n        if(seatData.holds){             \r\n            var idx = seatData.holds.indexOf(pai);\r\n            seatData.holds.splice(idx,1);\r\n        }\r\n        this.dispatchEvent('chupai_notify_push',{seatData:seatData,pai:pai});    \r\n    },\r\n    doMopai:function(seatIndex,pai){\r\n        var seatData = this.seats[seatIndex];\r\n        if(seatData.holds){\r\n            seatData.holds.push(pai);\r\n            this.dispatchEvent('mopai_push',{seatIndex:seatIndex,pai:pai});            \r\n        }\r\n    },\r\n    doHu:function(data){\r\n        this.dispatchEvent('hu_push',data);\r\n    },\r\n    doTurnChange:function(seatIndex){\r\n        var data = {\r\n            last:this.turn,\r\n            turn:seatIndex,\r\n        }\r\n        this.turn = seatIndex;\r\n        this.dispatchEvent('chupai_push',data);\r\n    },\r\n    getSeatIndexById:function(userId){\r\n        for(var i = 0; i < this.seats.length;i++){\r\n            if(this.seats[i].userId == parseInt(userId)){\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    },\r\n    getLocalIndex:function(index){\r\n        var total=this.seats.length;\r\n        var ret = (index - this.seatIndex + total) % total;\r\n        return ret;\r\n    },\r\n    getSeatByUserId:function(userId){\r\n        var index = this.getSeatIndexById(userId);\r\n        var seat = this.seats[index];\r\n        return seat;\r\n    },\r\n    getWanfa:function(){\r\n       var str=[];\r\n       str.push(\"封顶\");\r\n       str.push(this.config.fengding)\r\n       str.push(\"，\");\r\n       str.push(this.config.difen)\r\n       str.push(\"分，\");\r\n       str.push(this.config.zuozhuang=='QZ'?'抢庄':'轮庄')\r\n       str.push(\"，\");\r\n       str.push(this.config.payment=='FZ'?'房主付':'AA付')\r\n       str.push(this.config.ctdsq?'，吃吐荡三圈':'');\r\n       return str.join(\"\");\r\n    },\r\n    isFangzhu:function(){\r\n        return this.creator==th.userManager.userId;\r\n    },\r\n    isReady:function(userId){\r\n        var seat=this.getSeatByUserId(userId);\r\n        return seat.ready;\r\n    },\r\n    connectServer:function(data){\r\n        var onConnectSuccess=function(){\r\n            cc.director.loadScene(\"mjgame\",function(){\r\n                th.sio.ping();\r\n                th.wc.hide();\r\n            });\r\n        }\r\n\r\n        var onConnectError=function(err){\r\n             th.wc.hide();\r\n             th.alert.show('提示',err,null,false); //\r\n        }\r\n        th.sio.addr=\"ws://\"+data.ip+\":\"+data.port+\"?roomId=\"+data.roomId+\"&token=\"+data.token+\"&sign=\"+data.sign+\"&time=\"+data.time;\r\n        th.sio.connect(onConnectSuccess,onConnectError);\r\n    }\r\n    \r\n\r\n});\r\n"]}