{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\UserManager.js"],"names":["cc","Class","extends","Component","properties","userId","userName","account","sex","headImgUrl","balance","ip","sign","roomId","onLoad","lingshiAuth","th","http","get","onAuth","err","data","log","self","userManager","baseURL","hallAddr","login","callback","errcode","errmsg","id","name","director","loadScene","wc","hide","logout","show","createRoom","config","fnCreate","alert","JSON","stringify","socketIOManager","connectServer","params","joinRoom","fnJoin"],"mappings":"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","file":"UserManager.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        userId:null,\r\n        userName:null,\r\n        account:null,\r\n        sex:null,\r\n        headImgUrl:null,\r\n        balance:0,\r\n        ip:null,\r\n        sign:null,\r\n\r\n        roomId:null,  //登陆时如果不为null,代表用户在房间里，直接加入房间\r\n    },\r\n\r\n    onLoad: function () {\r\n    },\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n\r\n    // start: function (dt) {\r\n\r\n    // },\r\n\r\n    lingshiAuth:function(account){\r\n        th.http.get('/lingshi_auth',{account:account},this.onAuth);\r\n    },\r\n\r\n    onAuth:function(err,data){\r\n        if(err){\r\n            cc.log(\"登录错误================》\");\r\n            cc.log(err);\r\n            return ;\r\n        }\r\n        var self = th.userManager;\r\n        self.account = data.account;\r\n        self.sign = data.sign;\r\n        th.http.baseURL = 'http://'+data.hallAddr;\r\n\r\n        cc.log(th.http.baseURL);\r\n        self.login();\r\n    },\r\n\r\n    login:function(){\r\n        var self = this;\r\n        var callback = function(err,data) {\r\n             if(err||data.errcode){\r\n                 cc.log(err,data.errmsg);\r\n                 return;\r\n             }\r\n             self.sex = data.sex;\r\n             self.userId = data.id;\r\n             self.account = data.account;\r\n             self.balance = data.balance;\r\n             self.userName = data.name;\r\n             self.headImgUrl = data.headImgUrl;\r\n             self.roomId = data.roomId;\r\n             cc.director.loadScene(\"hall\",function(){\r\n                 th.wc.hide();\r\n             });\r\n        };\r\n        th.http.get('/login',{account:self.account,sign:self.sign},callback)\r\n    },\r\n\r\n    logout:function(){\r\n        th.wc.show(\"正在退出房间\");\r\n        var self = this;\r\n        cc.director.loadScene(\"login\",function(){\r\n            self.sex = null;\r\n            self.userId = null;\r\n            self.account = null;\r\n            self.balance = null;\r\n            self.userName = null;\r\n            self.headImgUrl = null;\r\n            self.roomId = null;\r\n            th.wc.hide();\r\n        });\r\n    },\r\n\r\n    createRoom : function(config){\r\n        var fnCreate = function(err,data) {\r\n            if(err||data.errcode){\r\n                th.wc.hide();\r\n                th.alert.show('提示',data.errmsg,null,false); //\r\n            }else{\r\n                cc.log(\"create room data:\"+JSON.stringify(data));\r\n                th.wc.show(\"正在进入房间\");\r\n                th.socketIOManager.connectServer(data);\r\n            }\r\n            \r\n        };\r\n\r\n        var params={\r\n            account:th.userManager.account,\r\n            sign:th.userManager.sign,\r\n            config:JSON.stringify(config)\r\n        }\r\n        th.wc.show(\"正在创建房间\");\r\n        th.http.get('/create_private_room',params,fnCreate);\r\n    },\r\n\r\n    joinRoom : function(roomId,callback){\r\n        var self = this;\r\n        var fnJoin = function(err,data) {\r\n            if(err||data.errcode){\r\n                th.wc.hide();\r\n                if(callback != null){\r\n                    callback(data);\r\n                }\r\n            }else{\r\n                cc.log(\"join room data:\"+JSON.stringify(data));\r\n                if(callback != null){\r\n                    callback(data);\r\n                }\r\n                th.socketIOManager.connectServer(data);\r\n            }\r\n            \r\n        };\r\n\r\n        var params={\r\n            account:th.userManager.account,\r\n            sign:th.userManager.sign,\r\n            roomId:roomId\r\n        }\r\n        th.wc.show(\"正在加入房间\");\r\n        th.http.get('/join_private_room',params,fnJoin);\r\n    }\r\n    \r\n});\r\n"]}