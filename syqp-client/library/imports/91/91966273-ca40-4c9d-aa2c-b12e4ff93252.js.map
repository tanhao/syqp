{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\MJTimePointer.js"],"names":["cc","Class","extends","Component","properties","lblTime","Label","bottomPointer","Sprite","rightPointer","topPointer","leftPointer","_pointers","_countdownEndTime","_alertStartTime","_isPlay","onLoad","console","log","th","socketIOManager","seats","length","push","node","active","initPointer","initEventHandlers","turn","localIndex","getLocalIndex","i","isAcitve","self","on","data","Date","now","update","dt","miao","Math","ceil","string","audioManager","playSFX"],"mappings":"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","file":"MJTimePointer.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       lblTime:cc.Label,\r\n       bottomPointer:cc.Sprite,\r\n       rightPointer:cc.Sprite,\r\n       topPointer:cc.Sprite,\r\n       leftPointer:cc.Sprite,\r\n       _pointers:[],\r\n       _countdownEndTime:0,\r\n       _alertStartTime:0,\r\n       _isPlay:true,\r\n    },\r\n\r\n    onLoad () {\r\n        console.log(\"TimePointer load ....\");\r\n        if(th.socketIOManager.seats.length==4){\r\n            this._pointers.push(this.bottomPointer);\r\n            this._pointers.push(this.rightPointer);\r\n            this._pointers.push(this.topPointer);\r\n            this._pointers.push(this.leftPointer);\r\n        }else if(th.socketIOManager.seats.length==3){\r\n            this._pointers.push(this.bottomPointer);\r\n            this._pointers.push(this.rightPointer);\r\n            this._pointers.push(this.leftPointer);\r\n            this.topPointer.node.active=false;\r\n        }else if(th.socketIOManager.seats.length==2){\r\n            this._pointers.push(this.bottomPointer);\r\n            this._pointers.push(this.topPointer);\r\n            this.rightPointer.node.active=false;\r\n            this.leftPointer.node.active=false;\r\n        }\r\n        this.initPointer();\r\n        this.initEventHandlers();\r\n    },\r\n\r\n    initPointer:function(){\r\n        if(th==null) return;\r\n        this._isPlay=true;\r\n        var turn=th.socketIOManager.turn;\r\n        var localIndex=th.socketIOManager.getLocalIndex(turn);\r\n        for(var i = 0; i < this._pointers.length; ++i){\r\n            var isAcitve=(i == localIndex);\r\n            this._pointers[i].node.active = isAcitve;\r\n        }\r\n    },\r\n\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        this.node.on('begin_push',function(data){\r\n            self.initPointer();\r\n        });\r\n        \r\n        this.node.on('chupai_push',function(data){\r\n            self.initPointer();\r\n            self._countdownEndTime=Date.now()+10*1000;\r\n            self._alertStartTime=Date.now()+7*1000;\r\n            self._isPlay=false;\r\n        });\r\n    },\r\n\r\n    update (dt) {\r\n        var now=Date.now();\r\n        if(this._countdownEndTime > now){\r\n            var miao=Math.ceil((this._countdownEndTime-now)/1000)-1;\r\n            this.lblTime.string=miao<10?(\"0\"+miao):(miao+\"\");\r\n        }\r\n        if(this._alertStartTime<now&&!this._isPlay){\r\n            this._isPlay=true;\r\n            th.audioManager.playSFX(\"timeup_alarm.mp3\");\r\n        }\r\n    },\r\n\r\n\r\n\r\n  \r\n\r\n});\r\n"]}