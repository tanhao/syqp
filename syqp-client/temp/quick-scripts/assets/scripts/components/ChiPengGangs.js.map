{"version":3,"sources":["ChiPengGangs.js"],"names":["cc","Class","extends","Component","properties","onLoad","th","self","myself","node","getChildByName","nodeChiPengGang","realwidth","director","getVisibleSize","width","scale","scaleX","scaleY","on","data","console","log","detail","onChiPengGangChanged","seatData","onGameBegin","seats","socketIOManager","i","hideSide","side","nodeSide","childrenCount","children","active","pengs","angangs","diangangs","bugangs","chis","localIndex","getLocalIndex","seatindex","mahjongManager","getSide","pre","getFoldPre","index","gangs","length","mjid","initChiPengAndGangs","info","flag","nodeCPG","instantiate","pengPrefabLeft","pengPrefabSelf","y","setLocalZOrder","x","sprites","pgroot","getComponentsInChildren","Sprite","sprite","spriteFrame","getEmptySpriteFrame","getSpriteFrameByMJID","name","idx","mjids"],"mappings":"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","file":"ChiPengGangs.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       \r\n    },\r\n\r\n    onLoad: function () {\r\n        if(th==null){\r\n            return;\r\n        }\r\n        var self = this;\r\n        var myself = this.node.getChildByName(\"myself\");\r\n        var nodeChiPengGang = myself.getChildByName(\"ChiPengGang\");\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        var scale = realwidth / 1280;\r\n        nodeChiPengGang.scaleX *= scale;\r\n        nodeChiPengGang.scaleY *= scale;\r\n\r\n        this.node.on('chi_notify',function(data){\r\n            console.log(\"chi_notify\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data);\r\n        });\r\n\r\n        this.node.on('peng_notify',function(data){\r\n            console.log(\"peng_notify\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data);\r\n        });\r\n        \r\n        this.node.on('gang_notify',function(data){\r\n            console.log(\"gang_notify\",data.detail);\r\n            var data = data.detail;\r\n            self.onChiPengGangChanged(data.seatData);\r\n        });\r\n\r\n        this.node.on('begin_push',function(data){\r\n            self.onGameBegin();\r\n        });\r\n\r\n        var seats = th.socketIOManager.seats;\r\n        for(var i in seats){\r\n            this.onChiPengGangChanged(seats[i]);\r\n        }\r\n    },\r\n    onGameBegin:function(){\r\n        this.hideSide(\"myself\");\r\n        this.hideSide(\"right\");\r\n        this.hideSide(\"up\");\r\n        this.hideSide(\"left\");\r\n    },\r\n    hideSide:function(side){\r\n        var nodeSide = this.node.getChildByName(side);\r\n        var nodeChiPengGang = nodeSide.getChildByName(\"ChiPengGang\");\r\n        if(nodeChiPengGang){\r\n            for(var i = 0; i < nodeChiPengGang.childrenCount; ++i){\r\n                nodeChiPengGang.children[i].active = false;\r\n            }            \r\n        }\r\n    },\r\n    onChiPengGangChanged:function(seatData){\r\n        //(seatData.pengs seatData.angangs seatData.diangangs seatData.bugangs seatData.chis\r\n        if(seatData.pengs == null && seatData.angangs == null && seatData.diangangs == null && seatData.bugangs == null && seatData.chis == null){\r\n            return;\r\n        }\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.seatindex);\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var nodeSide = this.node.getChildByName(side);\r\n        var nodeChiPengGang = nodeSide.getChildByName(\"ChiPengGang\");\r\n        for(var i = 0; i < nodeChiPengGang.childrenCount; ++i){\r\n            nodeChiPengGang.children[i].active = false;\r\n        }\r\n        //初始化杠牌\r\n        var index = 0;\r\n        var gangs = seatData.angangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"angang\");\r\n            index++;    \r\n        } \r\n        gangs = seatData.diangangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"diangang\");\r\n            index++;    \r\n        }\r\n        gangs = seatData.bugangs;\r\n        for(var i = 0; i < gangs.length; ++i){\r\n            var mjid = gangs[i];\r\n            this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"bugang\");\r\n            index++;    \r\n        }\r\n        //初始化碰牌\r\n        var pengs = seatData.pengs\r\n        if(pengs){\r\n            for(var i = 0; i < pengs.length; ++i){\r\n                var mjid = pengs[i];\r\n                this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"peng\");\r\n                index++;    \r\n            }    \r\n        }  \r\n        //初始化吃的牌\r\n        var chis = seatData.pengs\r\n        if(chis){\r\n            for(var i = 0; i < chis.length; ++i){\r\n                var mjid = chis[i];\r\n                this.initChiPengAndGangs(nodeChiPengGang,side,pre,index,mjid,\"chi\");\r\n                index++;    \r\n            }    \r\n        }\r\n    },\r\n    initChiPengAndGangs:function(nodeChiPengGang,side,pre,index,info,flag){\r\n        var nodeCPG = null;\r\n        if(nodeChiPengGang.childrenCount <= index){\r\n            if(side == \"left\" || side == \"right\"){\r\n                nodeCPG = cc.instantiate(th.mahjongManager.pengPrefabLeft);\r\n            }\r\n            else{\r\n                nodeCPG = cc.instantiate(th.mahjongManager.pengPrefabSelf);\r\n            }\r\n        }else{\r\n            nodeCPG = nodeChiPengGang.children[index];\r\n            nodeCPG.active = true;\r\n        }\r\n\r\n        if(side == \"left\"){\r\n            nodeCPG.y = -(index * 25 * 3);                    \r\n        }else if(side == \"right\"){\r\n            nodeCPG.y = (index * 25 * 3);\r\n            nodeCPG.setLocalZOrder(-index);\r\n        }else if(side == \"myself\"){\r\n            nodeCPG.x = index * 55 * 3 + index * 10;                    \r\n        }else{\r\n            nodeCPG.x = -(index * 55*3);\r\n        }\r\n\r\n        var sprites = pgroot.getComponentsInChildren(cc.Sprite);\r\n        if(flag==\"angang\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getEmptySpriteFrame(side);\r\n            }\r\n        }else if(flag==\"diangang\"||flag==\"bugang\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjid);    \r\n            }\r\n        }else if(flag==\"peng\"){\r\n            for(var i = 0; i < sprites.length; i++){\r\n                if(sprite.node.name == \"gang\"){\r\n                    sprite.node.active = false;\r\n                }else{\r\n                    sprite.node.active = true;\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjid);    \r\n                }\r\n            }\r\n        }else if(flag==\"chi\"){\r\n            var idx=0;\r\n            for(var i = 0; i < sprites.length; i++){\r\n                if(sprite.node.name == \"gang\"){\r\n                    sprite.node.active = false;\r\n                }else{\r\n                    sprite.node.active = true;\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,info.mjids[idx]);    \r\n                    idx+=1;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n});\r\n"]}