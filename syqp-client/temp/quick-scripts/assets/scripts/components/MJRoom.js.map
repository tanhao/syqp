{"version":3,"sources":["MJRoom.js"],"names":["cc","Class","extends","Component","properties","menuWin","Node","lblRoomId","Label","lblWangfa","btnMenu","Button","btnLeave","btnWechatInvite","btnDissolve","_seats","onLoad","th","initView","initSeats","initEventHandlers","socketIOManager","seats","length","node","getChildByName","active","string","roomId","getWanfa","sides","i","seatComponent","getComponent","push","log","refreshBtns","initSingleSeat","seat","index","getLocalIndex","setInfo","userId","name","score","headImgUrl","setFangzhu","creator","setBanker","bankerIndex","setReady","ready","setOffline","online","isIdle","round","isFangzhu","self","on","target","console","JSON","stringify","detail","seatIndex","getSeatIndexById","data","onMenuClicked","onBtnDissolveRequestClicked","alert","show","sio","send","onBtnDissolveClicked","onBtnLeaveClicked","onBtnSettingClicked","settingWin","onBtnChatClicked","onBtnVoiceClicked","onBtnReadyClicked","onBtnWechatInviteClicked"],"mappings":"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","file":"MJRoom.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        menuWin:cc.Node,\r\n        lblRoomId:cc.Label,\r\n        lblWangfa:cc.Label,\r\n        btnMenu:cc.Button,\r\n        btnLeave:cc.Button,\r\n        btnWechatInvite:cc.Button,\r\n        btnDissolve:cc.Button,\r\n        _seats:[]\r\n    },\r\n\r\n    onLoad: function () {\r\n        if(th==null){ return; }\r\n        this.initView();\r\n        this.initSeats();\r\n        this.initEventHandlers();\r\n    },\r\n\r\n    initView:function(){\r\n        if(th.socketIOManager.seats.length==2){\r\n            this.node.getChildByName('left').active=false;\r\n            this.node.getChildByName('right').active=false;\r\n        }else if(th.socketIOManager.seats.length==3){\r\n            this.node.getChildByName('up').active=false;\r\n        }\r\n\r\n\r\n        this.lblRoomId.string=th.socketIOManager.roomId || '------';\r\n        this.lblWangfa.string=th.socketIOManager.getWanfa();\r\n\r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i=0;i<sides.length;i++){\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            var seatComponent=this.node.getChildByName(sides[i]).getChildByName('Seat').getComponent('MJSeat');\r\n            this._seats.push(seatComponent);\r\n        }\r\n        cc.log(\"MJRoom Seats:\",this._seats.length);\r\n        this.refreshBtns();\r\n    },\r\n\r\n  \r\n    initSeats:function(){\r\n        var seats=th.socketIOManager.seats;\r\n        for(var i = 0; i < seats.length; ++i){\r\n            this.initSingleSeat(seats[i]);\r\n        }\r\n    },\r\n\r\n    initSingleSeat:function(seat){\r\n        var index = th.socketIOManager.getLocalIndex(seat.index);\r\n        this._seats[index].setInfo(seat.userId,seat.name,seat.score,seat.headImgUrl);\r\n        this._seats[index].setFangzhu(seat.userId==th.socketIOManager.creator);\r\n        this._seats[index].setBanker(seat.index==th.socketIOManager.bankerIndex);\r\n        this._seats[index].setReady(seat.ready);\r\n        this._seats[index].setOffline(!seat.online);\r\n    },\r\n\r\n    refreshBtns:function(){\r\n         var isIdle=th.socketIOManager.round==0;\r\n         var isFangzhu=th.socketIOManager.isFangzhu();\r\n         this.btnDissolve.node.active=isIdle&&isFangzhu;\r\n         this.btnLeave.node.active=isIdle&&!isFangzhu;\r\n         this.btnWechatInvite.node.active=isIdle;\r\n         this.btnMenu.node.active=!isIdle;\r\n    },\r\n\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        //加入房间\r\n        this.node.on('join_push', function (target) {\r\n            console.log('==>MJRoom join_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        });\r\n        //离开房间\r\n        this.node.on('leave_push', function (target) {\r\n            console.log('==>MJRoom leave_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        });\r\n\r\n        //其他玩家断线\r\n        this.node.on(\"offline_push\",function(target){\r\n            console.log('==>MJRoom offline_push:',JSON.stringify(target.detail));\r\n            var seatIndex=th.socketIOManager.getSeatIndexById(target.detail.userId)\r\n            var index = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self._seats[index].setOffline(true);\r\n        })\r\n        //其他玩家上线\r\n        this.node.on(\"online_push\",function(target){\r\n            console.log('==>MJRoom online_push:',JSON.stringify(target.detail));\r\n            var seatIndex=th.socketIOManager.getSeatIndexById(target.detail.userId)\r\n            var index = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self._seats[index].setOffline(false);\r\n        })\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(target){\r\n            console.log('==>MJRoom ready_result:',JSON.stringify(target.detail));\r\n            var seat=target.detail;\r\n            self.initSingleSeat(seat);\r\n        })\r\n        //其他玩家准备\r\n        this.node.on(\"ready_push\",function(target){\r\n            console.log('==>MJRoom ready_push:',JSON.stringify(target.detail));\r\n            self.initSingleSeat(target.detail);\r\n        })\r\n\r\n        this.node.on('begin_push',function(data){\r\n            self.refreshBtns();\r\n            self.initSeats();\r\n        });\r\n    },\r\n\r\n    onMenuClicked:function(){\r\n        this.menuWin.active=!this.menuWin.active;\r\n    },\r\n    onBtnDissolveRequestClicked:function(){\r\n        this.menuWin.active=false;\r\n        th.alert.show(\"申请解散房间\",\"申请解散房间不会退换钻石，是否确定申请解散？\",function(){\r\n            th.sio.send(\"dissolve_request\"); \r\n        },true)\r\n    },\r\n    onBtnDissolveClicked:function(){\r\n        th.alert.show(\"解散房间\",\"解散房间不扣钻石，是否确定解散？\",function(){\r\n            th.sio.send(\"dissolve\"); \r\n        },true)\r\n    },\r\n    onBtnLeaveClicked:function(){\r\n        this.menuWin.active=false;\r\n        if(th.socketIOManager.isFangzhu()){\r\n            th.alert.show(\"离开房间\",\"您是房主，不能离开房间。\",function(){\r\n                //th.sio.send(\"leave\"); \r\n            })\r\n            return ;\r\n        }\r\n        th.alert.show(\"离开房间\",\"您确定要离开房间?\",function(){\r\n            th.sio.send(\"leave\"); \r\n        },true)\r\n    },\r\n    onBtnSettingClicked:function(){\r\n        this.menuWin.active=false;\r\n        this.settingWin.active=true;\r\n    },\r\n    onBtnChatClicked:function(){\r\n        //this._seats[0].setCountdown(10);\r\n        cc.log('onChatClicked==>');\r\n    },\r\n    onBtnVoiceClicked:function(){\r\n        cc.log('onVoiceClicked==>');\r\n    },\r\n    onBtnReadyClicked:function(){\r\n        cc.log('onBtnReadyClicked==>');\r\n        th.sio.send(\"ready\"); \r\n    },\r\n    onBtnWechatInviteClicked:function(){\r\n        cc.log('onBtnWechatInviteClicked==>');\r\n    },\r\n\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n    \r\n\r\n});\r\n"]}