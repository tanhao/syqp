{"version":3,"sources":["MJRoom.js"],"names":["cc","Class","extends","Component","properties","menuWin","Node","lblRoomId","Label","lblWangfa","btnMenu","Button","btnLeave","btnWechatInvite","btnDissolve","_seats","onLoad","th","initView","initSeats","initEventHandlers","socketIOManager","seats","length","node","getChildByName","active","string","roomId","getWanfa","seatNames","i","seatComponent","getComponent","push","refreshBtns","initSingleSeat","seat","index","getLocalIndex","setInfo","userId","name","score","headImgUrl","setFangzhu","creator","setBank","seatindex","bankIndex","setReady","ready","setOffline","online","isIdle","round","isFangzhu","onMenuClicked","onBtnDissolveRequestClicked","alert","show","sio","send","onBtnDissolveClicked","onBtnLeaveClicked","onBtnSettingClicked","settingWin","onBtnChatClicked","_seat","setCountdown","log","onBtnVoiceClicked","onBtnReadyClicked","onBtnWechatInviteClicked"],"mappings":"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","file":"MJRoom.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        menuWin:cc.Node,\r\n        lblRoomId:cc.Label,\r\n        lblWangfa:cc.Label,\r\n        btnMenu:cc.Button,\r\n        btnLeave:cc.Button,\r\n        btnWechatInvite:cc.Button,\r\n        btnDissolve:cc.Button,\r\n        _seats:[]\r\n    },\r\n\r\n    onLoad: function () {\r\n        if(th==null){ return; }\r\n        this.initView();\r\n        this.initSeats();\r\n        this.initEventHandlers();\r\n    },\r\n\r\n    initView:function(){\r\n        if(th.socketIOManager.seats.length==2){\r\n            this.node.getChildByName('left').active=false;\r\n            this.node.getChildByName('right').active=false;\r\n        }else if(th.socketIOManager.seats.length==3){\r\n            this.node.getChildByName('up').active=false;\r\n        }\r\n\r\n\r\n        this.lblRoomId.string=th.socketIOManager.roomId || '------';\r\n        this.lblWangfa.string=th.socketIOManager.getWanfa();\r\n\r\n        var seatNames = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i=0;i<seatNames.length;i++){\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            var seatComponent=this.node.getChildByName(seatNames[i]).getChildByName('Seat').getComponent('MJSeat');\r\n            this._seats.push(seatComponent);\r\n        }\r\n        this.refreshBtns();\r\n    },\r\n\r\n  \r\n    initSeats:function(){\r\n        var seats=th.socketIOManager.seats;\r\n        for(var i = 0; i < seats.length; ++i){\r\n            this.initSingleSeat(seats[i]);\r\n        }\r\n    },\r\n\r\n    initSingleSeat:function(seat){\r\n        var index = th.socketIOManager.getLocalIndex(seat.index);\r\n        this._seats[index].setInfo(seat.userId,seat.name,seat.score,seat.headImgUrl);\r\n        this._seats[index].setFangzhu(seat.userId==th.socketIOManager.creator);\r\n        this._seats[index].setBank(seat.seatindex==th.socketIOManager.bankIndex);\r\n        this._seats[index].setReady(seat.ready);\r\n        this._seats[index].setOffline(!seat.online);\r\n    },\r\n\r\n    refreshBtns:function(){\r\n         var isIdle=th.socketIOManager.round==0;\r\n         var isFangzhu=th.socketIOManager.isFangzhu();\r\n         this.btnDissolve.node.active=isIdle&&isFangzhu;\r\n         this.btnLeave.node.active=isIdle&&!isFangzhu;\r\n         this.btnWechatInvite.node.active=isIdle;\r\n         this.btnMenu.node.active=!isIdle;\r\n    },\r\n\r\n    initEventHandlers:function(){\r\n\r\n    },\r\n\r\n    onMenuClicked:function(){\r\n        this.menuWin.active=!this.menuWin.active;\r\n    },\r\n    onBtnDissolveRequestClicked:function(){\r\n        this.menuWin.active=false;\r\n        th.alert.show(\"申请解散房间\",\"申请解散房间不会退换钻石，是否确定申请解散？\",function(){\r\n            th.sio.send(\"dissolve_request\"); \r\n        },true)\r\n    },\r\n    onBtnDissolveClicked:function(){\r\n        th.alert.show(\"解散房间\",\"解散房间不扣钻石，是否确定解散？\",function(){\r\n            th.sio.send(\"dissolve\"); \r\n        },true)\r\n    },\r\n    onBtnLeaveClicked:function(){\r\n        this.menuWin.active=false;\r\n        if(th.socketIOManager.isFangzhu()){\r\n            th.alert.show(\"离开房间\",\"您是房主，不能离开房间。\",function(){\r\n                //th.sio.send(\"leave\"); \r\n            })\r\n            return ;\r\n        }\r\n        th.alert.show(\"离开房间\",\"您确定要离开房间?\",function(){\r\n            th.sio.send(\"leave\"); \r\n        },true)\r\n    },\r\n    onBtnSettingClicked:function(){\r\n        this.menuWin.active=false;\r\n        this.settingWin.active=true;\r\n    },\r\n    onBtnChatClicked:function(){\r\n        this._seat[0].setCountdown(10);\r\n        cc.log('onChatClicked==>');\r\n    },\r\n    onBtnVoiceClicked:function(){\r\n        cc.log('onVoiceClicked==>');\r\n    },\r\n    onBtnReadyClicked:function(){\r\n        cc.log('onBtnReadyClicked==>');\r\n        th.sio.send(\"ready\"); \r\n    },\r\n    onBtnWechatInviteClicked:function(){\r\n        cc.log('onBtnWechatInviteClicked==>');\r\n    },\r\n\r\n\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n    \r\n\r\n});\r\n"]}