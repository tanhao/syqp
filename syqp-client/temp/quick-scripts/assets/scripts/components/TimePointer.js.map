{"version":3,"sources":["TimePointer.js"],"names":["cc","Class","extends","Component","properties","lblTime","Lable","bottomPointer","Sprite","rightPointer","topPointer","leftPointer","_pointers","_countdownEndTime","_alertStartTime","_isPlay","onLoad","th","socketIOManager","seats","length","push","active","initPointer","initEventHandlers","turn","localIndex","getLocalIndex","i","self","node","on","data","Date","now","update","dt","Data","miao","Math","ceil","string","audioManager","playBGM"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACTC,iBAAQL,GAAGM,KADF;AAETC,uBAAcP,GAAGQ,MAFR;AAGTC,sBAAaT,GAAGQ,MAHP;AAITE,oBAAWV,GAAGQ,MAJL;AAKTG,qBAAYX,GAAGQ,MALN;AAMTI,mBAAU,IAND;AAOTC,2BAAkB,CAPT;AAQTC,yBAAgB,CARP;AASTC,iBAAQ;AATC,KAHP;;AAeLC,UAfK,oBAeK;AACN,YAAGC,GAAGC,eAAH,CAAmBC,KAAnB,CAAyBC,MAAzB,IAAiC,CAApC,EAAsC;AAClC,iBAAKR,SAAL,CAAeS,IAAf,CAAoB,KAAKd,aAAzB;AACA,iBAAKK,SAAL,CAAeS,IAAf,CAAoB,KAAKZ,YAAzB;AACA,iBAAKG,SAAL,CAAeS,IAAf,CAAoB,KAAKX,UAAzB;AACA,iBAAKE,SAAL,CAAeS,IAAf,CAAoB,KAAKV,WAAzB;AACH,SALD,MAKM,IAAGM,GAAGC,eAAH,CAAmBC,KAAnB,CAAyBC,MAAzB,IAAiC,CAApC,EAAsC;AACxC,iBAAKR,SAAL,CAAeS,IAAf,CAAoB,KAAKd,aAAzB;AACA,iBAAKK,SAAL,CAAeS,IAAf,CAAoB,KAAKZ,YAAzB;AACA,iBAAKG,SAAL,CAAeS,IAAf,CAAoB,KAAKV,WAAzB;AACA,iBAAKD,UAAL,CAAgBY,MAAhB,GAAuB,KAAvB;AACH,SALK,MAKA,IAAGL,GAAGC,eAAH,CAAmBC,KAAnB,CAAyBC,MAAzB,IAAiC,CAApC,EAAsC;AACxC,iBAAKR,SAAL,CAAeS,IAAf,CAAoB,KAAKd,aAAzB;AACA,iBAAKK,SAAL,CAAeS,IAAf,CAAoB,KAAKX,UAAzB;AACA,iBAAKD,YAAL,CAAkBa,MAAlB,GAAyB,KAAzB;AACA,iBAAKX,WAAL,CAAiBW,MAAjB,GAAwB,KAAxB;AACH;AACD,aAAKC,WAAL;AACA,aAAKC,iBAAL;AACH,KAlCI;;;AAoCLD,iBAAY,uBAAU;AAClB,YAAGN,MAAI,IAAP,EAAa;AACb,YAAIQ,OAAKR,GAAGC,eAAH,CAAmBO,IAA5B;AACA,YAAIC,aAAWT,GAAGC,eAAH,CAAmBS,aAAnB,CAAiCF,IAAjC,CAAf;AACA,aAAI,IAAIG,IAAI,CAAZ,EAAeA,IAAI,KAAKhB,SAAL,CAAeQ,MAAlC,EAA0C,EAAEQ,CAA5C,EAA8C;AAC1C,iBAAKhB,SAAL,CAAegB,CAAf,EAAkBN,MAAlB,GAA2BM,KAAKF,UAAhC;AACH;AACJ,KA3CI;;AA6CLF,uBAAkB,6BAAU;AACxB,YAAIK,OAAK,IAAT;AACA,aAAKC,IAAL,CAAUC,EAAV,CAAa,YAAb,EAA0B,UAASC,IAAT,EAAc;AACpCH,iBAAKN,WAAL;AACH,SAFD;;AAIA,aAAKO,IAAL,CAAUC,EAAV,CAAa,aAAb,EAA2B,UAASC,IAAT,EAAc;AACrCH,iBAAKN,WAAL;AACAM,iBAAKhB,iBAAL,GAAuBoB,KAAKC,GAAL,KAAW,KAAG,IAArC;AACAL,iBAAKf,eAAL,GAAqBmB,KAAKC,GAAL,KAAW,IAAE,IAAlC;AACAL,iBAAKd,OAAL,GAAa,KAAb;AACH,SALD;AAMH,KAzDI;;AA2DLoB,UA3DK,kBA2DGC,EA3DH,EA2DO;AACR,YAAIF,MAAIG,KAAKH,GAAL,EAAR;AACA,YAAG,KAAKrB,iBAAL,GAAyBqB,GAA5B,EAAgC;AAC5B,gBAAII,OAAKC,KAAKC,IAAL,CAAU,CAAC,KAAK3B,iBAAL,GAAuBqB,GAAxB,IAA6B,IAAvC,CAAT;AACA,iBAAK7B,OAAL,CAAaoC,MAAb,GAAoBH,OAAK,EAAL,GAAS,MAAIA,IAAb,GAAoBA,OAAK,EAA7C;AACH;AACD,YAAG,KAAKxB,eAAL,GAAqBoB,GAArB,IAA0B,CAAC,KAAKnB,OAAnC,EAA2C;AACvC,iBAAKA,OAAL,GAAa,IAAb;AACAE,eAAGyB,YAAH,CAAgBC,OAAhB,CAAwB,kBAAxB;AACH;AACJ;AArEI,CAAT","file":"TimePointer.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       lblTime:cc.Lable,\r\n       bottomPointer:cc.Sprite,\r\n       rightPointer:cc.Sprite,\r\n       topPointer:cc.Sprite,\r\n       leftPointer:cc.Sprite,\r\n       _pointers:null,\r\n       _countdownEndTime:0,\r\n       _alertStartTime:0,\r\n       _isPlay:false,\r\n    },\r\n\r\n    onLoad () {\r\n        if(th.socketIOManager.seats.length==4){\r\n            this._pointers.push(this.bottomPointer);\r\n            this._pointers.push(this.rightPointer);\r\n            this._pointers.push(this.topPointer);\r\n            this._pointers.push(this.leftPointer);\r\n        }else if(th.socketIOManager.seats.length==3){\r\n            this._pointers.push(this.bottomPointer);\r\n            this._pointers.push(this.rightPointer);\r\n            this._pointers.push(this.leftPointer);\r\n            this.topPointer.active=false;\r\n        }else if(th.socketIOManager.seats.length==2){\r\n            this._pointers.push(this.bottomPointer);\r\n            this._pointers.push(this.topPointer);\r\n            this.rightPointer.active=false;\r\n            this.leftPointer.active=false;\r\n        }\r\n        this.initPointer();\r\n        this.initEventHandlers();\r\n    },\r\n\r\n    initPointer:function(){\r\n        if(th==null) return;\r\n        var turn=th.socketIOManager.turn;\r\n        var localIndex=th.socketIOManager.getLocalIndex(turn);\r\n        for(var i = 0; i < this._pointers.length; ++i){\r\n            this._pointers[i].active = i == localIndex;\r\n        }\r\n    },\r\n\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        this.node.on('begin_push',function(data){\r\n            self.initPointer();\r\n        });\r\n        \r\n        this.node.on('chupai_push',function(data){\r\n            self.initPointer();\r\n            self._countdownEndTime=Date.now()+10*1000;\r\n            self._alertStartTime=Date.now()+7*1000;\r\n            self._isPlay=false;\r\n        });\r\n    },\r\n\r\n    update (dt) {\r\n        var now=Data.now();\r\n        if(this._countdownEndTime > now){\r\n            var miao=Math.ceil((this._countdownEndTime-now)/1000);\r\n            this.lblTime.string=miao<10?(\"0\"+miao):(miao+\"\");\r\n        }\r\n        if(this._alertStartTime<now&&!this._isPlay){\r\n            this._isPlay=true;\r\n            th.audioManager.playBGM(\"timeup_alarm.mp3\");\r\n        }\r\n    },\r\n\r\n\r\n\r\n  \r\n\r\n});\r\n"]}