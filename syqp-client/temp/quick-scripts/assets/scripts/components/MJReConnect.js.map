{"version":3,"sources":["MJReConnect.js"],"names":["cc","Class","extends","Component","properties","_reconnect","_lblTip","_loading_image","_lastPing","onLoad","find","getChildByName","self","fnTestServerOn","vv","net","test","ret","gameNetMgr","reset","roomId","userMgr","oldRoomId","enterRoom","errcode","director","loadScene","setTimeout","fn","data","node","off","active","console","log","game","on","EVENT_HIDE","EVENT_SHOW","update","dt","rotation"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,oBAAY,IADJ;AAERC,iBAAS,IAFD;AAGRC,wBAAgB,IAHR;AAIRC,mBAAW;AAJH,KAHP;;AAUL;AACAC,YAAQ,kBAAY;AAChB,aAAKJ,UAAL,GAAkBL,GAAGU,IAAH,CAAQ,kBAAR,CAAlB;AACA,aAAKH,cAAL,GAAsB,KAAKF,UAAL,CAAgBM,cAAhB,CAA+B,eAA/B,CAAtB;AACA,YAAIC,OAAO,IAAX;;AAEA,YAAIC,iBAAiB,SAAjBA,cAAiB,GAAY;AAC7Bb,eAAGc,EAAH,CAAMC,GAAN,CAAUC,IAAV,CAAe,UAAUC,GAAV,EAAe;AAC1B,oBAAIA,GAAJ,EAAS;AACLjB,uBAAGc,EAAH,CAAMI,UAAN,CAAiBC,KAAjB;AACA;AACA,wBAAIC,SAASpB,GAAGc,EAAH,CAAMO,OAAN,CAAcC,SAA3B;AACA,wBAAIF,UAAU,IAAd,EAAoB;AAChBpB,2BAAGc,EAAH,CAAMO,OAAN,CAAcC,SAAd,GAA0B,IAA1B;AACAtB,2BAAGc,EAAH,CAAMO,OAAN,CAAcE,SAAd,CAAwBH,MAAxB,EAAgC,UAAUH,GAAV,EAAe;AAC3C,gCAAIA,IAAIO,OAAJ,IAAe,CAAnB,EAAsB;AAClBxB,mCAAGc,EAAH,CAAMI,UAAN,CAAiBE,MAAjB,GAA0B,IAA1B;AACApB,mCAAGyB,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH;AACJ,yBALD;AAMH;AACJ,iBAbD,MAcK;AACDC,+BAAWd,cAAX,EAA2B,IAA3B;AACH;AACJ,aAlBD;AAmBH,SApBD;;AAsBA,YAAIe,KAAK,SAALA,EAAK,CAAUC,IAAV,EAAgB;AACrBjB,iBAAKkB,IAAL,CAAUC,GAAV,CAAc,YAAd,EAA4BH,EAA5B;AACAhB,iBAAKP,UAAL,CAAgB2B,MAAhB,GAAyB,IAAzB;AACAC,oBAAQC,GAAR,CAAY,wBAAZ;AACA;AACH,SALD;;AAOAlC,WAAGmC,IAAH,CAAQC,EAAR,CAAWpC,GAAGmC,IAAH,CAAQE,UAAnB,EAA+B,YAAY;AACvCJ,oBAAQC,GAAR,CAAY,wBAAZ;AACH,SAFD;AAGAlC,WAAGmC,IAAH,CAAQC,EAAR,CAAWpC,GAAGmC,IAAH,CAAQG,UAAnB,EAA+B,YAAY;AACvCL,oBAAQC,GAAR,CAAY,wBAAZ;AACH,SAFD;;AAIA;;;;;;;AAOA,aAAKJ,IAAL,CAAUM,EAAV,CAAa,YAAb,EAA2BR,EAA3B;AACH,KA5DI;AA6DLW,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAI,KAAKnC,UAAL,CAAgB2B,MAApB,EAA4B;AACxB,iBAAKzB,cAAL,CAAoBkC,QAApB,GAA+B,KAAKlC,cAAL,CAAoBkC,QAApB,GAA+BD,KAAK,EAAnE;AACH;AACJ;AAjEI,CAAT","file":"MJReConnect.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _reconnect: null,\r\n        _lblTip: null,\r\n        _loading_image: null,\r\n        _lastPing: 0,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._reconnect = cc.find(\"Canvas/ReConnect\");\r\n        this._loading_image = this._reconnect.getChildByName(\"loading_image\");\r\n        var self = this;\r\n\r\n        var fnTestServerOn = function () {\r\n            cc.vv.net.test(function (ret) {\r\n                if (ret) {\r\n                    cc.vv.gameNetMgr.reset();\r\n                    //cc.director.loadScene('hall');\r\n                    var roomId = cc.vv.userMgr.oldRoomId;\r\n                    if (roomId != null) {\r\n                        cc.vv.userMgr.oldRoomId = null;\r\n                        cc.vv.userMgr.enterRoom(roomId, function (ret) {\r\n                            if (ret.errcode != 0) {\r\n                                cc.vv.gameNetMgr.roomId = null;\r\n                                cc.director.loadScene('hall');\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    setTimeout(fnTestServerOn, 3000);\r\n                }\r\n            });\r\n        }\r\n\r\n        var fn = function (data) {\r\n            self.node.off('disconnect', fn);\r\n            self._reconnect.active = true;\r\n            console.log(\"MJREConnect disconnect\");\r\n            ////fnTestServerOn();\r\n        };\r\n\r\n        cc.game.on(cc.game.EVENT_HIDE, function () {\r\n            console.log(\"MJREConnect EVENT_HIDE\");\r\n        });\r\n        cc.game.on(cc.game.EVENT_SHOW, function () {\r\n            console.log(\"MJREConnect EVENT_SHOW\");\r\n        });\r\n\r\n        /*\r\n        this.node.on('login_finished', function () {\r\n            self._reconnect.active = false;\r\n            self.node.on('disconnect', fn);\r\n        });\r\n        */\r\n\r\n        this.node.on('disconnect', fn);\r\n    },\r\n    update: function (dt) {\r\n        if (this._reconnect.active) {\r\n            this._loading_image.rotation = this._loading_image.rotation - dt * 45;\r\n        }\r\n    },\r\n});\r\n"]}