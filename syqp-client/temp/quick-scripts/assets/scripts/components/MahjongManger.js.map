{"version":3,"sources":["MahjongManger.js"],"names":["mahjongSprites","cc","Class","extends","Component","properties","leftAtlas","default","type","SpriteAtlas","rightAtlas","bottomAtlas","bottomFoldAtlas","pengPrefabSelf","Prefab","pengPrefabLeft","emptyAtlas","holdsEmpty","SpriteFrame","_sides","_pres","_foldPres","onLoad","th","mahjongManager","seatSize","socketIOManager","seats","length","console","log","i","push","getMahjongSpriteByID","id","getMahjongType","getSpriteFrameByMJID","pre","mjid","spriteFrameName","getSpriteFrame","getAudioURLByMJID","realId","getEmptySpriteFrame","side","getHoldsEmptySpriteFrame","sortHolds","holds","sort","a","b","aa","bb","caishen","sortMJ","mahjongs","dingque","self","t1","t2","getSide","localIndex","getPre","getFoldPre"],"mappings":"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","file":"MahjongManger.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["var mahjongSprites = [];\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        leftAtlas:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        },\r\n        \r\n        rightAtlas:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        },\r\n        \r\n        bottomAtlas:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        },\r\n        \r\n        bottomFoldAtlas:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        },\r\n        \r\n        pengPrefabSelf:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        \r\n        pengPrefabLeft:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        \r\n        emptyAtlas:{\r\n            default:null,\r\n            type:cc.SpriteAtlas\r\n        },\r\n        \r\n        holdsEmpty:{\r\n            default:[],\r\n            type:[cc.SpriteFrame]\r\n        },\r\n        \r\n        _sides:null,\r\n        _pres:null,\r\n        _foldPres:null,\r\n    },\r\n    \r\n    onLoad:function(){\r\n        if(th == null){\r\n            return;\r\n        }\r\n        th.mahjongManager = this; \r\n\r\n\r\n        var seatSize=th.socketIOManager.seats.length;\r\n        console.log(\"==>MahjongManger seatSzie:\",seatSize);\r\n        if(seatSize==4){\r\n            this._sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n            this._pres = [\"M_\",\"R_\",\"B_\",\"L_\"];\r\n            this._foldPres = [\"B_\",\"R_\",\"B_\",\"L_\"];\r\n        }else if(seatSize==3){\r\n            this._sides = [\"myself\",\"right\",\"left\"];\r\n            this._pres = [\"M_\",\"R_\",\"L_\"];\r\n            this._foldPres = [\"B_\",\"R_\",\"L_\"];\r\n        }else if(seatSize==2){\r\n            this._sides = [\"myself\",\"up\"];\r\n            this._pres = [\"M_\",\"B_\",];\r\n            this._foldPres = [\"B_\",\"B_\"];\r\n        }\r\n        //万\r\n        for(var i = 1; i < 10; ++i){\r\n            mahjongSprites.push(\"character_\" + i);\r\n        }\r\n        //条\r\n        for(var i = 1; i < 10; ++i){\r\n            mahjongSprites.push(\"bamboo_\" + i);\r\n        }\r\n        \r\n        //筒\r\n        for(var i = 1; i < 10; ++i){\r\n            mahjongSprites.push(\"dot_\" + i);        \r\n        }\r\n\r\n        //风\r\n        for(var i = 1; i < 8; ++i){\r\n            mahjongSprites.push(\"wind_\" + i);        \r\n        }\r\n\r\n        /*\r\n        //中、发、白\r\n        mahjongSprites.push(\"red\");\r\n        mahjongSprites.push(\"green\");\r\n        mahjongSprites.push(\"white\");\r\n        \r\n        //东西南北风\r\n        mahjongSprites.push(\"wind_east\");\r\n        mahjongSprites.push(\"wind_west\");\r\n        mahjongSprites.push(\"wind_south\");\r\n        mahjongSprites.push(\"wind_north\");\r\n        */\r\n    },\r\n    \r\n    getMahjongSpriteByID:function(id){\r\n        return mahjongSprites[id];\r\n    },\r\n    \r\n    getMahjongType:function(id){\r\n        if(id >= 0 && id <= 8){\r\n            return 0;//万\r\n        }else if(id >= 9 && id <= 17){\r\n            return 1;//条\r\n        }else if(id >= 18 && id <= 16){\r\n            return 2;//筒子\r\n        }else if(id >= 27 && id <= 33){\r\n            return 3;//风\r\n        }\r\n    },\r\n    \r\n    getSpriteFrameByMJID:function(pre,mjid){\r\n        var spriteFrameName = this.getMahjongSpriteByID(mjid);\r\n        spriteFrameName = pre + spriteFrameName;\r\n        if(pre == \"M_\"){\r\n            return this.bottomAtlas.getSpriteFrame(spriteFrameName);            \r\n        }else if(pre == \"B_\"){\r\n            return this.bottomFoldAtlas.getSpriteFrame(spriteFrameName);\r\n        }else if(pre == \"L_\"){\r\n            return this.leftAtlas.getSpriteFrame(spriteFrameName);\r\n        }else if(pre == \"R_\"){\r\n            return this.rightAtlas.getSpriteFrame(spriteFrameName);\r\n        }\r\n    },\r\n    \r\n    getAudioURLByMJID:function(id){\r\n        var realId = 0;\r\n        if(id >= 0 && id <= 8){\r\n            realId = id + 11;\r\n        }else if(id >= 9 && id <= 17){\r\n            realId = id - 8;\r\n        }else if(id >= 18 && id <= 26){\r\n            realId = id + 3;\r\n        }else if(id >= 27 && id <= 33){\r\n            realId = id + 4;\r\n        }\r\n        return \"nv/\" + realId + \".mp3\";\r\n    },\r\n    \r\n    getEmptySpriteFrame:function(side){\r\n        if(side == \"up\"){\r\n            //return this.emptyAtlas.getSpriteFrame(\"e_mj_b_up\");\r\n            return this.emptyAtlas.getSpriteFrame(\"e_mj_b_bottom\");\r\n        }   \r\n        else if(side == \"myself\"){\r\n            return this.emptyAtlas.getSpriteFrame(\"e_mj_b_bottom\");\r\n        }\r\n        else if(side == \"left\"){\r\n            return this.emptyAtlas.getSpriteFrame(\"e_mj_b_left\");\r\n        }\r\n        else if(side == \"right\"){\r\n            return this.emptyAtlas.getSpriteFrame(\"e_mj_b_right\");\r\n        }\r\n    },\r\n    \r\n    getHoldsEmptySpriteFrame:function(side){\r\n        if(side == \"up\"){\r\n            return this.emptyAtlas.getSpriteFrame(\"e_mj_up\");\r\n        }   \r\n        else if(side == \"myself\"){\r\n            return null;\r\n        }\r\n        else if(side == \"left\"){\r\n            return this.emptyAtlas.getSpriteFrame(\"e_mj_left\");\r\n        }\r\n        else if(side == \"right\"){\r\n            return this.emptyAtlas.getSpriteFrame(\"e_mj_right\");\r\n        }\r\n    },\r\n    \r\n    sortHolds:function(holds){\r\n        if(holds==null){\r\n            return holds;\r\n        }\r\n        holds.sort(function(a,b){\r\n            var aa=a;\r\n            var bb=b;\r\n            if(aa==th.socketIOManager.caishen){\r\n                aa=aa-100;\r\n            }else if(aa==33&&th.socketIOManager.caishen<27){\r\n                aa=th.socketIOManager.caishen;\r\n            }\r\n            if(bb==th.socketIOManager.caishen){\r\n                bb=bb-100;\r\n            }else if(bb==33&&th.socketIOManager.caishen<27){\r\n                bb=th.socketIOManager.caishen;\r\n            }\r\n            return aa-bb;\r\n        });\r\n        return holds;\r\n    },\r\n\r\n    sortMJ:function(mahjongs,dingque){\r\n        var self = this;\r\n        mahjongs.sort(function(a,b){\r\n            if(dingque >= 0){\r\n                var t1 = self.getMahjongType(a);\r\n                var t2 = self.getMahjongType(b);\r\n                if(t1 != t2){\r\n                    if(dingque == t1){\r\n                        return 1;\r\n                    }\r\n                    else if(dingque == t2){\r\n                        return -1;\r\n                    }\r\n                }\r\n            }\r\n            return a - b;\r\n        });\r\n    },\r\n    \r\n    getSide:function(localIndex){\r\n        return this._sides[localIndex];\r\n    },\r\n    \r\n    getPre:function(localIndex){\r\n        return this._pres[localIndex];\r\n    },\r\n    \r\n    getFoldPre:function(localIndex){\r\n        return this._foldPres[localIndex];\r\n    }\r\n});\r\n"]}