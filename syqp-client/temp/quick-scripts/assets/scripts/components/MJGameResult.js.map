{"version":3,"sources":["MJGameResult.js"],"names":["cc","Class","extends","Component","properties","_nodeGameResult","_seats","onLoad","th","node","getChildByName","seats","push","btnBackHall","find","utils","addClickEvent","btnShareResult","self","on","data","log","detail","onGameEnd","showResult","seat","id","name","headUrl","isFangZhu","isDaYinJia","info","score","getComponent","Label","string","Sprite","active","numZiMo","numJiePao","numDianPao","numAnGang","numMingGang","winscore","losescore","headSprite","loader","load","url","type","err","texture","headSpriteFrame","SpriteFrame","Rect","width","height","spriteFrame","setScale","endInfo","socketIOManager","maxScore","i","length","userId","creator","headImgUrl","onBtnBackHallClicked","wc","show","director","loadScene","onBtnShareClicked","update","dt"],"mappings":"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","file":"MJGameResult.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _nodeGameResult:null,\r\n        _seats:[],\r\n    },\r\n\r\n    onLoad () {\r\n        if(th == null){\r\n            return;\r\n        }\r\n        this._nodeGameResult=this.node.getChildByName(\"game_result\");\r\n        var seats = this._nodeGameResult.getChildByName(\"result_list\");\r\n        this._seats.push(seats.getChildByName(\"seat1\"));\r\n        this._seats.push(seats.getChildByName(\"seat2\"));\r\n        this._seats.push(seats.getChildByName(\"seat3\"));\r\n        this._seats.push(seats.getChildByName(\"seat4\"));\r\n\r\n        var btnBackHall = cc.find(\"Canvas/game_result/btn_back_hall\");\r\n        if(btnBackHall){\r\n            th.utils.addClickEvent(btnBackHall,this.node,\"MJGameResult\",\"onBtnBackHallClicked\");\r\n        }\r\n\r\n        var btnShareResult = cc.find(\"Canvas/game_result/btn_share_result\");\r\n        if(btnShareResult){\r\n            th.utils.addClickEvent(btnShareResult,this.node,\"MJGameResult\",\"onBtnShareClicked\");\r\n        }\r\n\r\n        var self=this;\r\n        this.node.on('game_end',function(data){\r\n            cc.log(\"==>MJGameResult game_end\",data.detail);\r\n            self.onGameEnd(data.detail);\r\n        });\r\n    },\r\n    showResult:function(seat,id,name,headUrl,isFangZhu,isDaYinJia,info,score){\r\n        seat.getChildByName(\"id\").getComponent(cc.Label).string = id;\r\n        seat.getChildByName(\"name\").getComponent(cc.Label).string = name;\r\n        seat.getChildByName(\"fangzhu\").getComponent(cc.Sprite).node.active = isFangZhu;\r\n        seat.getChildByName(\"dayinjia\").getComponent(cc.Sprite).node.active = isDaYinJia;\r\n        seat.getChildByName(\"zimocishu\").getComponent(cc.Label).string = info.numZiMo;\r\n        seat.getChildByName(\"jiepaocishu\").getComponent(cc.Label).string = info.numJiePao;\r\n        seat.getChildByName(\"dianpaocishu\").getComponent(cc.Label).string = info.numDianPao;\r\n        seat.getChildByName(\"angangcishu\").getComponent(cc.Label).string = info.numAnGang;\r\n        seat.getChildByName(\"minggangcishu\").getComponent(cc.Label).string = info.numMingGang;\r\n\r\n        var winscore=seat.getChildByName(\"winscore\").getComponent(cc.Label);\r\n        var losescore=seat.getChildByName(\"losescore\").getComponent(cc.Label);\r\n        if(score>=0){\r\n            winscore.node.active=true;\r\n            losescore.node.active=false;\r\n            winscore.string=\"+\"+score;\r\n        }else{\r\n            winscore.node.active=false;\r\n            losescore.node.active=true;\r\n            losescore.string=\"\"+score;\r\n        }\r\n\r\n        var headSprite=seat.getChildByName(\"head_clip\").getChildByName('head_img').getComponent(cc.Sprite);\r\n        (function(headSprite,headUrl){\r\n            cc.loader.load({url: headUrl, type: 'jpg'}, function (err, texture) {\r\n                if(!err){\r\n                    var headSpriteFrame = new cc.SpriteFrame(texture, cc.Rect(0, 0, texture.width, texture.height));\r\n                    headSprite.spriteFrame=headSpriteFrame;\r\n                    headSprite.node.setScale(2-(texture.width/94));\r\n                }\r\n            });\r\n        })(headSprite,headUrl);\r\n    },\r\n    onGameEnd:function(endInfo){\r\n        var seats=th.socketIOManager.seats;\r\n        var maxScore = -1;\r\n        for(var i = 0; i < seats.length;i++){\r\n            if(seats[i].score > maxScore){\r\n                maxScore = seats[i].score;\r\n            }\r\n        }\r\n        for(var i=0;i<4;i++){\r\n            this._seats[i].active=false;\r\n        }\r\n        for(var i=0;i<seats.length;i++){\r\n            this._seats[i].active=true;\r\n            var seat=seats[i];\r\n            var isDaYinJia = false;\r\n            if(seat.score > 0){\r\n                isDaYinJia = seat.score == maxScore;\r\n            }\r\n            var isFangZhu=seat.userId==th.socketIOManager.creator;\r\n            this.showResult(this._seats[i],seat.userId,seat.name,seat.headImgUrl,isFangZhu,isDaYinJia,endInfo[i],seat.score);\r\n        }\r\n    },\r\n    onBtnBackHallClicked:function(){\r\n        cc.log(\"onBtnBackHallClicked\");\r\n        th.wc.show('正在返回游戏大厅');\r\n        cc.director.loadScene(\"hall\");\r\n    },\r\n    onBtnShareClicked:function(){\r\n        cc.log(\"onBtnShareClicked\");\r\n    },\r\n    update (dt) {\r\n    },\r\n});\r\n"]}