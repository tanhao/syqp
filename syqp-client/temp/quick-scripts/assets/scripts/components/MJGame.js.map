{"version":3,"sources":["MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblRoundCount","spriteCaishen","Sprite","btnReady","Button","btnGang","btnPeng","btnChi","btnHu","btnGuo","chupaidian","settingWin","Node","optionsWin","nodePrepare","nodeGameInfo","nodeCaishen","_mymjs","_effects","_chupais","_hupaiTips","onLoad","th","addComponent","initView","initEventHandlers","active","onGameBegin","audioManager","playBGM","node","myHolds","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","initDragStuffs","realwidth","director","getVisibleSize","width","scaleX","scaleY","sides","i","mjs","seatNode","spriteChupai","nodeHupai","socketIOManager","seats","animation","Animation","hideOptions","self","dataEventHandler","on","target","console","log","JSON","stringify","detail","seat","round","ready","initMahjongs","string","mjsy","config","data","hideChupai","last","seatIndex","initMopai","showAction","EventType","TOUCH_START","event","turn","interactable","x","getLocationX","y","getLocationY","height","bind","TOUCH_MOVE","Math","abs","getDeltaX","getDeltaY","opacity","TOUCH_END","shoot","mjId","TOUCH_CANCEL","moveBack","moveTo","getLocation","easing","easeSineOut","seq","sequence","callFunc","runAction","I","seatData","localIndex","getLocalIndex","isHu","isZimo","holds","childrenCount","nc","mahjongManager","holdsEmpty","initOtherMahjongs","showChupai","actions","onMJClicked","_selectedMJ","onOptionClicked","name","sio","send","pai","pais","getMJIndex","side","index","getSide","pre","getFoldPre","lastIndex","getSpriteFrameByMJID","getHoldsEmptySpriteFrame","chupai","hu","gang","peng","chi","_options","gangpai","gp","addOption","sort","a","b","lackingNum","pengs","angangs","diangangs","bugangs","chis","mjid","setSpriteFrameByMJID","sideHolds","idx","sortHolds","lasetIdx","activeReadyBtn","isReady","userManager","userId"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        spriteCaishen:cc.Sprite,\r\n        btnReady:cc.Button,\r\n        btnGang:cc.Button,\r\n        btnPeng:cc.Button,\r\n        btnChi:cc.Button,\r\n        btnHu:cc.Button,\r\n        btnGuo:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        optionsWin:cc.Node,    ///所有可以做的操作节点\r\n        nodePrepare:cc.Node,\r\n        nodeGameInfo:cc.Node,\r\n        nodeCaishen:cc.Node,\r\n\r\n        _mymjs:[],      //自己手上的牌Sprite结合\r\n        _effects:[],    //每个座位动画节点（Animation）\r\n        _chupais:[],    //每个座位出牌节点（Sprite）\r\n        _hupaiTips:[],  //每个座位胡牌提示节点:自摸，胡（抢杠胡）\r\n    },\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n\r\n        this.nodePrepare.active=true;\r\n        this.nodeGameInfo.active=false;\r\n\r\n        this.onGameBegin();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n    initView:function(){\r\n        //把自己的牌都设置为null\r\n\r\n        this.chupaidian.node.active=false;\r\n\r\n        var myHolds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<myHolds.children.length;j++){\r\n                var sprite = myHolds.children[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n                //todo添加拖动效果\r\n                this.initDragStuffs(sprite.node);\r\n        }\r\n\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        myHolds.scaleX *= realwidth/1280;\r\n        myHolds.scaleY *= realwidth/1280;  \r\n        \r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        //隐藏其他玩家手上的牌\r\n        for(var i=1;i<sides.length;i++){\r\n            var mjs=this.node.getChildByName(sides[i]).getChildByName('Holds').children;\r\n            for(var j=0;j<mjs.length;j++){\r\n                var sprite = mjs[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n            }\r\n        }\r\n        for(var i=0;i<sides.length;i++){\r\n            var seatNode=this.node.getChildByName(sides[i]);\r\n            //出牌\r\n            var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n            spriteChupai.node.active=false;\r\n            spriteChupai.spriteFrame = null;\r\n            //胡牌NODE\r\n            var nodeHupai=seatNode.getChildByName('Hupai');\r\n            nodeHupai.node.active=false;\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            //操作效果\r\n            var animation=seatNode.getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animation);\r\n            this._chupais.push(spriteChupai);\r\n            this._hupaiTips.push(nodeHupai);\r\n            \r\n        }\r\n        this.hideOptions();\r\n    },\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n        \r\n        //检查IP\r\n        this.node.on('check_ip', function (target) {\r\n            console.log('==>MJGame check_ip:',JSON.stringify(target.detail));\r\n        });\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(target){\r\n            console.log('==>Gmae ready_result:',JSON.stringify(target.detail));\r\n            var seat=target.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n        })\r\n\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(target){\r\n            console.log('==>Gmae holds_push:',JSON.stringify(target.detail));\r\n            self.initMahjongs();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(target){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(target.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        })\r\n        //断线\r\n        this.node.on('disconnect', function (target) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(target.detail));\r\n        });\r\n        \r\n        //通知还剩多少张牌\r\n         this.node.on(\"mjsy_push\",function(target){\r\n            console.log('==>Gmae mjsy_push:',JSON.stringify(target.detail));\r\n            self.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n        })\r\n\r\n        //通知当前是第几局\r\n        this.node.on(\"round_push\",function(target){\r\n            console.log('==>Gmae round_push:',JSON.stringify(target.detail));\r\n            self.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        })\r\n\r\n        this.node.on('begin_push',function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(target.detail));\r\n            self.onGameBegin();\r\n            //第一把开局，要提示\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        });\r\n        \r\n        this.node.on('chupai_push',function(data){\r\n            console.log('==>Gmae chupai_push:',JSON.stringify(target.detail));\r\n            data = data.detail;\r\n            self.hideChupai();\r\n            if(data.last != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.last,null);   \r\n            }\r\n        });\r\n\r\n        this.node.on('action_push',function(data){\r\n            console.log('==>Gmae action_push:',JSON.stringify(target.detail));\r\n            self.showAction(data.detail);\r\n        });\r\n\r\n    },\r\n    initDragStuffs:function(node){\r\n        node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            \r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            node.interactable = node.getComponent(cc.Button).interactable;\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_START\");\r\n            this.chupaidian.node.active=false;\r\n            this.chupaidian.spriteFrame=node.getComponent(cc.Sprite).spriteFrame;\r\n            this.chupaidian.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            if (Math.abs(event.getDeltaX()) + Math.abs(event.getDeltaY()) < 0.5) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_MOVE\");\r\n            this.chupaidian.node.active=true;\r\n            node.opacity = 150;\r\n            this.chupaidian.opacity = 255;\r\n            this.chupaidian.scaleX = 1;\r\n            this.chupaidian.scaleY = 1;\r\n            this.chupaidian.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n            node.y = 0;\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_END\");\r\n            this.chupaidian.node.active=false;\r\n            node.opacity = 255;\r\n            if (event.getLocationY() >= 200) {\r\n                this.shoot(node.mjId);\r\n            }\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_CANCEL\");\r\n            if (event.getLocationY() >= 200) {\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n                this.shoot(node.mjId);\r\n            }else{\r\n                var moveBack=cc.moveTo(0.2,node.getLocation()).easing(cc.easeSineOut());\r\n                var seq=cc.sequence(moveBack,cc.callFunc(function(){\r\n                    cc.log(\"moveback==========>\");\r\n                    this.chupaidian.node.active=false;\r\n                    node.opacity = 255;\r\n                },this));\r\n                this.chupaidian.runAction(seq);\r\n            }\r\n        }.bind(this));\r\n        \r\n    },\r\n    onGameBegin:function(){\r\n        //隐藏每个座位上的动画sprite\r\n        for(var i = 0; i < this._effects.length; i++){\r\n            this._effects[i].node.active = false;\r\n        }\r\n\r\n        //自摸胡判断\r\n        for(var i = 0; i < th.socketIOManager.seats.length; I++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i);        \r\n            var nodeHupai = this._hupaiTips[localIndex];\r\n            nodeHupai.active = seatData.isHu;\r\n            if(seatData.isHu){\r\n                nodeHupai.getChildByName(\"hu\").active = !seatData.isZimo;\r\n                nodeHupai.getChildByName(\"zimo\").active = seatData.isZimo;\r\n            }\r\n            //todo 如果有胡牌信息\r\n\r\n        }\r\n        //隐藏各座位出牌点\r\n        this.hideChupai();\r\n        //隐藏当前玩家所有操作（吃，碰，杠，胡，弃）\r\n        this.hideOptions();\r\n        //初始化其他玩家手上的牌\r\n        var sides = [\"right\",\"up\",\"left\"];        \r\n        for(var i = 0; i < sides.length; ++i){\r\n            var holds = this.node.getChildByName(sides[i]).getChildByName(\"Holds\");\r\n            for(var j = 0; j < holds.childrenCount; ++j){\r\n                var nc = holds.children[j];\r\n                nc.active = true;\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;\r\n                var sprite = nc.getComponent(cc.Sprite); \r\n                sprite.spriteFrame =th.mahjongManager.holdsEmpty[i+1];\r\n            }            \r\n        }\r\n        //todo 判断是否回放\r\n\r\n        this.nodePrepare.active=false;\r\n        this.nodeGameInfo.active=true;\r\n\r\n        this.initMahjongs();\r\n\r\n        //初始化其他玩家的牌\r\n        for(var i = 0; i < th.socketIOManager.seats.length; I++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i);\r\n            if(localIndex != 0){\r\n                this.initOtherMahjongs(seatData);\r\n                if(i == th.socketIOManager.turn){\r\n                    this.initMopai(i,-1);\r\n                }else{\r\n                    this.initMopai(i,null);    \r\n                }\r\n            }\r\n        }\r\n        this.showChupai();\r\n        if(th.socketIOManager.actions != null){\r\n            this.showAction(th.socketIOManager.actions);\r\n            this.socketIOManager.actions = null;\r\n        }\r\n\r\n    },\r\n    onMJClicked:function(event){\r\n        if(th.socketIOManager.turn != th.socketIOManager.seatIndex){\r\n            return;\r\n        }\r\n        for(var i = 0; i < this._mymjs.length; ++i){\r\n            if(event.target == this._mymjs[i].node){\r\n                //如果是再次点击，则出牌\r\n                if(event.target == this._selectedMJ){\r\n                    this.shoot(this._selectedMJ.mjId); \r\n                    this._selectedMJ.y = 0;\r\n                    this._selectedMJ = null;\r\n                    return;\r\n                }\r\n                if(this._selectedMJ != null){\r\n                    this._selectedMJ.y = 0;\r\n                }\r\n                event.target.y = 15;\r\n                this._selectedMJ = event.target;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    onOptionClicked:function(event){\r\n        if(event.target.name == \"btnPeng\"){\r\n            th.sio.send(\"peng\");\r\n        }else if(event.target.name == \"btnGang\"){\r\n            th.sio.send(\"gang\",event.target.pai);\r\n        }else if(event.target.name == \"btnHu\"){\r\n            th.sio.send(\"hu\");\r\n        }else if(event.target.name == \"btnChi\"){\r\n            th.sio.send(\"chi\",event.target.pais);\r\n        }else if(event.target.name == \"btnGuo\"){\r\n            th.sio.send(\"guo\");\r\n        }\r\n    },\r\n    //出牌\r\n    shoot:function(mjId){\r\n        if(mjId == null){\r\n            return;\r\n        }\r\n        th.sio.send('chupai',mjId);\r\n    },\r\n    getMJIndex:function(side,index){\r\n        if(side == \"right\" || side == \"up\"){\r\n            return 13 - index;\r\n        }\r\n        return index;\r\n    },\r\n    initMopai:function(seatIndex,pai){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n        var side =th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lastIndex = this.getMJIndex(side,13);\r\n        var nc = holds.children[lastIndex];\r\n\r\n        nc.scaleX = 1.0;\r\n        nc.scaleY = 1.0;\r\n        if(pai == null){\r\n            nc.active = false;\r\n        }else if(pai >= 0){\r\n            nc.active = true;\r\n            //游戏回放时用到\r\n            if(side == \"up\"){\r\n                nc.scaleX = 0.73;\r\n                nc.scaleY = 0.73;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,pai);\r\n        } else if(pai != null){\r\n            nc.active = true;\r\n            //UP方向正常抓牌是-1\r\n            if(side == \"up\"){\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getHoldsEmptySpriteFrame(side);\r\n        }\r\n    },\r\n    hideChupai:function(){\r\n        for(var i = 0; i < this._chupais.length;i++){\r\n            this._chupais[i].node.active = false;\r\n        }     \r\n    },\r\n    showChupai:function(){\r\n        var pai = th.socketIOManager.chupai; \r\n        if( pai >=0){\r\n            var localIndex = this.getLocalIndex(th.socketIOManager.turn);\r\n            var sprite = this._chupais[localIndex];\r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n            sprite.node.active = true;   \r\n        }\r\n    },\r\n    showAction:function(data){\r\n        if(this.optionsWin.active){\r\n            this.hideOptions();\r\n        }\r\n        //todo \r\n        if(data && (data.hu || data.gang || data.peng || data.chi)){\r\n            this._options.active = true;\r\n            if(data.hu){\r\n                this.btnHu.node.active=true;\r\n            }\r\n            if(data.peng){\r\n                this.btnChi.node.active=true;\r\n            }\r\n            if(data.chi){\r\n                this.btnHu.node.active=true;\r\n            }\r\n            if(data.gang){\r\n                for(var i = 0; i < data.gangpai.length;++i){\r\n                    var gp = data.gangpai[i];\r\n                    this.addOption(\"btnGang\",gp);\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    initMahjongs:function(){\r\n        //手上麻将\r\n        var seats=th.socketIOManager.seats;\r\n        var seatData=seats[th.socketIOManager.seatIndex];\r\n        var holds=seatData.holds;\r\n        cc.log(\"initMahjongs:\",holds);\r\n        //排序\r\n        holds.sort(function(a,b){return a-b});\r\n\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        //初始化手牌\r\n        for(var i=0;i<holds.length;i++){\r\n            var mjid = holds[i];\r\n            var sprite=this._mymjs[lackingNum+i];\r\n            sprite.node.mjId = mjid;\r\n            this.setSpriteFrameByMJID(\"M_\",sprite,mjid);\r\n        }\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n        }\r\n        for(var i = lackingNum + holds.length; i < this._mymjs.length; ++i){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;            \r\n        }\r\n    },\r\n    initOtherMahjongs:function(seatData){\r\n        var localIndex = this.getLocalIndex(seatData.index);\r\n        if(localIndex == 0){\r\n            return;\r\n        }\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var sideHolds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var idx = this.getMJIndex(side,i);\r\n            sideHolds.children[idx].active = false;\r\n        }\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.sortHolds(seatData);\r\n        console.log(\"initOtherMahjongs:\",side,pre,side);\r\n        if(holds != null && holds.length > 0){\r\n            for(var i = 0; i < holds.length; i++){\r\n                var idx = this.getMJIndex(side,i + lackingNum);\r\n                var sprite = sideHolds.children[idx].getComponent(cc.Sprite);\r\n                if(side == \"up\"){\r\n                    sprite.node.scaleX = 0.73;\r\n                    sprite.node.scaleY = 0.73;                    \r\n                }\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,holds[i]);\r\n            }\r\n\r\n            if(holds.length + lackingNum == 13){\r\n                var lasetIdx = this.getMJIndex(side,13);\r\n                sideHolds.children[lasetIdx].active = false;\r\n            }\r\n        }\r\n\r\n    },\r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n    hideOptions:function(data){\r\n        this.optionsWin.active=false;\r\n        var activeReadyBtn=th.socketIOManager.round==0&&!th.socketIOManager.isReady(th.userManager.userId)\r\n        this.btnReady.node.active = activeReadyBtn;\r\n        this.btnGang.node.active=false;\r\n        this.btnPeng.node.active=false;\r\n        this.btnChi.node.active=false;\r\n        this.btnHu.node.active=false;\r\n        this.btnGuo.node.active=false;\r\n    },\r\n  \r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n});\r\n"]}