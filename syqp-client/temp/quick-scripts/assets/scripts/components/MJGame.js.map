{"version":3,"sources":["MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblRoundCount","spriteCaishen","Sprite","btnReady","Button","btnGang","btnPeng","btnChi","btnHu","btnGuo","chupaidian","settingWin","Node","optionsWin","nodePrepare","nodeGameInfo","nodeCaishen","_mymjs","_effects","_chupais","_hupaiTips","onLoad","th","addComponent","initView","initEventHandlers","active","onGameBegin","audioManager","playBGM","holds","node","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","sides","i","mjs","seatNode","spriteChupai","nodeHupai","socketIOManager","seats","animation","Animation","hideOptions","self","dataEventHandler","on","target","console","log","JSON","stringify","detail","seat","round","ready","initMahjongs","string","mjsy","config","data","hideChupai","last","seatIndex","initMopai","showAction","I","seatData","localIndex","getLocalIndex","isHu","isZimo","childrenCount","nc","scaleX","scaleY","mahjongManager","holdsEmpty","getMJIndex","side","index","pai","getSide","pre","getFoldPre","lastIndex","getSpriteFrameByMJID","getHoldsEmptySpriteFrame","showChupai","chupai","turn","hu","gang","peng","chi","_options","gangpai","gp","addOption","sort","a","b","lackingNum","pengs","angangs","diangangs","bugangs","chis","mjid","mjId","setSpriteFrameByMJID","activeReadyBtn","isReady","userManager","userId"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        spriteCaishen:cc.Sprite,\r\n        btnReady:cc.Button,\r\n        btnGang:cc.Button,\r\n        btnPeng:cc.Button,\r\n        btnChi:cc.Button,\r\n        btnHu:cc.Button,\r\n        btnGuo:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        optionsWin:cc.Node,    ///所有可以做的操作节点\r\n        nodePrepare:cc.Node,\r\n        nodeGameInfo:cc.Node,\r\n        nodeCaishen:cc.Node,\r\n\r\n        _mymjs:[],      //自己手上的牌Sprite结合\r\n        _effects:[],    //每个座位动画节点（Animation）\r\n        _chupais:[],    //每个座位出牌节点（Sprite）\r\n        _hupaiTips:[],  //每个座位胡牌提示节点:自摸，胡（抢杠胡）\r\n    },\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n\r\n        this.nodePrepare.active=true;\r\n        this.nodeGameInfo.active=false;\r\n\r\n        this.onGameBegin();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n    initView:function(){\r\n        //把自己的牌都设置为null\r\n        var holds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<holds.children.length;j++){\r\n                var sprite = holds.children[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n        }\r\n        \r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        //隐藏其他玩家手上的牌\r\n        for(var i=1;i<sides.length;i++){\r\n            var mjs=this.node.getChildByName(sides[i]).getChildByName('Holds').children;\r\n            for(var j=0;j<mjs.length;j++){\r\n                var sprite = mjs[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n            }\r\n        }\r\n        for(var i=0;i<sides.length;i++){\r\n            var seatNode=this.node.getChildByName(sides[i]);\r\n            //出牌\r\n            var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n            spriteChupai.node.active=false;\r\n            spriteChupai.spriteFrame = null;\r\n            //胡牌NODE\r\n            var nodeHupai=seatNode.getChildByName('HuPai');\r\n            nodeHupai.node.active=false;\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            //操作效果\r\n            var animation=seatNode.getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animation);\r\n            this._chupais.push(spriteChupai);\r\n            this._hupaiTips.push(nodeHupai);\r\n            \r\n        }\r\n        this.hideOptions();\r\n    },\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n        \r\n        //检查IP\r\n        this.node.on('check_ip', function (target) {\r\n            console.log('==>MJGame check_ip:',JSON.stringify(target.detail));\r\n        });\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(target){\r\n            console.log('==>Gmae ready_result:',JSON.stringify(target.detail));\r\n            var seat=target.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n        })\r\n\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(target){\r\n            console.log('==>Gmae holds_push:',JSON.stringify(target.detail));\r\n            self.initMahjongs();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(target){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(target.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        })\r\n        //断线\r\n        this.node.on('disconnect', function (target) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(target.detail));\r\n        });\r\n        \r\n        //通知还剩多少张牌\r\n         this.node.on(\"mjsy_push\",function(target){\r\n            console.log('==>Gmae mjsy_push:',JSON.stringify(target.detail));\r\n            self.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n        })\r\n\r\n        //通知当前是第几局\r\n        this.node.on(\"round_push\",function(target){\r\n            console.log('==>Gmae round_push:',JSON.stringify(target.detail));\r\n            self.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        })\r\n\r\n        this.node.on('begin_push',function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(target.detail));\r\n            self.onGameBegin();\r\n            //第一把开局，要提示\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        });\r\n        \r\n        this.node.on('chupai_push',function(data){\r\n            console.log('==>Gmae chupai_push:',JSON.stringify(target.detail));\r\n            data = data.detail;\r\n            self.hideChupai();\r\n            if(data.last != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.last,null);   \r\n            }\r\n        });\r\n\r\n        this.node.on('action_push',function(data){\r\n            console.log('==>Gmae action_push:',JSON.stringify(target.detail));\r\n            self.showAction(data.detail);\r\n        });\r\n\r\n    },\r\n    onGameBegin:function(){\r\n        //隐藏每个座位上的动画sprite\r\n        for(var i = 0; i < this._effects.length; i++){\r\n            this._effects[i].node.active = false;\r\n        }\r\n\r\n        //自摸胡判断\r\n        for(var i = 0; i < th.socketIOManager.seats.length; I++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i);        \r\n            var nodeHupai = this._hupaiTips[localIndex];\r\n            nodeHupai.active = seatData.isHu;\r\n            if(seatData.isHu){\r\n                nodeHupai.getChildByName(\"hu\").active = !seatData.isZimo;\r\n                nodeHupai.getChildByName(\"zimo\").active = seatData.isZimo;\r\n            }\r\n            //todo 如果有胡牌信息\r\n\r\n        }\r\n        //隐藏各座位出牌点\r\n        this.hideChupai();\r\n        //隐藏当前玩家所有操作（吃，碰，杠，胡，弃）\r\n        this.hideOptions();\r\n        //初始化其他玩家手上的牌\r\n        var sides = [\"right\",\"up\",\"left\"];        \r\n        for(var i = 0; i < sides.length; ++i){\r\n            var holds = this.node.getChildByName(sides[i]).getChildByName(\"Holds\");\r\n            for(var j = 0; j < holds.childrenCount; ++j){\r\n                var nc = holds.children[j];\r\n                nc.active = true;\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;\r\n                var sprite = nc.getComponent(cc.Sprite); \r\n                sprite.spriteFrame =th.mahjongManager.holdsEmpty[i+1];\r\n            }            \r\n        }\r\n        //todo 判断是否回放\r\n\r\n        this.nodePrepare.active=false;\r\n        this.nodeGameInfo.active=true;\r\n\r\n        this.initMahjongs();\r\n\r\n        \r\n\r\n\r\n    },\r\n    getMJIndex:function(side,index){\r\n        if(side == \"right\" || side == \"up\"){\r\n            return 13 - index;\r\n        }\r\n        return index;\r\n    },\r\n    initMopai:function(seatIndex,pai){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n        var side =th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lastIndex = this.getMJIndex(side,13);\r\n        var nc = holds.children[lastIndex];\r\n\r\n        nc.scaleX = 1.0;\r\n        nc.scaleY = 1.0;\r\n        if(pai == null){\r\n            nc.active = false;\r\n        }else if(pai >= 0){\r\n            nc.active = true;\r\n            //游戏回放时用到\r\n            if(side == \"up\"){\r\n                nc.scaleX = 0.73;\r\n                nc.scaleY = 0.73;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,pai);\r\n        } else if(pai != null){\r\n            nc.active = true;\r\n            //UP方向正常抓牌是-1\r\n            if(side == \"up\"){\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getHoldsEmptySpriteFrame(side);\r\n        }\r\n    },\r\n    hideChupai:function(){\r\n        for(var i = 0; i < this._chupais.length;i++){\r\n            this._chupais[i].node.active = false;\r\n        }     \r\n    },\r\n    showChupai:function(){\r\n        var pai = th.socketIOManager.chupai; \r\n        if( pai >=0){\r\n            var localIndex = this.getLocalIndex(th.socketIOManager.turn);\r\n            var sprite = this._chupais[localIndex];\r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n            sprite.node.active = true;   \r\n        }\r\n    },\r\n    showAction:function(data){\r\n        if(this.optionsWin.active){\r\n            this.hideOptions();\r\n        }\r\n        if(data && (data.hu || data.gang || data.peng || data.chi)){\r\n            this._options.active = true;\r\n            if(data.hu){\r\n                this.btnHu.node.active=true;\r\n            }\r\n            if(data.peng){\r\n                this.btnChi.node.active=true;\r\n            }\r\n            if(data.chi){\r\n                this.btnHu.node.active=true;\r\n            }\r\n            if(data.gang){\r\n                for(var i = 0; i < data.gangpai.length;++i){\r\n                    var gp = data.gangpai[i];\r\n                    this.addOption(\"btnGang\",gp);\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    initMahjongs:function(){\r\n        //手上麻将\r\n        var seats=th.socketIOManager.seats;\r\n        var seatData=seats[th.socketIOManager.seatIndex];\r\n        var holds=seatData.holds;\r\n        cc.log(\"initMahjongs:\",holds);\r\n        //排序\r\n        holds.sort(function(a,b){return a-b});\r\n\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        //初始化手牌\r\n        for(var i=0;i<holds.length;i++){\r\n            var mjid = holds[i];\r\n            var sprite=this._mymjs[lackingNum+i];\r\n            sprite.node.mjId = mjid;\r\n            this.setSpriteFrameByMJID(\"M_\",sprite,mjid);\r\n        }\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n        }\r\n        for(var i = lackingNum + holds.length; i < this._mymjs.length; ++i){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;            \r\n        }\r\n    },\r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n    hideOptions:function(data){\r\n        this.optionsWin.active=false;\r\n        var activeReadyBtn=th.socketIOManager.round==0&&!th.socketIOManager.isReady(th.userManager.userId)\r\n        this.btnReady.node.active = activeReadyBtn;\r\n        this.btnGang.node.active=false;\r\n        this.btnPeng.node.active=false;\r\n        this.btnChi.node.active=false;\r\n        this.btnHu.node.active=false;\r\n        this.btnGuo.node.active=false;\r\n    },\r\n  \r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n});\r\n"]}