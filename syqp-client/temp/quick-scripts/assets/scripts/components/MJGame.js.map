{"version":3,"sources":["MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblRoundCount","spriteCaishen","Sprite","btnReady","Button","btnGang","btnPeng","btnChi","btnHu","btnGuo","chupaidian","settingWin","Node","optionsWin","nodePrepare","nodeGameInfo","_mymjs","_effects","_chupais","_hupaiTips","onLoad","th","addComponent","initView","initEventHandlers","active","onGameBegin","audioManager","playBGM","node","myHolds","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","initDragStuffs","realwidth","director","getVisibleSize","width","scaleX","scaleY","sides","i","mjs","console","log","seatNode","spriteChupai","nodeHupai","socketIOManager","seats","animation","Animation","hideOptions","self","dataEventHandler","on","data","JSON","stringify","detail","seat","round","ready","initMahjongs","target","string","mjsy","config","setSpriteFrameByMJID","caishen","hideChupai","last","seatIndex","initMopai","showAction","seatData","index","playSFX","initOtherMahjongs","localIndex","getLocalIndex","playEffect","showChupai","audioUrl","mahjongManager","getAudioURLByMJID","pai","mjId","name","play","EventType","TOUCH_START","event","turn","interactable","x","getLocationX","y","getLocationY","height","bind","TOUCH_MOVE","Math","abs","getDeltaX","getDeltaY","opacity","TOUCH_END","shoot","TOUCH_CANCEL","moveBack","moveTo","getLocation","easing","easeSineOut","seq","sequence","callFunc","runAction","isHu","isZimo","status","holds","childrenCount","nc","holdsEmpty","actions","onMJClicked","_selectedMJ","onOptionClicked","sio","send","pais","getMJIndex","side","getSide","pre","getFoldPre","lastIndex","getSpriteFrameByMJID","getHoldsEmptySpriteFrame","chupai","addOption","btnName","options","child","option","btns","btn","join","hu","gang","peng","chi","_options","chiPai","gps","gangPai","gp","sort","a","b","sortHolds","lackingNum","pengs","angangs","diangangs","bugangs","chis","mjid","gold_icon","sideHolds","idx","lasetIdx","aa","bb"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        spriteCaishen:cc.Sprite,\r\n        btnReady:cc.Button,\r\n        btnGang:cc.Button,\r\n        btnPeng:cc.Button,\r\n        btnChi:cc.Button,\r\n        btnHu:cc.Button,\r\n        btnGuo:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        optionsWin:cc.Node,    ///所有可以做的操作节点\r\n        nodePrepare:cc.Node,\r\n        nodeGameInfo:cc.Node,\r\n\r\n        _mymjs:[],      //自己手上的牌Sprite结合\r\n        _effects:[],    //每个座位动画节点（Animation）\r\n        _chupais:[],    //每个座位出牌节点（Sprite）\r\n        _hupaiTips:[],  //每个座位胡牌提示节点:自摸，胡（抢杠胡）\r\n    },\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.addComponent(\"MJChiPengGangs\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n\r\n        this.nodePrepare.active=true;\r\n        this.nodeGameInfo.active=false;\r\n\r\n        this.onGameBegin();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n    initView:function(){\r\n        //把自己的牌都设置为null\r\n\r\n        this.chupaidian.node.active=false;\r\n\r\n        var myHolds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<myHolds.children.length;j++){\r\n                var sprite = myHolds.children[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n                //todo添加拖动效果\r\n                this.initDragStuffs(sprite.node);\r\n        }\r\n\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        myHolds.scaleX *= realwidth/1280;\r\n        myHolds.scaleY *= realwidth/1280;  \r\n        \r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        //隐藏其他玩家手上的牌\r\n       \r\n        for(var i=1;i<sides.length;i++){\r\n            var mjs=this.node.getChildByName(sides[i]).getChildByName('Holds').children;\r\n            console.log(\"隐藏：\"+sides[i]+\" 手上的牌: \"+mjs.length);\r\n            for(var j=0;j<mjs.length;j++){\r\n                var sprite = mjs[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n            }\r\n        }\r\n        for(var i=0;i<sides.length;i++){\r\n            var seatNode=this.node.getChildByName(sides[i]);\r\n            //出牌\r\n            var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n            spriteChupai.node.active=false;\r\n            spriteChupai.spriteFrame = null;\r\n            //胡牌NODE\r\n            var nodeHupai=seatNode.getChildByName('Hupai');\r\n            nodeHupai.active=false;\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            //操作效果\r\n            var animation=seatNode.getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animation);\r\n            this._chupais.push(spriteChupai);\r\n\r\n            console.log(\"_hupaiTips:\",nodeHupai);\r\n            this._hupaiTips.push(nodeHupai);\r\n            \r\n        }\r\n        this.hideOptions();\r\n    },\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n        \r\n        //检查IP\r\n        this.node.on('check_ip', function (data) {\r\n            console.log('==>MJGame check_ip:',JSON.stringify(data.detail));\r\n        });\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(data){\r\n            console.log('==>Gmae ready_result:',JSON.stringify(data.detail));\r\n            var seat=data.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n        })\r\n\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(data){\r\n            console.log('==>Gmae holds_push:',JSON.stringify(data.detail));\r\n            self.initMahjongs();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n                //todo\r\n            }\r\n        })\r\n        //断线\r\n        this.node.on('disconnect', function (data) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(data.detail));\r\n        });\r\n        \r\n        //通知还剩多少张牌\r\n         this.node.on(\"mjsy_push\",function(target){\r\n            console.log('==>Gmae mjsy_push:',JSON.stringify(target.detail));\r\n            self.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n        })\r\n\r\n        //通知当前是第几局\r\n        this.node.on(\"round_push\",function(data){\r\n            console.log('==>Gmae round_push:',JSON.stringify(data.detail));\r\n            self.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        })\r\n\r\n        //通知当前是第几局\r\n        this.node.on(\"caishen_push\",function(data){\r\n            console.log('==>Gmae caishen_push:',JSON.stringify(data.detail));\r\n            self.setSpriteFrameByMJID(\"M_\", self.spriteCaishen,th.socketIOManager.caishen);\r\n        })\r\n\r\n        this.node.on('begin_push',function(data){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n            //第一把开局，要提示\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        });\r\n        \r\n        this.node.on('chupai_push',function(data){\r\n            console.log('==>Gmae chupai_push:',JSON.stringify(data.detail));\r\n            data = data.detail;\r\n            self.hideChupai();\r\n            if(data.last != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.last,null);   \r\n            }\r\n            //todo 回放\r\n        });\r\n\r\n        this.node.on('action_push',function(data){\r\n            console.log('==>Gmae action_push:',JSON.stringify(data.detail));\r\n            self.showAction(data.detail);\r\n        });\r\n\r\n        //过，自己操做过返回结果\r\n        this.node.on('guo_result',function(data){\r\n            self.hideChupai();\r\n        });\r\n        //过牌，\r\n        this.node.on('guo_notify_push',function(data){\r\n            console.log('==>Gmae guo_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            self.hideOptions();\r\n            var seatData=data.detail;\r\n            //如果是自己，则刷新手牌\r\n            if(seatData.index ==th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            th.audioManager.playSFX(\"give.mp3\");\r\n        });\r\n        //吃牌\r\n        this.node.on('chi_notify_push',function(data){\r\n            console.log('==>Gmae chi_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_chi\");\r\n            th.audioManager.playSFX(\"nv/chi.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //碰牌\r\n        this.node.on('peng_notify_push',function(data){\r\n            console.log('==>Gmae peng_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_peng\");\r\n            th.audioManager.playSFX(\"nv/peng.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //杠牌\r\n        this.node.on('gang_notify_push',function(data){\r\n            console.log('==>Gmae gang_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_gang\");\r\n            th.audioManager.playSFX(\"nv/pang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //出牌\r\n        this.node.on('chupai_notify_push',function(data){\r\n            self.hideChupai();\r\n            var seatData = data.detail.seatData;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            self.showChupai();\r\n            var audioUrl = th.mahjongManager.getAudioURLByMJID(data.detail.pai);\r\n            th.audioManager.playSFX(audioUrl);\r\n        });\r\n        //摸牌只有自己才会收到此消息\r\n        this.node.on('mopai_push',function(data){\r\n            self.hideChupai();\r\n            data = data.detail;\r\n            var pai = data.pai;\r\n            var localIndex = th.socketIOManager.getLocalIndex(data.seatIndex);\r\n            if(localIndex == 0){\r\n                var index = 13;\r\n                var sprite=this._mymjs[index];\r\n                sprite.node.mjId = pai;\r\n                self.setSpriteFrameByMJID(\"M_\",sprite,pai);\r\n\r\n            }else if(false){\r\n                //todo 重放\r\n            }\r\n        });\r\n      \r\n\r\n    },\r\n    playEffect:function(index,name){\r\n        this._effects[index].node.active = true;\r\n        this._effects[index].play(name);\r\n    },\r\n    initDragStuffs:function(node){\r\n        node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            \r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            node.interactable = node.getComponent(cc.Button).interactable;\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_START\");\r\n            this.chupaidian.node.active=false;\r\n            this.chupaidian.spriteFrame=node.getComponent(cc.Sprite).spriteFrame;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            if (Math.abs(event.getDeltaX()) + Math.abs(event.getDeltaY()) < 0.5) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_MOVE\");\r\n            this.chupaidian.node.active=true;\r\n            node.opacity = 150;\r\n            this.chupaidian.node.opacity = 255;\r\n            this.chupaidian.node.scaleX = 1;\r\n            this.chupaidian.node.scaleY = 1;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n            node.y = 0;\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_END\");\r\n            this.chupaidian.node.active=false;\r\n            node.opacity = 255;\r\n            if (event.getLocationY() >= 500) {\r\n                this.shoot(node.mjId);\r\n            }\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            console.log(\"cc.Node.EventType.TOUCH_CANCEL\");\r\n            if (event.getLocationY() >= 200) {\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n                this.shoot(node.mjId);\r\n            }else{\r\n                var moveBack=cc.moveTo(0.2,node.getLocation()).easing(cc.easeSineOut());\r\n                var seq=cc.sequence(moveBack,cc.callFunc(function(){\r\n                    cc.log(\"moveback==========>\");\r\n                    this.chupaidian.node.active=false;\r\n                    node.opacity = 255;\r\n                },this));\r\n                this.chupaidian.runAction(seq);\r\n            }\r\n        }.bind(this));\r\n        \r\n    },\r\n    onGameBegin:function(){\r\n        //隐藏每个座位上的动画sprite\r\n        for(var i = 0; i < this._effects.length; i++){\r\n            this._effects[i].node.active = false;\r\n        }\r\n\r\n        //自摸胡判断\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i); \r\n            var nodeHupai = this._hupaiTips[localIndex];\r\n            nodeHupai.active = seatData.isHu;\r\n            if(seatData.isHu){\r\n                nodeHupai.getChildByName(\"hu\").active = !seatData.isZimo;\r\n                nodeHupai.getChildByName(\"zimo\").active = seatData.isZimo;\r\n            }\r\n            //todo 如果有胡牌信息\r\n\r\n        }\r\n        //隐藏各座位出牌点\r\n        this.hideChupai();\r\n        //隐藏当前玩家所有操作（吃，碰，杠，胡，弃）\r\n        this.hideOptions();\r\n        \r\n        //todo 判断是否回放  //&& cc.vv.replayMgr.isReplay() == false\r\n        if(th.socketIOManager.status == \"idle\" ){\r\n            return;\r\n        }\r\n        //初始化其他玩家手上的牌\r\n        var sides = [\"right\",\"up\",\"left\"];        \r\n        for(var i = 0; i < sides.length; ++i){\r\n            var holds = this.node.getChildByName(sides[i]).getChildByName(\"Holds\");\r\n            for(var j = 0; j < holds.childrenCount; ++j){\r\n                var nc = holds.children[j];\r\n                nc.active = true;\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;\r\n                var sprite = nc.getComponent(cc.Sprite); \r\n                sprite.spriteFrame =th.mahjongManager.holdsEmpty[i+1];\r\n            }            \r\n        }\r\n\r\n        this.nodePrepare.active=false;\r\n        this.nodeGameInfo.active=true;\r\n\r\n        this.initMahjongs();\r\n\r\n        //初始化其他玩家的牌\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i);\r\n            if(localIndex != 0){\r\n                this.initOtherMahjongs(seatData);\r\n                if(i == th.socketIOManager.turn){\r\n                    this.initMopai(i,-1);\r\n                }else{\r\n                    this.initMopai(i,null);    \r\n                }\r\n            }\r\n        }\r\n        this.showChupai();\r\n        if(th.socketIOManager.actions != null){\r\n            this.showAction(th.socketIOManager.actions);\r\n            this.socketIOManager.actions = null;\r\n        }\r\n\r\n    },\r\n    onMJClicked:function(event){\r\n        if(th.socketIOManager.turn != th.socketIOManager.seatIndex){\r\n            return;\r\n        }\r\n        for(var i = 0; i < this._mymjs.length; ++i){\r\n            if(event.target == this._mymjs[i].node){\r\n                //如果是再次点击，则出牌\r\n                if(event.target == this._selectedMJ){\r\n                    this.shoot(this._selectedMJ.mjId); \r\n                    this._selectedMJ.y = 0;\r\n                    this._selectedMJ = null;\r\n                    return;\r\n                }\r\n                if(this._selectedMJ != null){\r\n                    this._selectedMJ.y = 0;\r\n                }\r\n                event.target.y = 15;\r\n                this._selectedMJ = event.target;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    onOptionClicked:function(event){\r\n        if(event.target.name == \"btnPeng\"){\r\n            th.sio.send(\"peng\");\r\n        }else if(event.target.name == \"btnGang\"){\r\n            th.sio.send(\"gang\",event.target.pai);\r\n        }else if(event.target.name == \"btnHu\"){\r\n            th.sio.send(\"hu\");\r\n        }else if(event.target.name == \"btnChi\"){\r\n            th.sio.send(\"chi\",event.target.pais);\r\n        }else if(event.target.name == \"btnGuo\"){\r\n            th.sio.send(\"guo\");\r\n        }\r\n    },\r\n    //出牌\r\n    shoot:function(mjId){\r\n        if(mjId == null){\r\n            return;\r\n        }\r\n        th.sio.send('chupai',mjId);\r\n    },\r\n    getMJIndex:function(side,index){\r\n        if(side == \"right\" || side == \"up\"){\r\n            return 13 - index;\r\n        }\r\n        return index;\r\n    },\r\n    initMopai:function(seatIndex,pai){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n        var side =th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lastIndex = this.getMJIndex(side,13);\r\n        var nc = holds.children[lastIndex];\r\n\r\n        nc.scaleX = 1.0;\r\n        nc.scaleY = 1.0;\r\n        if(pai == null){\r\n            nc.active = false;\r\n        }else if(pai >= 0){\r\n            nc.active = true;\r\n            //游戏回放时用到\r\n            if(side == \"up\"){\r\n                nc.scaleX = 0.73;\r\n                nc.scaleY = 0.73;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,pai);\r\n        } else if(pai != null){\r\n            nc.active = true;\r\n            //UP方向正常抓牌是-1\r\n            if(side == \"up\"){\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getHoldsEmptySpriteFrame(side);\r\n        }\r\n    },\r\n    hideChupai:function(){\r\n        for(var i = 0; i < this._chupais.length;i++){\r\n            this._chupais[i].node.active = false;\r\n        }     \r\n    },\r\n    showChupai:function(){\r\n        var pai = th.socketIOManager.chupai; \r\n        if( pai >=0){\r\n            var localIndex = th.socketIOManager.getLocalIndex(th.socketIOManager.turn);\r\n            var sprite = this._chupais[localIndex];\r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n            sprite.node.active = true;   \r\n        }\r\n    },\r\n    addOption:function(btnName,pai){\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var child = options.children[i];\r\n            if(child.name='Option'&&child.active==false){\r\n                child.active=true;\r\n                var option=child.getChildByName('Option');\r\n                if(btnName!='btnChi'){\r\n                    var sprite = option.getChildByName(\"opTarget1\").getComponent(cc.Sprite);\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n                    sprite.active=true;\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pai = pai;\r\n                }else{\r\n                    var pais=[];\r\n                    for(var i=0;i<pai.length;i++){\r\n                        if(pai[i]!=-1){\r\n                            pais[i]=pai[i];\r\n                            var sprite = option.getChildByName(\"opTarget\"+pais.length).getComponent(cc.Sprite);\r\n                            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai[i]);\r\n                            sprite.active=true;\r\n                        }\r\n                    }\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pais = pais.join(\",\");\r\n                }\r\n            }\r\n        }\r\n    },\r\n    showAction:function(data){\r\n        if(this.optionsWin.active){\r\n            this.hideOptions();\r\n        }\r\n        //todo \r\n        if(data && (data.hu || data.gang || data.peng || data.chi)){\r\n            this._options.active = true;\r\n            if(data.hu){\r\n                this.addOption(\"btnHu\",data.pai);\r\n            }\r\n            if(data.peng){\r\n                this.addOption(\"btnPeng\",data.pai);\r\n            }\r\n            if(data.chi){\r\n                for(var i = 0; i < data.chiPai.length;++i){\r\n                    var gps = data.chiPai[i];\r\n                    this.addOption(\"btnChi\",gps);\r\n                }\r\n            }\r\n            if(data.gang){\r\n                for(var i = 0; i < data.gangPai.length;++i){\r\n                    var gp = data.gangPai[i];\r\n                    this.addOption(\"btnGang\",gp);\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    initMahjongs:function(){\r\n        //手上麻将\r\n        var seats=th.socketIOManager.seats;\r\n        var seatData=seats[th.socketIOManager.seatIndex];\r\n        var holds=seatData.holds;\r\n        if(holds == null){\r\n            return;\r\n        }\r\n        //排序\r\n        holds.sort(function(a,b){return a-b});\r\n        \r\n        holds=this.sortHolds(holds);\r\n\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        //初始化手牌\r\n        for(var i=0;i<holds.length;i++){\r\n            var mjid = holds[i];\r\n            var sprite=this._mymjs[lackingNum+i];\r\n            sprite.node.mjId = mjid;\r\n            this.setSpriteFrameByMJID(\"M_\",sprite,mjid);\r\n\r\n            var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=mjid==th.socketIOManager.caishen;\r\n        }\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n        }\r\n        for(var i = lackingNum + holds.length; i < this._mymjs.length; ++i){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjId = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;            \r\n        }\r\n    },\r\n    initOtherMahjongs:function(seatData){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n        if(localIndex == 0){\r\n            return;\r\n        }\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var sideHolds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var idx = this.getMJIndex(side,i);\r\n            sideHolds.children[idx].active = false;\r\n        }\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.sortHolds(seatData.holds);\r\n        if(holds != null && holds.length > 0){\r\n            for(var i = 0; i < holds.length; i++){\r\n                var idx = this.getMJIndex(side,i + lackingNum);\r\n                var sprite = sideHolds.children[idx].getComponent(cc.Sprite);\r\n                if(side == \"up\"){\r\n                    sprite.node.scaleX = 0.73;\r\n                    sprite.node.scaleY = 0.73;                    \r\n                }\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,holds[i]);\r\n            }\r\n\r\n            if(holds.length + lackingNum == 13){\r\n                var lasetIdx = this.getMJIndex(side,13);\r\n                sideHolds.children[lasetIdx].active = false;\r\n            }\r\n        }\r\n\r\n    },\r\n    sortHolds:function(holds){\r\n        if(holds==null){\r\n            return holds;\r\n        }\r\n        holds.sort(function(a,b){\r\n            var aa=a;\r\n            var bb=b;\r\n            if(aa==th.socketIOManager.caishen){\r\n                aa=aa-100;\r\n            }\r\n            if(bb==th.socketIOManager.caishen){\r\n                bb=bb-100;\r\n            }\r\n            return aa-bb;\r\n        });\r\n        return holds;\r\n    },\r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n    hideOptions:function(data){\r\n        this.optionsWin.active=false;\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var child = options.children[i];\r\n            if(child.name=='Option'){\r\n                child.active=false;\r\n                var option=child.getChildByName('Option');\r\n                option.getChildByName('opTarget1').active=false;\r\n                option.getChildByName('opTarget2').active=false;\r\n                var btns=option.getChildByName('btns');\r\n                btns.getChildByName('btnChi').active=false;\r\n                btns.getChildByName('btnPeng').active=false;\r\n                btns.getChildByName('btnGang').active=false;\r\n                btns.getChildByName('btnHu').active=false;\r\n            }\r\n        }\r\n    },\r\n  \r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n});\r\n"]}