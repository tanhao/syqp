{"version":3,"sources":["MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblRoundCount","btnReady","Button","btnGang","btnPeng","btnChi","btnHu","btnGuo","chupaidian","Sprite","settingWin","Node","optionsWin","nodePrepare","nodeRoomInfo","nodeCaishen","_mymjs","_effects","_chupais","onLoad","th","addComponent","initView","initEventHandlers","active","onGameBegin","audioManager","playBGM","holds","node","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","seatNames","i","mjs","socketIOManager","seats","seatNode","animation","Animation","hideOptions","self","dataEventHandler","on","target","console","log","JSON","stringify","detail","seat","round","ready","initPokers","seatIndex","sort","a","b","pokerId","_myHoldPokers","pokerManager","getSpriteFrameByPokerId","_seat","setRestCard","data","activeReadyBtn","isReady","userManager","userId"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        btnReady:cc.Button,\r\n        btnGang:cc.Button,\r\n        btnPeng:cc.Button,\r\n        btnChi:cc.Button,\r\n        btnHu:cc.Button,\r\n        btnGuo:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        optionsWin:cc.Node,\r\n        nodePrepare:cc.Node,\r\n        nodeRoomInfo:cc.Node,\r\n        nodeCaishen:cc.Node,\r\n\r\n        _mymjs:[],   //自己手上的牌Sprite结合\r\n        _effects:[], //每个座位动画节点（Animation）\r\n        _chupais:[], //每个座位出牌节点（Sprite）\r\n    },\r\n\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n\r\n        this.nodePrepare.active=true;\r\n        this.nodeCaishen.active=false;\r\n        this.nodeRoomInfo.active=false;\r\n\r\n        this.onGameBegin();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n\r\n    initView:function(){\r\n        //把自己的牌都设置为null\r\n        var holds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<holds.children.length;j++){\r\n                var sprite = holds.children[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n        }\r\n        \r\n        var seatNames = [\"myself\",\"right\",\"up\",\"left\"];\r\n        //隐藏其他玩家手上的牌\r\n        for(var i=1;i<seatNames.length;i++){\r\n            var mjs=this.node.getChildByName(seatNames[i]).getChildByName('Holds').children;\r\n            for(var j=0;j<mjs.length;j++){\r\n                var sprite = mjs[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n            }\r\n        }\r\n        for(var i=0;i<seatNames.length;i++){\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            var seatNode=this.node.getChildByName(seatNames[i]);\r\n            var animation=seatNode.getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animation);\r\n            \r\n        }\r\n        for(var i=0;i<seatNames.length;i++){\r\n            var seatNode=this.node.getChildByName(seatNames[i]);\r\n            var sprite=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n            sprite.node.active=false;\r\n            sprite.spriteFrame = null;\r\n            this._chupais.push(sprite);\r\n        }\r\n        this.hideOptions();\r\n    },\r\n\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n        \r\n        //检查IP\r\n        this.node.on('check_ip', function (target) {\r\n            console.log('==>MJGame check_ip:',JSON.stringify(target.detail));\r\n        });\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(target){\r\n            console.log('==>Gmae ready_result:',JSON.stringify(target.detail));\r\n            var seat=target.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n        })\r\n\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(target){\r\n            console.log('==>Gmae holds_push:',JSON.stringify(target.detail));\r\n            self.initPokers();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(target){\r\n            console.log('==>Gmae begin_push:',JSON.stringify(target.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        })\r\n\r\n\r\n        //断线\r\n        this.node.on('disconnect', function (target) {\r\n            console.log('==>Gmae disconnect:',JSON.stringify(target.detail));\r\n        });\r\n        \r\n\r\n    },\r\n    onGameBegin:function(){\r\n        /*\r\n        this.hideOptions();\r\n        //显示手上的牌\r\n        var seatNames = [\"right\",\"up\",\"left\"];\r\n        for(var i=0;i<seatNames.length;i++){\r\n            var mjs=this.node.getChildByName(seatNames[i]).getChildByName('Holds').children;\r\n            for(var j=0;j<mjs.length;j++){\r\n                var mj=mjs[j];\r\n                mj.active=false;\r\n                var sprite = mj.getComponent(cc.Sprite);\r\n                sprite.spriteFrame = null;\r\n                this._folds[name].push(sprite);  \r\n            }\r\n        }\r\n        */\r\n    },\r\n    initPokers:function(){\r\n        var seats=th.socketIOManager.seats;\r\n        var seat=seats[th.socketIOManager.seatIndex];\r\n        var holds=seat.holds;\r\n        cc.log(\"initPokers:\",holds);\r\n        //排序\r\n        holds.sort(function(a,b){return a-b});\r\n        for(var i=0;i<holds.length;i++){\r\n            var pokerId=holds[i];\r\n            var sprite=this._myHoldPokers[i];\r\n            sprite.node.pokerId = pokerId;\r\n            sprite.spriteFrame = th.pokerManager.getSpriteFrameByPokerId(pokerId);\r\n            sprite.node.active = true;\r\n        }\r\n        for(var i=0;i<seats.length;i++){\r\n            this._seat[i].setRestCard(holds.length);\r\n        }\r\n    },\r\n    \r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n\r\n    hideOptions:function(data){\r\n        this.optionsWin.active=false;\r\n        var activeReadyBtn=th.socketIOManager.round==0&&!th.socketIOManager.isReady(th.userManager.userId)\r\n        this.btnReady.node.active = activeReadyBtn;\r\n        this.btnGang.node.active=false;\r\n        this.btnPeng.node.active=false;\r\n        this.btnChi.node.active=false;\r\n        this.btnHu.node.active=false;\r\n        this.btnGuo.node.active=false;\r\n    },\r\n  \r\n\r\n});\r\n"]}