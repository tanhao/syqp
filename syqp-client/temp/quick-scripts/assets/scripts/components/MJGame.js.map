{"version":3,"sources":["MJGame.js"],"names":["cc","Class","extends","Component","properties","lblMjCount","Label","lblFontMjCount","lblRoundCount","spriteCaishen","Sprite","btnReady","Button","chupaidian","settingWin","Node","optionsWin","nodePrepare","nodeGameInfo","_mymjs","_effects","_chupais","_hupaiTips","onLoad","th","addComponent","initView","initEventHandlers","active","onGameBegin","audioManager","playBGM","node","myHolds","getChildByName","j","children","length","sprite","getComponent","push","spriteFrame","initDragStuffs","realwidth","director","getVisibleSize","width","scaleX","scaleY","sides","i","mjs","seatNode","spriteChupai","nodeHupai","socketIOManager","seats","animation","Animation","hideOptions","self","dataEventHandler","on","data","log","JSON","stringify","detail","checkIp","seat","round","ready","initMahjongs","target","string","mjsy","config","setSpriteFrameByMJID","caishen","hideChupai","last","seatIndex","initMopai","turn","showAction","seatData","index","playSFX","initOtherMahjongs","localIndex","getLocalIndex","playEffect","getSeatIndexById","userId","gangType","showChupai","audioUrl","mahjongManager","getAudioURLByMJID","pai","mjid","gold_icon","isHu","isZimo","alert","show","wc","loadScene","name","play","EventType","TOUCH_START","event","interactable","x","getLocationX","y","getLocationY","height","bind","TOUCH_MOVE","Math","abs","getDeltaX","getDeltaY","opacity","TOUCH_END","shoot","TOUCH_CANCEL","status","holds","childrenCount","nc","holdsEmpty","actions","onMJClicked","_selectedMJ","onOptionClicked","sio","send","pais","getMJIndex","side","getSide","pre","getFoldPre","lastIndex","getSpriteFrameByMJID","getHoldsEmptySpriteFrame","chupai","addOption","btnName","options","option","btns","btn","join","hu","gang","peng","chi","huPai","pengPai","chiPai","gangPai","gp","sortHolds","lackingNum","pengs","angangs","diangangs","bugangs","chis","sideHolds","idx","lasetIdx"],"mappings":"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","file":"MJGame.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        lblMjCount:cc.Label,\r\n        lblFontMjCount:cc.Label,\r\n        lblRoundCount:cc.Label,\r\n        spriteCaishen:cc.Sprite,\r\n        btnReady:cc.Button,\r\n        chupaidian:cc.Sprite,\r\n        settingWin:cc.Node,\r\n        optionsWin:cc.Node,    ///所有可以做的操作节点\r\n        nodePrepare:cc.Node,\r\n        nodeGameInfo:cc.Node,\r\n\r\n        _mymjs:[],      //自己手上的牌Sprite结合\r\n        _effects:[],    //每个座位动画节点（Animation）\r\n        _chupais:[],    //每个座位出牌节点（Sprite）\r\n        _hupaiTips:[],  //每个座位胡牌提示节点:自摸，胡（抢杠胡）\r\n    },\r\n    onLoad () {\r\n        if(th==null){ return; }\r\n        this.addComponent(\"MJFolds\");\r\n        this.addComponent(\"MJChiPengGangs\");\r\n        this.addComponent(\"MJGameOver\");\r\n        this.addComponent(\"MJGameResult\");\r\n        this.addComponent(\"MJReConnect\");\r\n        this.initView();\r\n        this.initEventHandlers();\r\n\r\n        this.nodePrepare.active=true;\r\n        this.nodeGameInfo.active=false;\r\n\r\n        this.onGameBegin();\r\n        th.audioManager.playBGM(\"bg_fight.mp3\");\r\n    },\r\n    initView:function(){\r\n        //把自己的牌都设置为null\r\n        this.chupaidian.node.active=false;\r\n        var myHolds = this.node.getChildByName('myself').getChildByName('Holds');\r\n        for(var j=0;j<myHolds.children.length;j++){\r\n                var sprite = myHolds.children[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n                this._mymjs.push(sprite);\r\n                sprite.spriteFrame = null;\r\n                //todo添加拖动效果\r\n                this.initDragStuffs(sprite.node);\r\n        }\r\n\r\n        var realwidth = cc.director.getVisibleSize().width;\r\n        myHolds.scaleX *= realwidth/1280;\r\n        myHolds.scaleY *= realwidth/1280;  \r\n        \r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        //隐藏其他玩家手上的牌\r\n        for(var i=1;i<sides.length;i++){\r\n            var mjs=this.node.getChildByName(sides[i]).getChildByName('Holds').children;\r\n            for(var j=0;j<mjs.length;j++){\r\n                var sprite = mjs[j].getComponent(cc.Sprite);\r\n                sprite.node.active=false;\r\n            }\r\n        }\r\n        for(var i=0;i<sides.length;i++){\r\n            var seatNode=this.node.getChildByName(sides[i]);\r\n            //出牌\r\n            var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n            spriteChupai.node.active=false;\r\n            spriteChupai.spriteFrame = null;\r\n            //胡牌NODE\r\n            var nodeHupai=seatNode.getChildByName('Hupai');\r\n            nodeHupai.active=false;\r\n            if((i==2&&th.socketIOManager.seats.length==3)||((i==1||i==3)&&th.socketIOManager.seats.length==2)){\r\n                continue;\r\n            }\r\n            //操作效果\r\n            var animation=seatNode.getChildByName('Effect').getComponent(cc.Animation);\r\n            this._effects.push(animation);\r\n            this._chupais.push(spriteChupai);\r\n\r\n            this._hupaiTips.push(nodeHupai);\r\n            \r\n        }\r\n        this.hideOptions();\r\n    },\r\n    initEventHandlers:function(){\r\n        var self=this;\r\n        th.socketIOManager.dataEventHandler=this.node;\r\n        //检查IP\r\n        this.node.on('check_ip', function (data) {\r\n            cc.log('==>MJGame check_ip:',JSON.stringify(data.detail));\r\n            self.checkIp();\r\n        });\r\n        this.node.on('sync_push',function(data){\r\n            self.onGameBegin();\r\n            self.checkIp();\r\n        });\r\n        //自己准备返回\r\n        this.node.on(\"ready_result\",function(data){\r\n            cc.log('==>Gmae ready_result:',JSON.stringify(data.detail));\r\n            var seat=data.detail;\r\n            self.btnReady.node.active = th.socketIOManager.round==0&&!seat.ready;\r\n        })\r\n        //玩家手上的牌\r\n        this.node.on(\"holds_push\",function(data){\r\n            cc.log('==>Gmae holds_push:',JSON.stringify(data.detail));\r\n            self.initMahjongs();\r\n        })\r\n        //开始游戏，出头的人\r\n        this.node.on(\"begin_push\",function(data){\r\n            cc.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n             //第一把开局，要检查IP\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n                //todo\r\n            }\r\n        })\r\n        //断线\r\n        this.node.on('disconnect', function (data) {\r\n            cc.log('==>Gmae disconnect:',JSON.stringify(data.detail));\r\n        });\r\n        //通知还剩多少张牌\r\n         this.node.on(\"mjsy_push\",function(target){\r\n            //cc.log('==>Gmae mjsy_push:',JSON.stringify(target.detail));\r\n            self.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n            self.lblFontMjCount.string=\"x\"+th.socketIOManager.mjsy;\r\n        })\r\n        //通知当前是第几局\r\n        this.node.on(\"round_push\",function(data){\r\n            cc.log('==>Gmae round_push:',JSON.stringify(data.detail));\r\n            self.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        })\r\n        //通知财神是那个\r\n        this.node.on(\"caishen_push\",function(data){\r\n            cc.log('==>Gmae caishen_push:',JSON.stringify(data.detail));\r\n            self.setSpriteFrameByMJID(\"B_\", self.spriteCaishen,th.socketIOManager.caishen);\r\n        })\r\n        this.node.on('begin_push',function(data){\r\n            cc.log('==>Gmae begin_push:',JSON.stringify(data.detail));\r\n            self.onGameBegin();\r\n            //第一把开局，要提示\r\n            if(th.socketIOManager.round == 1){\r\n                cc.log(\"check ip ....\");    \r\n            }\r\n        });\r\n        this.node.on('chupai_push',function(data){\r\n            cc.log('==>Gmae chupai_push:',JSON.stringify(data.detail));\r\n            data = data.detail;\r\n            self.hideChupai();\r\n            if(data.last != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.last,null);   \r\n            }\r\n            //todo 回放\r\n            if( data.turn != th.socketIOManager.seatIndex){\r\n                self.initMopai(data.turn,-1);\r\n            }\r\n            \r\n        });\r\n        this.node.on('action_push',function(data){\r\n            cc.log('==>Gmae action_push:',JSON.stringify(data.detail));\r\n            self.showAction(data.detail);\r\n        });\r\n        //过，自己操做过返回结果\r\n        this.node.on('guo_result',function(data){\r\n            self.hideChupai();\r\n        });\r\n        //过牌，\r\n        this.node.on('guo_notify_push',function(data){\r\n            //cc.log('==>Gmae guo_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            self.hideOptions();\r\n            var seatData=data.detail;\r\n            //如果是自己，则刷新手牌\r\n            if(seatData.index ==th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }\r\n            th.audioManager.playSFX(\"give.mp3\");\r\n        });\r\n        //吃牌\r\n        this.node.on('chi_notify_push',function(data){\r\n            cc.log('==>Gmae chi_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_chi\");\r\n            th.audioManager.playSFX(\"nv/chi.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //碰牌\r\n        this.node.on('peng_notify_push',function(data){\r\n            cc.log('==>Gmae peng_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            self.playEffect(localIndex,\"play_peng\");\r\n            th.audioManager.playSFX(\"nv/peng.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //杠牌\r\n        this.node.on('gang_notify_push',function(data){\r\n            cc.log('==>Gmae gang_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData=data.detail;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            //var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n            //self.playEffect(localIndex,\"play_gang\");\r\n            //th.audioManager.playSFX(\"nv/gang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //喊杠\r\n        this.node.on('hangang_notify_push',function(data){\r\n            cc.log('==>Gmae hangang_notify_push:',JSON.stringify(data.detail));\r\n            var seatIndex = th.socketIOManager.getSeatIndexById(data.detail.userId);\r\n            var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n            self.playEffect(localIndex,data.detail.gangType==\"angang\"?\"play_angang\":\"play_gang\");\r\n            th.audioManager.playSFX(\"nv/gang.mp3\");\r\n            self.hideOptions();\r\n        });\r\n        //出牌\r\n        this.node.on('chupai_notify_push',function(data){\r\n            //cc.log('==>Gmae chupai_notify_push:',JSON.stringify(data.detail));\r\n            self.hideChupai();\r\n            var seatData = data.detail.seatData;\r\n            if(seatData.index == th.socketIOManager.seatIndex){\r\n                self.initMahjongs();                \r\n            }else{\r\n                self.initOtherMahjongs(seatData);\r\n            }\r\n            self.showChupai();\r\n            var audioUrl = th.mahjongManager.getAudioURLByMJID(data.detail.pai);\r\n            th.audioManager.playSFX(audioUrl);\r\n        });\r\n        //摸牌只有自己才会收到此消息\r\n        this.node.on('mopai_push',function(data){\r\n            self.hideChupai();\r\n            data = data.detail;\r\n            var pai = data.pai;\r\n            var localIndex = th.socketIOManager.getLocalIndex(data.seatIndex);\r\n            if(localIndex == 0){\r\n                var index = 13;\r\n                var sprite=self._mymjs[index];\r\n                sprite.node.mjid = pai;\r\n                self.setSpriteFrameByMJID(\"M_\",sprite,pai);\r\n                var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n                gold_icon.active=pai==th.socketIOManager.caishen;\r\n\r\n            }else if(false){\r\n                //todo 重放\r\n            }\r\n        });\r\n        //胡牌\r\n        this.node.on('hu_push',function(data){\r\n            cc.log('==>Gmae hu_push:',JSON.stringify(data.detail));\r\n\r\n            var data = data.detail;\r\n            var seatIndex = data.seatIndex;\r\n            var localIndex =th.socketIOManager.getLocalIndex(seatIndex);\r\n            var nodeHupai=self._hupaiTips[localIndex];\r\n            nodeHupai.active=true;\r\n\r\n            if(localIndex == 0){\r\n                self.hideOptions();\r\n            }\r\n            var seatData = th.socketIOManager.seats[seatIndex];\r\n            seatData.isHu = true;\r\n\r\n            nodeHupai.getChildByName(\"hu\").active = !data.isZimo;\r\n            nodeHupai.getChildByName(\"zimo\").active = data.isZimo;\r\n            //todo 回放\r\n            self.playEffect(localIndex,data.isZimo ? \"play_zimo\":\"play_hu\");\r\n            th.audioManager.playSFX(\"nv/hu.mp3\");\r\n        });\r\n        this.node.on('clean_push',function(){\r\n            cc.log('==>Gmae clean_push:');\r\n            //隐藏自己牌\r\n            var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n            //隐藏其他玩家手上的牌\r\n            for(var i=0;i<sides.length;i++){\r\n                var seatNode=self.node.getChildByName(sides[i]);\r\n                var mjs=seatNode.getChildByName('Holds').children;\r\n                for(var j=0;j<mjs.length;j++){\r\n                    var sprite = mjs[j].getComponent(cc.Sprite);\r\n                    sprite.node.active=false;\r\n                    sprite.spriteFrame = null;\r\n                }\r\n\r\n                //出牌\r\n                var spriteChupai=seatNode.getChildByName('Chupai').getComponent(cc.Sprite);\r\n                spriteChupai.node.active=false;\r\n                spriteChupai.spriteFrame = null;\r\n                //胡牌NODE\r\n                var nodeHupai=seatNode.getChildByName('Hupai');\r\n                nodeHupai.active=false;\r\n            }\r\n            self.nodeGameInfo.active=false;\r\n            self.hideChupai();\r\n            self.hideOptions();\r\n        });\r\n        this.node.on('repeat_login',function(){\r\n            th.alert.show(\"提示\",\"您的账号已在别处登录！\",function(){\r\n                th.wc.show('正在返回登录场景');\r\n                cc.director.loadScene(\"login\");\r\n            },false);\r\n        });\r\n\r\n    },\r\n    playEffect:function(index,name){\r\n        this._effects[index].node.active = true;\r\n        this._effects[index].play(name);\r\n    },\r\n    initDragStuffs:function(node){\r\n        node.on(cc.Node.EventType.TOUCH_START, function (event) {\r\n            \r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            node.interactable = node.getComponent(cc.Button).interactable;\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //cc.log(\"cc.Node.EventType.TOUCH_START\");\r\n            this.chupaidian.node.active=false;\r\n            this.chupaidian.spriteFrame=node.getComponent(cc.Sprite).spriteFrame;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n\r\n            var gold_icon=this.chupaidian.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=node.mjid==th.socketIOManager.caishen;\r\n\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_MOVE, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            if (Math.abs(event.getDeltaX()) + Math.abs(event.getDeltaY()) < 0.5) {\r\n                return;\r\n            }\r\n            //cc.log(\"cc.Node.EventType.TOUCH_MOVE, Y:\",event.getLocationY());\r\n            this.chupaidian.node.active=true;\r\n            node.opacity = 150;\r\n            this.chupaidian.node.opacity = 255;\r\n            this.chupaidian.node.scaleX = 1;\r\n            this.chupaidian.node.scaleY = 1;\r\n            this.chupaidian.node.x = event.getLocationX() - cc.director.getVisibleSize().width / 2;\r\n            this.chupaidian.node.y = event.getLocationY() - cc.director.getVisibleSize().height / 2;\r\n            node.y = 0;\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //cc.log(\"cc.Node.EventType.TOUCH_END, Y:\",event.getLocationY());\r\n            this.chupaidian.node.active=false;\r\n            node.opacity = 255;\r\n            if (event.getLocationY() >= 200) {\r\n                cc.log(\"chupai :\",node.mjid);\r\n                this.shoot(node.mjid);\r\n            }\r\n        }.bind(this));\r\n        node.on(cc.Node.EventType.TOUCH_CANCEL, function (event) {\r\n            if (th.socketIOManager.turn != th.socketIOManager.seatIndex) {\r\n                return;\r\n            }\r\n            if (!node.interactable) {\r\n                return;\r\n            }\r\n            //cc.log(\"cc.Node.EventType.TOUCH_CANCEL, Y:\",event.getLocationY());\r\n            if (event.getLocationY() >= 200) {\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n                cc.log(\"chupai :\",node.mjid);\r\n                this.shoot(node.mjid);\r\n            }else{\r\n                this.chupaidian.node.active=false;\r\n                node.opacity = 255;\r\n            }\r\n        }.bind(this));\r\n        \r\n    },\r\n    onGameBegin:function(){\r\n        //隐藏每个座位上的动画sprite\r\n        for(var i = 0; i < this._effects.length; i++){\r\n            this._effects[i].node.active = false;\r\n        }\r\n\r\n        //自摸胡判断\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i); \r\n            var nodeHupai = this._hupaiTips[localIndex];\r\n            nodeHupai.active = seatData.isHu;\r\n            if(seatData.isHu){\r\n                nodeHupai.getChildByName(\"hu\").active = !seatData.isZimo;\r\n                nodeHupai.getChildByName(\"zimo\").active = seatData.isZimo;\r\n            }\r\n            //todo 如果有胡牌信息\r\n\r\n        }\r\n        //隐藏各座位出牌点\r\n        this.hideChupai();\r\n        //隐藏当前玩家所有操作（吃，碰，杠，胡，弃）\r\n        this.hideOptions();\r\n        \r\n        this.btnReady.node.active = th.socketIOManager.status == \"idle\" && !th.socketIOManager.seats[th.socketIOManager.seatIndex].ready;\r\n        \r\n        //todo 判断是否回放  //&& cc.vv.replayMgr.isReplay() == false\r\n        if(th.socketIOManager.status == \"idle\" ){\r\n            return;\r\n        }\r\n\r\n        this.setSpriteFrameByMJID(\"B_\", this.spriteCaishen,th.socketIOManager.caishen);\r\n        this.lblRoundCount.string=\"剩余 \"+(th.socketIOManager.config.round-th.socketIOManager.round)+\" 局\";\r\n        this.lblMjCount.string=\"剩余 \"+th.socketIOManager.mjsy+\" 张\";\r\n        //初始化其他玩家手上的牌\r\n        var sides = [\"right\",\"up\",\"left\"];        \r\n        for(var i = 0; i < sides.length; ++i){\r\n            var holds = this.node.getChildByName(sides[i]).getChildByName(\"Holds\");\r\n            for(var j = 0; j < holds.childrenCount; ++j){\r\n                var nc = holds.children[j];\r\n                nc.active = true;\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;\r\n                var sprite = nc.getComponent(cc.Sprite); \r\n                sprite.spriteFrame =th.mahjongManager.holdsEmpty[i+1];\r\n            }            \r\n        }\r\n\r\n        this.nodePrepare.active=false;\r\n        this.nodeGameInfo.active=true;\r\n\r\n        this.initMahjongs();\r\n\r\n        //初始化其他玩家的牌\r\n        for(var i = 0; i < th.socketIOManager.seats.length; i++){\r\n            var seatData = th.socketIOManager.seats[i];\r\n            var localIndex = th.socketIOManager.getLocalIndex(i);\r\n            if(localIndex != 0){\r\n                this.initOtherMahjongs(seatData);\r\n                if(i == th.socketIOManager.turn){\r\n                    this.initMopai(i,-1);\r\n                }else{\r\n                    this.initMopai(i,null);    \r\n                }\r\n            }\r\n        }\r\n        this.showChupai();\r\n        if(th.socketIOManager.actions != null){\r\n            this.showAction(th.socketIOManager.actions);\r\n            th.socketIOManager.actions = null;\r\n        }\r\n\r\n    },\r\n    onMJClicked:function(event){\r\n        if(th.socketIOManager.turn != th.socketIOManager.seatIndex){\r\n            return;\r\n        }\r\n        for(var i = 0; i < this._mymjs.length; ++i){\r\n            if(event.target == this._mymjs[i].node){\r\n                //如果是再次点击，则出牌\r\n                if(event.target == this._selectedMJ){\r\n                    cc.log(\"chupai :\",this._selectedMJ.mjid);\r\n                    this.shoot(this._selectedMJ.mjid); \r\n                    this._selectedMJ.y = 0;\r\n                    this._selectedMJ = null;\r\n                    return;\r\n                }\r\n                if(this._selectedMJ != null){\r\n                    this._selectedMJ.y = 0;\r\n                }\r\n                event.target.y = 15;\r\n                this._selectedMJ = event.target;\r\n                return;\r\n            }\r\n        }\r\n    },\r\n    onOptionClicked:function(event){\r\n        if(event.target.name == \"btnPeng\"){\r\n            th.sio.send(\"peng\");\r\n        }else if(event.target.name == \"btnGang\"){\r\n            th.sio.send(\"gang\",event.target.pai);\r\n        }else if(event.target.name == \"btnHu\"){\r\n            th.sio.send(\"hu\");\r\n        }else if(event.target.name == \"btnChi\"){\r\n            th.sio.send(\"chi\",event.target.pais);\r\n        }else if(event.target.name == \"btnGuo\"){\r\n            if(th.socketIOManager.turn==th.socketIOManager.seatIndex){\r\n                this.optionsWin.active = false;\r\n            }\r\n            th.sio.send(\"guo\");\r\n        }\r\n    },\r\n    //出牌\r\n    shoot:function(mjid){\r\n        if(mjid == null){\r\n            return;\r\n        }\r\n        th.sio.send('chupai',mjid);\r\n    },\r\n    getMJIndex:function(side,index){\r\n        if(side == \"right\" || side == \"up\"){\r\n            return 13 - index;\r\n        }\r\n        return index;\r\n    },\r\n    initMopai:function(seatIndex,pai){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatIndex);\r\n        var side =th.mahjongManager.getSide(localIndex);\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lastIndex = this.getMJIndex(side,13);\r\n        var nc = holds.children[lastIndex];\r\n\r\n        nc.scaleX = 1.0;\r\n        nc.scaleY = 1.0;\r\n        if(pai == null){\r\n            nc.active = false;\r\n        }else if(pai >= 0){\r\n            nc.active = true;\r\n            //游戏回放时用到\r\n            if(side == \"up\"){\r\n                nc.scaleX = 0.73;\r\n                nc.scaleY = 0.73;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,pai);\r\n        } else if(pai != null){\r\n            nc.active = true;\r\n            //UP方向正常抓牌是-1\r\n            if(side == \"up\"){\r\n                nc.scaleX = 1.0;\r\n                nc.scaleY = 1.0;                    \r\n            }\r\n            var sprite = nc.getComponent(cc.Sprite); \r\n            sprite.spriteFrame = th.mahjongManager.getHoldsEmptySpriteFrame(side);\r\n        }\r\n    },\r\n    hideChupai:function(){\r\n        for(var i = 0; i < this._chupais.length;i++){\r\n            this._chupais[i].node.active = false;\r\n        }     \r\n    },\r\n    showChupai:function(){\r\n        var pai = th.socketIOManager.chupai; \r\n        if( pai >=0){\r\n            var localIndex = th.socketIOManager.getLocalIndex(th.socketIOManager.turn);\r\n            var sprite = this._chupais[localIndex];\r\n            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n            sprite.node.active = true;\r\n\r\n            var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=pai==th.socketIOManager.caishen;\r\n        }\r\n    },\r\n    addOption:function(btnName,pai){\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var option = options.children[i];\r\n            if(option.name=='Option' && option.active==false){\r\n                option.active=true;\r\n                if(btnName!='btnChi'){\r\n                    var sprite = option.getChildByName(\"opTarget1\").getComponent(cc.Sprite);\r\n                    sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai);\r\n                    sprite.node.active=true;\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pai = pai;\r\n                }else{\r\n                    var pais=[];\r\n                    for(var i=0;i<pai.length;i++){\r\n                        if(pai[i]!=-1){\r\n                            pais.push(pai[i]);\r\n                            var sprite = option.getChildByName(\"opTarget\"+(3-pais.length)).getComponent(cc.Sprite);\r\n                            sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(\"M_\",pai[i]);\r\n                            sprite.node.active=true;\r\n                        }\r\n                    }\r\n                    var btns=option.getChildByName('btns');\r\n                    var btn = btns.getChildByName(btnName); \r\n                    btn.active = true;\r\n                    btn.pais = pai.join(\",\");\r\n                }\r\n                break;\r\n            }\r\n        }\r\n    },\r\n    showAction:function(data){\r\n        if(this.optionsWin.active){\r\n            this.hideOptions();\r\n        }\r\n        //todo \r\n        if(data && (data.hu || data.gang || data.peng || data.chi)){\r\n            this.optionsWin.active = true;\r\n            if(data.hu){\r\n                this.addOption(\"btnHu\",data.huPai);\r\n            }\r\n            if(data.peng){\r\n                this.addOption(\"btnPeng\",data.pengPai);\r\n            }\r\n            if(data.chi){\r\n                for(var i = 0; i < data.chiPai.length;++i){\r\n                    var pais = data.chiPai[i];\r\n                    this.addOption(\"btnChi\",pais);\r\n                }\r\n            }\r\n            if(data.gang){\r\n                for(var i = 0; i < data.gangPai.length;++i){\r\n                    var gp = data.gangPai[i];\r\n                    this.addOption(\"btnGang\",gp);\r\n                }\r\n            }   \r\n        }\r\n    },\r\n    initMahjongs:function(){\r\n        //手上麻将\r\n        var seats=th.socketIOManager.seats;\r\n        var seatData=seats[th.socketIOManager.seatIndex];\r\n        var holds=seatData.holds;\r\n        if(holds == null){\r\n            return;\r\n        }\r\n        //排序\r\n        holds=th.mahjongManager.sortHolds(holds);\r\n\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        //初始化手牌\r\n        for(var i=0;i<holds.length;i++){\r\n            var mjid = holds[i];\r\n            var sprite=this._mymjs[lackingNum+i];\r\n            sprite.node.mjid = mjid;\r\n            this.setSpriteFrameByMJID(\"M_\",sprite,mjid);\r\n\r\n            var gold_icon=sprite.node.getChildByName(\"gold_icon\");\r\n            gold_icon.active=mjid==th.socketIOManager.caishen;\r\n\r\n            sprite.node.y=0;\r\n        }\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjid = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;\r\n            sprite.node.y=0;\r\n        }\r\n        for(var i = lackingNum + holds.length; i < this._mymjs.length; ++i){\r\n            var sprite = this._mymjs[i]; \r\n            sprite.node.mjid = null;\r\n            sprite.spriteFrame = null;\r\n            sprite.node.active = false;  \r\n            sprite.node.y=0;          \r\n        }\r\n    },\r\n    initOtherMahjongs:function(seatData){\r\n        var localIndex = th.socketIOManager.getLocalIndex(seatData.index);\r\n        if(localIndex == 0){\r\n            return;\r\n        }\r\n        var side = th.mahjongManager.getSide(localIndex);\r\n        var sideHolds = this.node.getChildByName(side).getChildByName(\"Holds\");\r\n        var lackingNum = (seatData.pengs.length + seatData.angangs.length + seatData.diangangs.length + seatData.bugangs.length +seatData.chis.length)*3;\r\n        for(var i = 0; i < lackingNum; i++){\r\n            var idx = this.getMJIndex(side,i);\r\n            sideHolds.children[idx].active = false;\r\n        }\r\n        var pre = th.mahjongManager.getFoldPre(localIndex);\r\n        var holds = th.mahjongManager.sortHolds(seatData.holds);\r\n        if(holds != null && holds.length > 0){\r\n            for(var i = 0; i < holds.length; i++){\r\n                var idx = this.getMJIndex(side,i + lackingNum);\r\n                var sprite = sideHolds.children[idx].getComponent(cc.Sprite);\r\n                if(side == \"up\"){\r\n                    sprite.node.scaleX = 0.73;\r\n                    sprite.node.scaleY = 0.73;                    \r\n                }\r\n                sprite.node.active = true;\r\n                sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,holds[i]);\r\n            }\r\n\r\n            if(holds.length + lackingNum == 13){\r\n                var lasetIdx = this.getMJIndex(side,13);\r\n                sideHolds.children[lasetIdx].active = false;\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    setSpriteFrameByMJID:function(pre,sprite,mjid){\r\n        sprite.spriteFrame = th.mahjongManager.getSpriteFrameByMJID(pre,mjid);\r\n        sprite.node.active = true;\r\n    },\r\n    hideOptions:function(data){\r\n        this.optionsWin.active=false;\r\n        var options=this.optionsWin.getChildByName('Options');\r\n        for(var i = 0; i < options.childrenCount; i++){\r\n            var option = options.children[i];\r\n            if(option.name=='Option'){\r\n                option.active=false;\r\n                option.getChildByName('opTarget1').active=false;\r\n                option.getChildByName('opTarget2').active=false;\r\n                var btns=option.getChildByName('btns');\r\n                btns.getChildByName('btnChi').active=false;\r\n                btns.getChildByName('btnPeng').active=false;\r\n                btns.getChildByName('btnGang').active=false;\r\n                btns.getChildByName('btnHu').active=false;\r\n            }\r\n        }\r\n    },\r\n    checkIp:function(){\r\n        cc.log('==>MJGame check_ip:');\r\n    }\r\n    /*\r\n    update (dt) {\r\n    },\r\n    */\r\n});\r\n"]}